{"meta":{"title":"Kenryu","subtitle":"hello there.","description":"im testing my firt blog site.","author":"Kenryu","url":"https://kenryu.cc/zh","root":"/zh/"},"pages":[{"title":"Resume","date":"2025-12-19T08:19:46.023Z","updated":"2025-12-19T08:19:46.023Z","comments":false,"path":"about/index.html","permalink":"https://kenryu.cc/zh/about/index.html","excerpt":"","text":""}],"posts":[{"title":"å¤šåè®®å…±äº«ç›®å½•ï¼ˆWebDAV / Samba / SFTPï¼‰çš„ ZFS on Linuxæƒé™è®¾è®¡å®è·µ","slug":"Linux/å¤šåè®®å…±äº«ç›®å½•ï¼ˆWebDAV-Samba-SFTPï¼‰çš„ZFS-On-Linuxæƒé™è®¡å®è·µ","date":"2025-12-20T09:27:00.000Z","updated":"2025-12-20T09:34:00.566Z","comments":true,"path":"2025/12/20/Linux/å¤šåè®®å…±äº«ç›®å½•ï¼ˆWebDAV-Samba-SFTPï¼‰çš„ZFS-On-Linuxæƒé™è®¡å®è·µ/","link":"","permalink":"https://kenryu.cc/zh/2025/12/20/Linux/%E5%A4%9A%E5%8D%8F%E8%AE%AE%E5%85%B1%E4%BA%AB%E7%9B%AE%E5%BD%95%EF%BC%88WebDAV-Samba-SFTP%EF%BC%89%E7%9A%84ZFS-On-Linux%E6%9D%83%E9%99%90%E8%AE%A1%E5%AE%9E%E8%B7%B5/","excerpt":"","text":"ä¸€ã€èƒŒæ™¯ï¼ˆBackgroundï¼‰åœ¨å®¶åº­æˆ–å°å‹å›¢é˜Ÿç¯å¢ƒä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°ä¸€ä¸ªå…±äº«ç›®å½•éœ€è¦åŒæ—¶è¢«å¤šç§åè®®è®¿é—®åŒä¸€ä¸ªæ–‡ä»¶å¤¹çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼š WebDAVï¼šç”¨äºç½‘é¡µæˆ–ç§»åŠ¨ç«¯è®¿é—®ï¼ˆApache &#x2F; Nginxï¼‰ **Samba (SMB)**ï¼šç”¨äº Windows &#x2F; macOS æ–‡ä»¶å…±äº« SFTPï¼šç”¨äº SSH æ–¹å¼çš„æ–‡ä»¶ç®¡ç† æœ¬æ–‡ä»¥ /share ç›®å½•ä¸ºä¾‹ï¼Œç”¨æˆ·éå¸¸ç®€å•ï¼š æˆ‘ï¼šk3nryu è€å©†ï¼šxiaowu WebDAV æœåŠ¡ç”¨æˆ·ï¼šwww-data ç®¡ç†ç”¨æˆ·ï¼šroot ä½†é—®é¢˜æ°æ°å‡ºåœ¨ï¼šä¸åŒåè®®åœ¨ Linux ä¸‹ä¼šæ˜ å°„æˆä¸åŒçš„ç”¨æˆ·å’Œç»„ã€‚ å®é™…é‡åˆ°çš„é—®é¢˜æˆ‘åˆ›å»ºçš„æ–‡ä»¶çš„æ—¶å€™ï¼Œæƒé™ç»„å°†ä¼šæ˜¯k3nryu:k3nryuï¼Œé‚£ä¹ˆæˆ‘è€å©†ä¹Ÿç¼–è¾‘ä¸äº†æˆ‘çš„æ–‡ä»¶ã€‚åŸå› æ˜¯ä¸åŒè®¿é—®æ–¹å¼åˆ›å»ºçš„æ–‡ä»¶ï¼Œå…¶å±ä¸»å’Œå±ç»„å¦‚ä¸‹ï¼š è®¿é—®æ–¹å¼ Linux çœ‹åˆ°çš„ç”¨æˆ·:ç»„ WebDAV www-data:www-data Sambaï¼ˆæˆ‘ï¼‰ k3nryu:k3nryu Sambaï¼ˆè€å©†ï¼‰ xiaowu:xiaowu SFTP root:root å¯¼è‡´çš„é—®é¢˜ï¼š A åˆ›å»ºçš„æ–‡ä»¶ï¼ŒB æ— æ³•è¯»å†™ root åˆ›å»ºçš„æ–‡ä»¶ï¼Œæ™®é€šç”¨æˆ·æ²¡æƒé™ å­ç›®å½•æƒé™é€æ¸å¤±æ§ ä¸åŒæœåŠ¡çš„ umask äº’ç›¸å†²çª äºŒã€éœ€æ±‚ï¼ˆRequirementsï¼‰ç›®æ ‡éœ€æ±‚ æ— è®ºé€šè¿‡ WebDAV &#x2F; Samba &#x2F; SFTP &#x2F; æœ¬åœ° shellï¼š åœ¨ /shareï¼ˆåŠå…¶å­ç›®å½•ï¼‰ä¸­åˆ›å»ºçš„æ–‡ä»¶ æ‰€æœ‰ç›¸å…³ç”¨æˆ·éƒ½æ‹¥æœ‰ rwx æƒé™ æƒé™è¡Œä¸ºé•¿æœŸç¨³å®šã€æ— éœ€é¢‘ç¹ç»´æŠ¤ è®¿é—®æ–¹å¼ Linux çœ‹åˆ°çš„ç”¨æˆ·:ç»„ WebDAV www-data:share Sambaï¼ˆæˆ‘ï¼‰ k3nryu:share Sambaï¼ˆè€å©†ï¼‰ xiaowu:share SFTP root:share ä¸‰ã€ç†è®ºï¼ˆTheoryï¼‰1. Linux æƒé™çš„æœ¬è´¨Linux å†…æ ¸åªå…³å¿ƒä¸‰ä»¶äº‹ï¼š UIDï¼ˆç”¨æˆ·ï¼‰ GIDï¼ˆç»„ï¼‰ æƒé™ä½ &#x2F; ACL å®ƒå¹¶ä¸çŸ¥é“ï¼š WebDAV Samba SFTP è¿™äº›â€œåè®®ç”¨æˆ·â€æœ€ç»ˆéƒ½ä¼šè¢«æ˜ å°„æˆ Linux ç”¨æˆ·ï¼Œå†ç”±å†…æ ¸è¿›è¡Œæƒé™åˆ¤æ–­ã€‚ 2. è®¾è®¡æ ¸å¿ƒæ€æƒ³ ä¸è¦å›´ç»•â€œç”¨æˆ·â€è®¾è®¡æƒé™ï¼Œè€Œè¦å›´ç»•â€œå…±äº«ç»„ï¼ˆgroupï¼‰â€è®¾è®¡æƒé™ å…³é”®æŠ€æœ¯ç»„åˆï¼š æŠ€æœ¯ ä½œç”¨ å…±äº« group è¡¨è¾¾â€œè°å±äºå…±äº«æˆå‘˜â€ setgid ä¿è¯æ–°æ–‡ä»¶ç»§æ‰¿ group ACL è¦†ç›–ä¸åŒæœåŠ¡çš„ umask sticky bitï¼ˆå¯é€‰ï¼‰ é˜²æ­¢è¯¯åˆ ä»–äººæ–‡ä»¶ å››ã€å®é™…æ“ä½œï¼ˆImplementationï¼‰ä»¥ä¸‹æ“ä½œå‡è®¾å…±äº«ç›®å½•ä¸º /shareã€‚ 1. åˆ›å»ºç»Ÿä¸€å…±äº«ç»„1groupadd share å°†æ‰€æœ‰ç›¸å…³ç”¨æˆ·åŠ å…¥è¯¥ç»„ï¼š 1234usermod -aG share k3nryuusermod -aG share xiaowuusermod -aG share www-datausermod -aG share root ä¿®æ”¹ç»„åéœ€é‡æ–°ç™»å½•æˆ–é‡å¯ç›¸å…³æœåŠ¡ã€‚ 2. è®¾ç½®ç›®å½•å±ç»„å¹¶å¯ç”¨ setgid12chown -R www-data:share /sharechmod -R 2775 /share æ£€æŸ¥æ•ˆæœï¼š 1ls -ld /share æœŸæœ›çœ‹åˆ°ï¼š 1drwxrwsr-x www-data share /share å…¶ä¸­ s è¡¨ç¤º setgidï¼Œæ–°å»ºæ–‡ä»¶ä¼šè‡ªåŠ¨ç»§æ‰¿ share ç»„ã€‚ 3. ï¼ˆOptionalï¼‰å¼€å¯ZFSçš„POSIXæ¨¡å¼çš„ACL å¦‚æœä½¿ç”¨ ZFSæ–‡ä»¶ç³»ç»Ÿçš„è¯ï¼Œé‚£ä¹ˆå®ƒçš„é»˜è®¤ALCæ¨¡å¼æ˜¯NFSv4 ACLï¼ˆSolaris çš„ chmod A+ï¼‰.å¦å¤–ä¸€æ–¹é¢setfacl &#x2F; getfaclåªæ”¯æŒ Linux POSIX ACLã€‚æ‰€ä»¥æˆ‘éœ€è¦æå‰å°†ZFSçš„ALCæ¨¡å¼è°ƒæ•´ä¸ºPOSIXã€‚ 1234zfs set acltype=posixacl tankzfs set aclinherit=passthrough tankzfs set aclmode=passthrough tankzfs get acltype,aclinherit,aclmode tank 4. ä¿®å¤å·²æœ‰æ–‡ä»¶çš„æƒé™ï¼ˆACLï¼‰ï¼Œä»¥åŠç»Ÿä¸€æœªæ¥æ–‡ä»¶çš„æƒé™ï¼ˆdefault ACLï¼Œå…³é”®ï¼‰å«ä¹‰ï¼š ä»¥ååœ¨ /share ä¸­åˆ›å»ºçš„ä»»ä½•æ–‡ä»¶æˆ–ç›®å½•ï¼Œshare ç»„å§‹ç»ˆæ‹¥æœ‰ rwx æƒé™ï¼Œæ— è§†åˆ›å»ºè€…å’Œ umaskã€‚ 123456# ä¿®å¤å·²æœ‰æ–‡ä»¶çš„æƒé™ï¼ˆACLï¼‰setfacl -R -m g:share:rwx /share# ç»Ÿä¸€æœªæ¥æ–‡ä»¶çš„æƒé™ï¼ˆdefault ACLï¼Œå…³é”®ï¼‰setfacl -R -d -m g:share:rwx /share# ç»Ÿä¸€å­æ–‡ä»¶ï¼ˆä¸åŒ…å«æ–‡ä»¶å¤¹ï¼‰å»é™¤setgidfind /share -type f -perm -2000 -exec chmod g-s &#123;&#125; +\\n 5. ç¡®ä¿ ACL mask ä¸é™åˆ¶æƒé™12setfacl -R -m m::rwx /sharesetfacl -R -d -m m::rwx /share 6. ï¼ˆå¯é€‰ï¼‰é˜²æ­¢è¯¯åˆ æ–‡ä»¶ï¼šSticky Bit1chmod +t /share æœ€ç»ˆç›®å½•æƒé™å¯èƒ½ä¸ºï¼š 1drwxrwsr-t root share /share æ•ˆæœï¼š å¯ä»¥ä¿®æ”¹ä»–äººæ–‡ä»¶ ä¸èƒ½åˆ é™¤ä»–äººæ–‡ä»¶ï¼ˆé™¤é rootï¼‰ äº”ã€åæœŸè¿ç»´ï¼ˆOperations &amp; Tipsï¼‰1. å¿«é€Ÿå¥åº·æ£€æŸ¥12ls -ld /sharegetfacl /share å…³æ³¨ï¼š æ˜¯å¦å­˜åœ¨ sï¼ˆsetgidï¼‰ æ˜¯å¦å­˜åœ¨ default:group:share:rwx 2. æƒé™å¼‚å¸¸çš„å¸¸è§æ’æŸ¥é¡ºåº123id ç”¨æˆ·å # æ˜¯å¦ä»åœ¨ share ç»„getfacl æ–‡ä»¶åmount | grep acl # æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦æ”¯æŒ ACL 3. çœ‹åˆ° ls -l ä¸­çš„ + ä¸è¦æ…Œ1-rw-rwx---+ file.txt + è¡¨ç¤ºè¯¥æ–‡ä»¶å­˜åœ¨ ACLï¼Œè¿™æ˜¯æ­£å¸¸çŠ¶æ€ã€‚ 4. ä¸€å¥è¯è¿ç»´å£è¯€ å…±äº«ç›®å½•çœ‹ groupï¼Œä¸çœ‹äººï¼›æƒé™ä¸ç¨³ç”¨ ACLï¼›setgid æ˜¯çµé­‚ã€‚ å…­ã€æ€»ç»“å½“ä¸€ä¸ªç›®å½•è¢«å¤šä¸ªåè®®è®¿é—®æ—¶ï¼Œæƒé™é—®é¢˜å‡ ä¹ä¸å¯é¿å…ã€‚æ­£ç¡®çš„åšæ³•ä¸æ˜¯ä¸æ–­ä¿®è¡¥ chmodï¼Œè€Œæ˜¯ï¼š ç»Ÿä¸€ group ç”¨ setgid ä¿è¯ç»§æ‰¿ ç”¨ ACL è¦†ç›– umask å·®å¼‚ ä¸€æ—¦è®¾è®¡æ­£ç¡®ï¼Œåç»­å‡ ä¹ä¸éœ€è¦ç»´æŠ¤ã€‚ ä¸€æ¬¡è®¾è®¡ï¼Œé•¿æœŸçœå¿ƒã€‚","categories":[{"name":"Linux","slug":"Linux","permalink":"https://kenryu.cc/zh/categories/Linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://kenryu.cc/zh/tags/linux/"},{"name":"storage","slug":"storage","permalink":"https://kenryu.cc/zh/tags/storage/"},{"name":"smb","slug":"smb","permalink":"https://kenryu.cc/zh/tags/smb/"},{"name":"webdav","slug":"webdav","permalink":"https://kenryu.cc/zh/tags/webdav/"},{"name":"sftp","slug":"sftp","permalink":"https://kenryu.cc/zh/tags/sftp/"}]},{"title":"ä¸‰æ­¥é…ç½®ï¼ˆæˆ‘ä»¬å–œæ¬¢çš„ï¼‰ç»ˆç«¯è½¯ä»¶ for macOS/ Windows","slug":"Windows/ä¸‰æ­¥é…ç½®ï¼ˆæˆ‘ä»¬å–œæ¬¢çš„ï¼‰ç»ˆç«¯è½¯ä»¶_for_macOS_or_Windows","date":"2025-12-17T11:30:30.000Z","updated":"2025-12-19T08:19:46.062Z","comments":true,"path":"2025/12/17/Windows/ä¸‰æ­¥é…ç½®ï¼ˆæˆ‘ä»¬å–œæ¬¢çš„ï¼‰ç»ˆç«¯è½¯ä»¶_for_macOS_or_Windows/","link":"","permalink":"https://kenryu.cc/zh/2025/12/17/Windows/%E4%B8%89%E6%AD%A5%E9%85%8D%E7%BD%AE%EF%BC%88%E6%88%91%E4%BB%AC%E5%96%9C%E6%AC%A2%E7%9A%84%EF%BC%89%E7%BB%88%E7%AB%AF%E8%BD%AF%E4%BB%B6_for_macOS_or_Windows/","excerpt":"","text":"å¤§æ¦‚æ€è·¯ å®‰è£…ä¾èµ– é…ç½®Git&#x2F;GitHUB ä»GitHubå…‹éš†Dotfiles Step1. å®‰è£…ä¾èµ–ä¸‹è½½æˆ‘ä»¬å–œæ¬¢Consoleè½¯ä»¶éšæ„é€‰æ‹©ä½ å–œæ¬¢çš„ï¼šMacOSï¼šiTerm2ï¼Œalacrrityï¼ŒTabbyï¼Œetcã€‚Windowsï¼šTerminalï¼ŒTeraTermï¼Œetcã€‚ Zsh Oh-my-zsh(zsh manager) Powerlevel10k(zsh theme) Zsh-syntax-highlighting Zsh-autosuggestions Nerd Font MesloLGS NF (Install on your OS and set terminal emulator font for powerlevel10k theme) Step2. é…ç½®Git&#x2F;GitHubç™»é™†GitHUB 1ssh -T git@github.com BeforeAfter åœ¨è®¾ç½®gitçš„ç”¨æˆ·å&amp;é‚®ç®±è´¦å· 12git config --global user.name &quot;k3nryu&quot;git config --global user.email &quot;tinkenryu@gmail.com&quot; æœ¬æœºä¸Šç”Ÿæˆä¸€å¯¹å…¬å¼€å¯†é’¥ï¼Œä¹‹åæˆ‘ä»¬æŠŠå…¬é’¥æ”¾è¿›ä¸ªäººGitHubçš„è´¦æˆ·é‡Œï¼Œå‘Šè¯‰GitHubè¿™å°æœºå™¨æ˜¯è‡ªå·±äººï¼Œä»è€Œå¯ä»¥è¿›è¡Œsshåè®®çš„å„é¡¹æ“ä½œã€‚ 12ssh-keygen -C &quot;tinkenryu@gmail.com&quot;cat .ssh/id_rsa.pub ç™»å½•æˆ‘ä»¬çš„Githubè´¦å·ï¼Œå¹¶ç²˜è´´ä¸Šé¢çš„å…¬é’¥ã€‚https://github.com/settings/keysç¡®è®¤èƒ½ä¸èƒ½é€šè¿‡sshè¿ä¸ŠGitHubçš„æœåŠ¡å™¨ 1ssh -T git@github.com Step3. ä»GitHubå…‹éš†DotfilesClone repositories to local. 1git clone --recursive -b macOS git@github.com:k3nryu/dotfiles.git Execute â€˜install.shâ€™ shell script. 1docfiles/install.sh Update12345678910111213141516171819202122232425262728# gitæ‹‰å–è¿œç¨‹åˆ°æœ¬åœ°git statusgit pull origin main/ master/ develop# (Option/Recommand)åˆ›å»ºåˆ†æ”¯git checkout -b bugfix/xxxgit checkout -b feature/yyygit checkout -b forZZZ/zzz# æœ¬åœ°ç¼–è¾‘Dotfilesvim xxx# æŸ¥çœ‹æ”¹äº†ä»€ä¹ˆgit diff# åˆ†æ®µæäº¤git add .git commit -m &quot;Fix few Bugs&quot;#ä¸€æ¬¡commitåªåšä¸€ä»¶äº‹æƒ…ï¼ˆFix/Add/Updata/Refactorï¼‰# åŒæ­¥ä¸»åˆ†æ”¯git fetch origin #git rebase origin/mainor git merge origin/main# æ¨é€è¿œç«¯åˆ†æ”¯git push origin feature/yyy Uninstall12rm -rf ~/dotfilesrm -rf ~/.oh-my-zsh","categories":[{"name":"macOS","slug":"macOS","permalink":"https://kenryu.cc/zh/categories/macOS/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://kenryu.cc/zh/tags/windows/"},{"name":"macOS","slug":"macOS","permalink":"https://kenryu.cc/zh/tags/macOS/"},{"name":"git","slug":"git","permalink":"https://kenryu.cc/zh/tags/git/"},{"name":"blog","slug":"blog","permalink":"https://kenryu.cc/zh/tags/blog/"},{"name":"shell","slug":"shell","permalink":"https://kenryu.cc/zh/tags/shell/"},{"name":"zsh","slug":"zsh","permalink":"https://kenryu.cc/zh/tags/zsh/"},{"name":"console","slug":"console","permalink":"https://kenryu.cc/zh/tags/console/"}]},{"title":"Amazon Linux 2ï¼ˆAWSï¼‰ã®root&ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®SSHãƒ­ã‚°ã‚¤ãƒ³","slug":"Linux/Amazon_Linux_2ï¼ˆAWSï¼‰ã®root&ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®SSHãƒ­ã‚°ã‚¤ãƒ³","date":"2022-08-03T01:21:22.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2022/08/03/Linux/Amazon_Linux_2ï¼ˆAWSï¼‰ã®root&ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®SSHãƒ­ã‚°ã‚¤ãƒ³/","link":"","permalink":"https://kenryu.cc/zh/2022/08/03/Linux/Amazon_Linux_2%EF%BC%88AWS%EF%BC%89%E3%81%AEroot&%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%81%AESSH%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3/","excerpt":"","text":"VNC ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã€Eã‚’æŠ¼ã—ã¾ã™ã€‚ linux16ã®è¡Œã®å¾Œã‚ã«rd.breakã‚’è¿½è¨˜ã—ã€CTRL + Xã‚’æŠ¼ã—èµ·å‹•ã—ã¾ã™ã€‚ ä»¥ä¸‹ã®ã‚ˆã†ã«ã€rootãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’æ“ä½œã§ãã‚‹switch_root:/#ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã«ãŸã©ã‚Šç€ãã¾ã—ãŸã€‚ ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¾ã™ã€‚ 123mount -o remount,rw /sysrootchroot /sysrootpasswd root ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€SeLinuxã‚’è¨­å®šã—ã¦ã€å†èµ·å‹•ã—ã¾ã™ã€‚ 123touch /.autorelabelexitexit ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ãŸã©ã‚Šç€ãã¾ã—ãŸã€rootã¨å…ˆç¨‹è¨­å®šã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚ OSã‚’rootã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‚ˆã†ã«ã€/etc/ssh/sshd_config ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ï¼’ã‹æ‰€ã‚’ç·¨é›†ã—ã¾ã™ã€‚ ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€/etc/ssh/sshd_config è¨­å®šã‚’åæ˜ ã—ã¾ã™ã€‚ãã—ã¦ã€OSã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’èª¿ã¹ã¾ã™ã€‚ 12systemctl restart sshdhostname -I ä»¥ä¸Šã®æ“ä½œã§ã€Amazon Linux ã®root ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ãŸã®ã§ã€ssh ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹çŠ¶æ…‹ã«ãªã‚Šã¾ã—ãŸã®ã§ã€ssh ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ã‚‡ã†ï¼","categories":[{"name":"Linux","slug":"Linux","permalink":"https://kenryu.cc/zh/categories/Linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://kenryu.cc/zh/tags/linux/"},{"name":"aws","slug":"aws","permalink":"https://kenryu.cc/zh/tags/aws/"}]},{"title":"LSI Storage Authority (LSA) on Linux","slug":"Storage/LSI_Storage_Authority_(LSA)_on_Linux","date":"2022-06-30T07:55:45.000Z","updated":"2025-12-19T08:19:46.062Z","comments":true,"path":"2022/06/30/Storage/LSI_Storage_Authority_(LSA)_on_Linux/","link":"","permalink":"https://kenryu.cc/zh/2022/06/30/Storage/LSI_Storage_Authority_(LSA)_on_Linux/","excerpt":"","text":"[toc] step0. firewall and selinux12345678firewall-cmd --add-port=2463/tcp --permanentfirewall-cmd --add-port=9000/tcp --permanentfirewall-cmd --reloadfirewall-cmd --list-allsed -i &#x27;s/^SELINUX=.*/SELINUX=disabled/&#x27; /etc/selinux/configreboot step1. From following URL search your HBA controller and download LSA packageshttps://www.broadcom.com/products/storage/raid-controllers 1unzip x.x.x.x_LSA_Linux-x64.zip step2. Download and install OpenSLPhttp://www.openslp.org/download.html 1234567yum groupinstall -y &#x27;Development Tools&#x27;wget https://jaist.dl.sourceforge.net/project/openslp/2.0.0/2.0.0%20Release/openslp-2.0.0.tar.gztar -zxvf openslp-2.0.0.tar.gzcd openslp-2.0.0/./configuremake &amp;&amp; make install/usr/local/sbin/slpd stop step3. Install LSA1234cd x.x.x.x_LSA_Linux-x64/x64/./install.shln -sf /usr/local/lib/libslp.so.1.0.0 /opt/lsi/LSIStorageAuthority/bin/libslp.so.1/etc/init.d/LsiSASH restart Uninstall1/opt/lsi/LSIStorageAuthority/uninstaller.sh","categories":[{"name":"Storage","slug":"Storage","permalink":"https://kenryu.cc/zh/categories/Storage/"}],"tags":[]},{"title":"Make Unix terminal beautiful & productive","slug":"Linux/Make_Unix_terminal_beautiful_&_productive","date":"2022-05-25T04:12:17.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2022/05/25/Linux/Make_Unix_terminal_beautiful_&_productive/","link":"","permalink":"https://kenryu.cc/zh/2022/05/25/Linux/Make_Unix_terminal_beautiful_&_productive/","excerpt":"","text":"First of all, check the activated shell using this command. 1echo $SHELL The below command will display all the available shell. 1cat /etc/shells Install ZSH123dnf -y install zsh# If chsh command no found :dnf -y install util-linux-user change shell1chsh -s $(which zsh) Install Oh-My-ZSH123456sh -c &quot;$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)&quot;# orsh -c &quot;$(wget https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh -O -)&quot;# orcurl -Lo install.sh https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh Install powerlevle10k theme123git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ~/oh-my-zsh/themes/powerlevel10kecho &#x27;source ~/oh-my-zsh/themes/powerlevel10k/powerlevel10k.zsh-theme&#x27; &gt;&gt;~/.zshrc Execute vim .zshrc and modify ZSH_THEME=&quot;powerlevel10k/powerlevel10k&quot; https://github.com/romkatv/powerlevel10k#installation Specify Terminal Tab title on ZSHExecute vim .zshrc add following. 12345678910111213141516171819# Uncomment the following line to disable auto-setting terminal title.DISABLE_AUTO_TITLE=&quot;true&quot;# To display HostnameğŸ˜PWD_Name as title textHOSTNAME=$(hostname -s)# Let zsh launch with the custom title.window_title=&quot;\\033]0;$HOSTNAMEğŸ˜$&#123;PWD##*/&#125;\\007&quot;echo -ne &quot;$window_title&quot;# Refresh the custome title when the directory changes. Changed from precmd as it shall suppress the set-title function belowfunction chpwd () &#123;window_title=&quot;\\033]0;$HOSTNAMEğŸ˜$&#123;PWD##*/&#125;\\007&quot;echo -ne &quot;$window_title&quot;&#125;# Setting your own title text on demand. (Don&#x27;t change dir after setting it ğŸ˜)function set-title()&#123;TITLE=&quot;\\[\\e]2;$*\\a\\]&quot;echo -e $&#123;TITLE&#125;&#125;","categories":[{"name":"Linux","slug":"Linux","permalink":"https://kenryu.cc/zh/categories/Linux/"}],"tags":[]},{"title":"Windows11 ã®ã€ŒNum Lockã€ã‚­ãƒ¼ã‚’ç„¡åŠ¹åŒ–","slug":"Windows/Windows11_ã®ã€ŒNum_Lockã€ã‚­ãƒ¼ã‚’ç„¡åŠ¹åŒ–","date":"2022-05-20T08:02:05.000Z","updated":"2025-12-19T08:19:46.062Z","comments":true,"path":"2022/05/20/Windows/Windows11_ã®ã€ŒNum_Lockã€ã‚­ãƒ¼ã‚’ç„¡åŠ¹åŒ–/","link":"","permalink":"https://kenryu.cc/zh/2022/05/20/Windows/Windows11_%E3%81%AE%E3%80%8CNum_Lock%E3%80%8D%E3%82%AD%E3%83%BC%E3%82%92%E7%84%A1%E5%8A%B9%E5%8C%96/","excerpt":"","text":"èª²é¡Œãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å…¥åŠ›ã™ã‚‹ãªã©ã«ãƒ†ãƒ³ã‚­ãƒ¼ã‚’é‡å®ã—ã¾ã™ã€‚ã—ã‹ã—ã€ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã™ã‚‹ã¨ãã«é–“é•ãˆã¦Num Lockã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã—ã¾ã£ãŸã‚‰ã€æ¬¡ã«æ•°å­—ã‚’æ‰“ã¡ãŸã„ã®ã«ã‚«ãƒ¼ã‚½ãƒ«ãŒæ“ä½œã•ã‚Œã¦ã—ã¾ã„ã€è‹¥å¹²è‹›ç«‹ãŸã—ããªã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿç”Ÿç”£æ€§ã«ã¯ã¨ã‚‚ã‹ãã€å¿ƒèº«ã®å¥åº·ã«ã‚‚æ‚ªå½±éŸ¿ã‚’åŠã¼ã—ã¾ã™ã€‚ ã¨ã“ã‚ã§ã€ä»Šå›ã¯ã€Num Lockã‚­ãƒ¼ã‚’åŠæ°¸ä¹…çš„ã«ç„¡åŠ¹åŒ–ã™ã‚‹æ–¹æ³•ã‚’ã”ç´¹ä»‹è‡´ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚ ã€æ°¸ä¹…çš„ã€‘ï¼šç‰©ç†çš„ã«ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‹ã‚‰ã€ŒNum Lockã€ã‚­ãƒ¼ã‚’å–ã‚Šå¤–ã— è§£æ±ºæ–¹æ³• Win+Rã‚’åŒæ™‚ã«æŠ¼ã—ã¦ã€regedit ã¨å…¥åŠ›ã—ã€ã€Œãƒ¬ã‚¸ã‚¹ãƒˆãƒª ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã€ã‚’é–‹ãã¾ã™ã€‚ ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã«ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼\\HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Keyboard Layoutã¨å…¥åŠ›ã—ã¾ã™ã€‚ æ–°ã—ã„ãƒã‚¤ãƒŠãƒªã‚¨ãƒ‡ã‚£ã‚¿Scancode Map ãƒ€ãƒ–ãƒ«ãƒã‚§ãƒƒã‚¯ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚ æ³¨æ„ï¼šNum Lockãƒ­ãƒƒã‚¯ã—ã¦ã„ã‚‹ã‹ã‚’ã”ç¢ºèªãã ã•ã„ã€‚ å†èµ·å‹•ã—ã¦å®Œäº†ã§ã™ã€‚","categories":[{"name":"Windows","slug":"Windows","permalink":"https://kenryu.cc/zh/categories/Windows/"}],"tags":[{"name":"windows","slug":"windows","permalink":"https://kenryu.cc/zh/tags/windows/"}]},{"title":"Postfix Dovecot MySQL Mail Server","slug":"Linux/Mail-Server/Postfix-Dovecot-MySQL-Mail-Server","date":"2022-05-01T15:00:00.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2022/05/02/Linux/Mail-Server/Postfix-Dovecot-MySQL-Mail-Server/","link":"","permalink":"https://kenryu.cc/zh/2022/05/02/Linux/Mail-Server/Postfix-Dovecot-MySQL-Mail-Server/","excerpt":"","text":"Objective Local network (web)mail server. Local private PKI. On LNMP-base use Postfix &amp; Dovecot &amp; PostfixAdmin &amp; RoundCube. Name Version Command Linux Rocky Linux release 8.5 (Green Obsidian) cat &#x2F;etc&#x2F;centos-release &#x2F;etc&#x2F;os-release &#x2F;etc&#x2F;redhat-release &#x2F;etc&#x2F;rocky-release &#x2F;etc&#x2F;system-release Nginx nginx version: nginx&#x2F;1.20.2 nginx -v MySQL mysql Ver 8.0.28 for Linux on x86_64 (MySQL Community Server - GPL) mysql â€“version PHP PHP 7.4.29 (fpm-fcgi) (built: Apr 12 2022 10:55:38) php -v Postfix mail_version &#x3D; 3.5.8 postconf mail_version Dovecot 2.3.8 (9df20d2db) dovecot â€“version PostfixAdmin 3.3.11 Roundcube 1.5.2 Prerequisites Have a host with CPU more than 1Core and Memory higher than 2GB. Have an LNMP-Base or LAMP-Base host; Have an FQDN that can be resolved; Have private CA root certificate, Hostâ€™s private key, Hostâ€™s certificate; free command 1234# free -htotal used free shared buff/cache availableMem: 1.9Gi 624Mi 746Mi 20Mi 606Mi 1.2GiSwap: 2.0Gi 0B 2.0Gi DNS Record on name server: 12mail.example.com. IN A 192.168.65.132132.65 IN PTR mail.example.com. SSL&#x2F;TSLâ€™s private key and certificate file is following path : 12345[root@email ~]# ll /etc/pki/tls/certs/mail.example.com.crt-r--r--r-- 1 root root 5439 Apr 23 16:41 /etc/pki/tls/certs/mail.example.com.crt[root@email ~]#[root@email ~]# ll /etc/pki/tls/private/mail.example.com.key-r-------- 1 root root 1704 Apr 23 16:41 /etc/pki/tls/private/mail.example.com.key Step1. OS SettingSetting hostname. 12# dnf -y update# hostnamectl set-hostname mail.example.com 123# vim /etc/hosts127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 mail.example.com::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 mail.example.com Disable SELinux 12# sed -i s/^SELINUX=.*$/SELINUX=disabled/ /etc/selinux/config# reboot Allow the following packages to pass though the firewall. 123# firewall-cmd --permanent --add-service=&#123;http,https,smtp,smtp-submission,smtps,imap,imaps,pop3,pop3s&#125;# firewall-cmd --reload# firewall-cmd --list-all Install some required packages and recommended PHP modules. 12# dnf -y install vim wget tar git nmap bind-utils telnet mailx openssl# dnf -y install php php-fpm php-imap php-mbstring php-mysqlnd php-gd php-opcache php-json php-curl php-zip php-xml php-bz2 php-intl php-gmp Step2. Create DatabasesCreate a database for PostfixAdmin. 1234mysql&gt; CREATE DATABASE postfixadmin;mysql&gt; CREATE USER &#x27;postfixadmin&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;YourPassword&#x27;;mysql&gt; GRANT ALL PRIVILEGES ON `postfixadmin` . _config.landscape.yml _config.yml db.json Get_Joplin_resources.sh i18n Install_JavaScripts_via_npm.sh node_modules package.json package-lock.json public scaffolds source symlink.sh test.md themes tmp.md TO &#x27;postfixadmin&#x27;@&#x27;localhost&#x27;;mysql&gt; FLUSH PRIVILEGES; Create a database for roundcubu. 1234mysql&gt; CREATE DATABASE roundcube DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;mysql&gt; CREATE USER roundcube@localhost IDENTIFIED BY &#x27;YourPassword&#x27;;mysql&gt; GRANT ALL PRIVILEGES ON roundcube.* TO roundcube@localhost;mysql&gt; FLUSH PRIVILEGES; Step3. Create Web ServersCreate Nginx config file for PostfixAdmin and RoundCube. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475# cat /etc/nginx/conf.d/mail.example.com.conf# Redirect http to https.server &#123;listen 80;listen [::]:80;server_name mail.example.com, 192.168.65.132;return 301 https://mail.example.com$request_uri;&#125;# Listen https://mail.example.comserver &#123;listen 443 ssl http2;server_name mail.example.com;# SSl/TLS configurationssl_certificate &quot;/etc/pki/tls/certs/mail.example.com.crt&quot;;ssl_certificate_key &quot;/etc/pki/tls/private/mail.example.com.key&quot;;ssl_session_cache shared:SSL:1m;ssl_session_timeout 10m;ssl_ciphers PROFILE=SYSTEM;ssl_prefer_server_ciphers on;# Roundcube configurationroot /usr/share/nginx/roundcube/;index index.php index.html index.htm;# Roundcube logserror_log /var/log/nginx/roundcube.error;access_log /var/log/nginx/roundcube.access;# Roundcube Locationslocation / &#123;try_files $uri $uri/ /index.php;&#125;location ~ .php$ &#123;try_files $uri =404;fastcgi_pass unix:/run/php-fpm/www.sock;fastcgi_index index.php;fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;include fastcgi_params;&#125;location ~ /.well-known/acme-challenge &#123;allow all;&#125;location ~ ^/(README|INSTALL|LICENSE|CHANGELOG|UPGRADING)$ &#123;deny all;&#125;location ~ ^/(bin|SQL)/ &#123;deny all;&#125;# Sub-Location of PostfixAdminlocation /postfixadmin &#123;alias /usr/share/nginx/postfixadmin/public;access_log /var/log/nginx/postfixadmin_access.log;error_log /var/log/nginx/postfixadmin_error.log;try_files $uri $uri/ /index.php;location ~ ^/(.+.php)$ &#123;try_files $uri =404;fastcgi_pass unix:/run/php-fpm/www.sock;fastcgi_index index.php;fastcgi_param SCRIPT_FILENAME $request_filename;include /etc/nginx/fastcgi_params;&#125;&#125;# A long browser cache lifetime can speed up repeat visits to your page# location ~* .(jpg|jpeg|gif|png|webp|svg|woff|woff2|ttf|css|js|ico|xml)$ &#123;# access_log off;# log_not_found off;# expires 360d;# &#125;&#125; Step4. Configure PostfixInstall and start Postfix. 12# dnf -y install postfix postfix-mysql# systemctl enable --now postfix Edit Postfix main config file with following command. This will defined our domain hostname tls_level etcâ€¦ 12# cp /etc/postfix/main.cf /etc/postfix/main.cf.bak# vim /etc/postfix/main.cf main.cf We can configure postfix by direct modifying above file or use following postconf command. 12345678910Change to:# postconf -e &quot;inet_interfaces = all&quot;# postconf -e &#x27;inet_protocols = ipv4&#x27;# postconf &#x27;smtpd_tls_cert_file = /etc/pki/tls/certs/mail.example.com.crt&#x27;# postconf &#x27;smtpd_tls_key_file = /etc/pki/tls/private/mail.example.com.key&#x27;Add:# postconf -e &#x27;smtp_address_preference = ipv4&#x27;# postconf &quot;smtpd_tls_loglevel = 1&quot;# postconf &quot;smtp_tls_loglevel = 1&quot; 123456789101112131415161718192021222324#Add following to the end of the file.# Force TLSv1.3 or TLSv1.2smtpd_tls_mandatory_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1smtpd_tls_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1smtp_tls_mandatory_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1smtp_tls_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1mailbox_transport = lmtp:unix:private/dovecot-lmtpsmtputf8_enable = novirtual_mailbox_domains = proxy:mysql:/etc/postfix/sql/mysql_virtual_domains_maps.cfvirtual_mailbox_maps =proxy:mysql:/etc/postfix/sql/mysql_virtual_mailbox_maps.cf,proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_domain_mailbox_maps.cfvirtual_alias_maps =proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_maps.cf,proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_domain_maps.cf,proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_domain_catchall_maps.cfvirtual_transport = lmtp:unix:private/dovecot-lmtpvirtual_mailbox_base = /var/vmailvirtual_minimum_uid = 2000virtual_uid_maps = static:2000virtual_gid_maps = static:2000 Enable Submssion port (587) and SMTP-S (465) by editting /etc/postfix/master.cf file. 12# cp /etc/postfix/master.cf /etc/postfix/master.cf.bak# vim /etc/postfix/master.cf master.cf 1234567891011121314151617181920# For Submissionsubmission inet n - y - - smtpd-o syslog_name=postfix/submission-o smtpd_tls_security_level=encrypt-o smtpd_tls_wrappermode=no-o smtpd_sasl_auth_enable=yes-o smtpd_relay_restrictions=permit_sasl_authenticated,reject-o smtpd_recipient_restrictions=permit_mynetworks,permit_sasl_authenticated,reject-o smtpd_sasl_type=dovecot-o smtpd_sasl_path=private/auth# For SMTP-Ssmtps inet n - y - - smtpd-o syslog_name=postfix/smtps-o smtpd_tls_wrappermode=yes-o smtpd_sasl_auth_enable=yes-o smtpd_relay_restrictions=permit_sasl_authenticated,reject-o smtpd_recipient_restrictions=permit_mynetworks,permit_sasl_authenticated,reject-o smtpd_sasl_type=dovecot-o smtpd_sasl_path=private/auth (Option) We can follow the steps below to create a watchdog to prevent the service from terminating unexpectedly. 12345# mkdir -p /etc/systemd/system/postfix.service.d/# vim /etc/systemd/system/postfix.service.d/restart.conf[Service]Restart=on-failureRestartSec=5s (Option) Verify the watchdog is working. 123# systemctl daemon-reload# pkill master# systemctl status postfix Step5. Configure Dovecot12# dnf -y install dovecot dovecot-mysql# systemctl enable --now dovecot Add the dovecot to the mail group. 1# gpasswd -a dovecot mail Add the web server(nginx) to the dovecot group. 1# gpasswd -a nginx dovecot Generating DH parameters, This is going to take a long time. 1# openssl dhparam -out /etc/dovecot/dh.pem 4096 Uncomment following line and remove submission because we have enabled submission using Postfix. 1234# cp /etc/dovecot/dovecot.conf /etc/dovecot/dovecot.conf.bak# vim /etc/dovecot/dovecot.conf#protocols = imap pop3 lmtp submissionprotocols = imap pop3 lmtp Create new file and fill in the following. This will enable Dovecot to connect to our MySQL database. 1# vim /etc/dovecot/dovecot-sql.conf.ext 123456driver = mysqlconnect = host=localhost dbname=postfixadmin user=postfixadmin password=YourPassworddefault_pass_scheme = SHA512password_query = SELECT username AS user,password FROM mailbox WHERE username = &#x27;%u&#x27; AND active=&#x27;1&#x27;user_query = SELECT maildir, 2000 AS uid, 2000 AS gid FROM mailbox WHERE username = &#x27;%u&#x27; AND active=&#x27;1&#x27;iterate_query = SELECT username AS user FROM mailbox Modify the file as below. This will define the mail location as well as the namespace. 12345# vim /etc/dovecot/conf.d/10-mail.conf# Add following in the end.mail_location = maildir:~/Maildirmail_home = /var/vmail/%d/%nmail_privileged_group = mail Add the following lines to the end of this file. 12# cp /etc/dovecot/conf.d/10-master.conf /etc/dovecot/conf.d/10-master.conf.bak# vim /etc/dovecot/conf.d/10-master.conf 12345678910111213#Add following in the end of the file.service stats &#123;unix_listener stats-reader &#123;user = nginxgroup = nginxmode = 0660&#125;unix_listener stats-writer &#123;user = nginxgroup = nginxmode = 0660&#125;&#125; Configuring Authentication Mechanism. 12345678# cp /etc/dovecot/conf.d/10-auth.conf /etc/dovecot/conf.d/10-auth.conf.bak# vim /etc/dovecot/conf.d/10-auth.conf#Change to:auth_username_format = %uauth_mechanisms = plain login!include auth-sql.conf.extauth_debug = yesauth_debug_passwords = yes Configuring SSL&#x2F;TLS Encryption. 12345678910# cp /etc/dovecot/conf.d/10-ssl.conf /etc/dovecot/conf.d/10-ssl.conf.bak# vim /etc/dovecot/conf.d/10-ssl.conf#Change to:ssl = requiredssl_cert = &lt;/etc/pki/tls/certs/mail.example.com.crtssl_key = &lt;/etc/pki/tls/private/mail.example.com.keyssl_dh = &lt;/etc/dovecot/dh.pemssl_min_protocol = TLSv1.2ssl_cipher_list = PROFILE=SYSTEMssl_prefer_server_ciphers = yes SASL Authentication Between Postfix and Dovecot. 12345678910111213141516# vim /etc/dovecot/conf.d/10-master.conf# Change to:service lmtp &#123;unix_listener /var/spool/postfix/private/dovecot-lmtp &#123;mode = 0600user = postfixgroup = postfix&#125;&#125;service auth &#123;unix_listener /var/spool/postfix/private/auth &#123;mode = 0600user = postfixgroup = postfix&#125;&#125; Edit the following file like below. This will auto-create Sent ,Junk, Draftsand Trash Folder. 123456789101112131415161718192021222324# cp /etc/dovecot/conf.d/15-mailboxes.conf /etc/dovecot/conf.d/15-mailboxes.conf.bak# vim /etc/dovecot/conf.d/15-mailboxes.confnamespace inbox &#123;# These mailboxes are widely used and could perhaps be created automatically:mailbox Drafts &#123;auto = createspecial_use = Drafts&#125;mailbox Junk &#123;auto = createspecial_use = Junk&#125;mailbox Trash &#123;auto = createspecial_use = Trash&#125;mailbox Sent &#123;auto = createspecial_use = Sent&#125;mailbox &quot;Sent Messages&quot; &#123;special_use = Sent&#125;&#125; Now we need to restart the Postfix and dovecot services. 123# systemctl restart postfix dovecot# systemctl status postfix# systemctl status dovecot Step6. Configure PostfixadminCheck https://github.com/postfixadmin/postfixadmin/releases to get the latest stable release first. And then we need to download the tarball via wget command. 1234# wget https://github.com/postfixadmin/postfixadmin/archive/postfixadmin-3.3.11.tar.gz# tar -zxvf postfixadmin-3.3.11.tar.gz# mv postfixadmin-postfixadmin-3.3.11/ /usr/share/nginx/postfixadmin# mkdir -p /usr/share/nginx/postfixadmin/templates_c Create the following new file and fill it like below. This will enable PostfixAdmin connect MySQL database and update password by PHP. 123456789101112# vim /usr/share/nginx/postfixadmin/config.local.php&lt;?php$CONF[&#x27;configured&#x27;] = true;$CONF[&#x27;database_type&#x27;] = &#x27;mysqli&#x27;;$CONF[&#x27;database_host&#x27;] = &#x27;localhost&#x27;;$CONF[&#x27;database_port&#x27;] = &#x27;3306&#x27;;$CONF[&#x27;database_user&#x27;] = &#x27;postfixadmin&#x27;;$CONF[&#x27;database_password&#x27;] = &#x27;YourPassword&#x27;;$CONF[&#x27;database_name&#x27;] = &#x27;postfixadmin&#x27;;$CONF[&#x27;encrypt&#x27;] = &#x27;dovecot:SHA512&#x27;;$CONF[&#x27;dovecotpw&#x27;] = &quot;/usr/bin/doveadm pw -r 12&quot;;?&gt; 1# chown -R nginx:nginx /usr/share/nginx/postfixadmin/ Make following directory. 1# mkdir -p /etc/postfix/sql/ Create following files and make sure they are set with permissions to be accessible by Postfix user. 12345678910# vim /etc/postfix/sql/mysql_virtual_domains_maps.cfuser = postfixadminpassword = YourPasswordhosts = localhostdbname = postfixadminquery = SELECT domain FROM domain WHERE domain=&#x27;%s&#x27; AND active = &#x27;1&#x27;#query = SELECT domain FROM domain WHERE domain=&#x27;%s&#x27;#optional query to use when relaying for backup MX#query = SELECT domain FROM domain WHERE domain=&#x27;%s&#x27; AND backupmx = &#x27;0&#x27; AND active = &#x27;1&#x27;#expansion_limit = 100 1234567# vim /etc/postfix/sql/mysql_virtual_mailbox_maps.cfuser = postfixadminpassword = YourPasswordhosts = localhostdbname = postfixadminquery = SELECT maildir FROM mailbox WHERE username=&#x27;%s&#x27; AND active = &#x27;1&#x27;#expansion_limit = 100 123456# vim /etc/postfix/sql/mysql_virtual_alias_domain_mailbox_maps.cfuser = postfixadminpassword = YourPasswordhosts = localhostdbname = postfixadminquery = SELECT maildir FROM mailbox,alias_domain WHERE alias_domain.alias_domain = &#x27;%d&#x27; and mailbox.username = CONCAT(&#x27;%u&#x27;, &#x27;@&#x27;, alias_domain.target_domain) AND mailbox.active = 1 AND alias_domain.active=&#x27;1&#x27; 1234567# vim /etc/postfix/sql/mysql_virtual_alias_maps.cfuser = postfixadminpassword = YourPasswordhosts = localhostdbname = postfixadminquery = SELECT goto FROM alias WHERE address=&#x27;%s&#x27; AND active = &#x27;1&#x27;#expansion_limit = 100 123456# vim /etc/postfix/sql/mysql_virtual_alias_domain_maps.cfuser = postfixadminpassword = YourPasswordhosts = localhostdbname = postfixadminquery = SELECT goto FROM alias,alias_domain WHERE alias_domain.alias_domain = &#x27;%d&#x27; and alias.address = CONCAT(&#x27;%u&#x27;, &#x27;@&#x27;, alias_domain.target_domain) AND alias.active = 1 AND alias_domain.active=&#x27;1&#x27; 123456# vim /etc/postfix/sql/mysql_virtual_alias_domain_catchall_maps.cfuser = postfixadminpassword = YourPasswordhosts = localhostdbname = postfixadminquery = SELECT goto FROM alias,alias_domain WHERE alias_domain.alias_domain = &#x27;%d&#x27; and alias.address = CONCAT(&#x27;@&#x27;, alias_domain.target_domain) AND alias.active = 1 AND alias_domain.active=&#x27;1&#x27; 1# chmod 0640 /etc/postfix/sql/* 123456789# adduser vmail --system --uid 2000 --user-group --no-create-home# mkdir /var/vmail/# chown vmail:vmail /var/vmail/ -R# chown -R postfix:postfix /etc/postfix/sql/# chown -R nginx:nginx /var/lib/php/opcache/# chown -R nginx:nginx /var/lib/php/session/# chown -R nginx:nginx /var/lib/php/wsdlcache/# chown nginx:nginx /etc/pki/tls/certs/mail.example.com.crt# chown nginx:nginx /etc/pki/tls/private/mail.example.com.key 12# nginx -t# nginx -s reload Open our browser and enter following URL to complete PostfixAdmin setup.https://mail.example.com/postfixadmin/setup.phpYou can generate a password hash through php -r &#39;echo password_hash(&quot;YourPassword&quot;, PASSWORD_DEFAULT);&#39; command.Now you need to add following line to the /usr/share/nginx/postfixadmin/config.local.php file in the end. 1$CONF[&#x27;setup_password&#x27;] = &#x27;Your_Password&#x27;s_Hash&#x27;; Follow the setup wizard to create an Administrator user and login.Now you can create Domain and Mailboxes in PostfixAdmin. Reference:https://github.com/postfixadmin/postfixadmin/tree/master/DOCUMENTShttps://raw.githubusercontent.com/postfixadmin/postfixadmin/master/INSTALL.TXT Step7. Configure RoundCubeRoundCube is a WebGUI IMAP client.Download Roundcube Webmail from https://github.com/roundcube/roundcubemail/releases 12345# wget https://github.com/roundcube/roundcubemail/releases/download/1.5.2/roundcubemail-1.5.2-complete.tar.gz# tar -zxvf roundcubemail-1.5.2-complete.tar.gz# mv roundcubemail-1.5.2 /usr/share/nginx/roundcube# chown nginx:nginx -R /usr/share/nginx/roundcube/# dnf install php-ldap php-imagick php-common php-gd php-imap php-json php-curl php-zip php-xml php-mbstring php-bz2 php-intl php-gmp -y Add your Private CAâ€™s certificate in the end of the following file. Note: This needs to be saved forcibly with :wq!. 12345678# vim /etc/pki/tls/certs/ca-bundle.crt#Add the following to the end of the file.# My Private CA Certificate.-----BEGIN CERTIFICATE-----...Your CA certificate....-----END CERTIFICATE----- Now you need to open your browser and enter following URL to continue RoundCube setup.https://email.example.com/installer Fill Database setup.Fill IMAP setup.IMAP server: ssl://email.example.com port: 993SMTP server: tls://email.example.com port: 587SMTP server: ssl://email.example.com port: 465Next, you can scroll down to the Plugins section to enable some plugins. For example: the password plugin, mark as junk plugin and so on. I enabled all of them.Make sure the password plugin in the plugin list at the end of this file. The plugin order doesnâ€™t matter. 1# grep &#x27;password&#x27; /usr/share/nginx/roundcube/config/config.inc.php Create the new PHP file by copying the file below and modify it like following. This will enable RoundCube to connect our MySQL database and update password. 12# cp /usr/share/nginx/roundcube/plugins/password/config.inc.php.dist /usr/share/nginx/roundcube/plugins/password/config.inc.phpvim /usr/share/nginx/roundcube/plugins/password/config.inc.php 123456789#Change the value to:$config[&#x27;password_db_dsn&#x27;] = &#x27;mysql://postfixadmin:YourPassword@127.0.0.1/postfixadmin&#x27;;$config[&#x27;password_query&#x27;] = &#x27;UPDATE mailbox SET password=%D,modified=NOW() WHERE username=%u&#x27;;$config[&#x27;password_strength_driver&#x27;] = &#x27;zxcvbn&#x27;;$config[&#x27;password_zxcvbn_min_score&#x27;] = 5;$config[&#x27;password_algorithm&#x27;] = &#x27;dovecot&#x27;;$config[&#x27;password_dovecotpw&#x27;] = &#x27;/usr/bin/doveadm pw -r 12&#x27;;$config[&#x27;password_dovecotpw_method&#x27;] = &#x27;SHA512&#x27;;$config[&#x27;password_dovecotpw_with_method&#x27;] = true; config.inc.php 123# chown nginx:nginx /usr/share/nginx/roundcube/plugins/password/config.inc.php# chmod 600 /usr/share/nginx/roundcube/plugins/password/config.inc.php# echo &quot;$config[&#x27;enable_installer&#x27;] = true;&quot; &gt;&gt; /usr/share/nginx/roundcube/config/config.inc.php Close the browser and enter following URL to complete set up.https://email.example.com/installer/index.php?_step=3Send testLogin testAfter completing the installation and the final tests please remove the whole installer folder from the document root of the webserver or make sure that enable_installer option in config.inc.php is disabled. 1234# rm -rf /usr/share/nginx/roundcube/installer/vim /usr/share/nginx/roundcube/config/config.inc.phpChange to:$config[&#x27;enable_installer&#x27;]=false; 12# nginx -t# nginx -s reload Close the browser and enter following URL to login your account.https://mail.example.com/postfixadmin/setup.phphttps://mail.example.com Reference:https://www.linuxbabe.com/redhat/postfixadmin-create-virtual-mailboxes-centos-mail-serverhttps://www.linuxbabe.com/redhat/install-roundcube-webmail-centos-8-rhel-8-apache-nginx#out-of-office TroubleShootingPerform a user lookup in Dovecotâ€™s userdbs. 1# doveadm user &#x27;*&#x27; 12345# journalctl -eu dovecot# vim /var/log/maillog# mail user@gmail.com# vim /etc/aliases# newaliases","categories":[{"name":"Linux","slug":"Linux","permalink":"https://kenryu.cc/zh/categories/Linux/"}],"tags":[{"name":"Server","slug":"Server","permalink":"https://kenryu.cc/zh/tags/Server/"},{"name":"Nginx","slug":"Nginx","permalink":"https://kenryu.cc/zh/tags/Nginx/"},{"name":"MySQL","slug":"MySQL","permalink":"https://kenryu.cc/zh/tags/MySQL/"},{"name":"PHP","slug":"PHP","permalink":"https://kenryu.cc/zh/tags/PHP/"}]},{"title":"phpipam","slug":"Linux/phpipam","date":"2022-04-19T08:58:10.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2022/04/19/Linux/phpipam/","link":"","permalink":"https://kenryu.cc/zh/2022/04/19/Linux/phpipam/","excerpt":"","text":"LNMP[toc] Name Version Command phpIPAM 1.5 cd &#x2F;var&#x2F;www&#x2F;phpipam&#x2F; &amp;&amp; git log Linux Rocky Linux release 8.5 (Green Obsidian) cat &#x2F;etc&#x2F;lsb-release &#x2F;etc&#x2F;os-release Nginx nginx version: nginx&#x2F;1.20.2 nginx -v MySQL mysql Ver 8.0.28 for Linux on x86_64 (MySQL Community Server - GPL) mysql â€“version PHP PHP 7.3.20 (cli) (built: Jul 7 2020 07:53:49) ( NTS ) php -v phpipam1234dnf -y install php-gmp gitgit clone https://github.com/phpipam/phpipam.git /var/www/phpipamchown -R nginx:nginx /var/www/phpipamcp /var/www/phpipam/config.dist.php /var/www/phpipam/config.php 1vim /var/www/phpipam/config.php 12345$db[&#x27;host&#x27;] = &#x27;127.0.0.1&#x27;;$db[&#x27;user&#x27;] = &#x27;phpipam&#x27;;$db[&#x27;pass&#x27;] = &#x27;Your_Password&#x27;;$db[&#x27;name&#x27;] = &#x27;phpipam&#x27;;$db[&#x27;port&#x27;] = 3306; MySQL12345# mysql -u root -pmysql&gt; create database phpipam;mysql&gt; create user phpipam@localhost identified with mysql_native_password by &#x27;P@ssw0rd&#x27;;mysql&gt; GRANT ALL PRIVILEGES ON phpipam.* TO phpipam@localhost;mysql&gt; flush privileges; PHP1vim /etc/php-fpm.d/www.conf 1234567- user = apache- group = apache+ user = nginx+ group = nginx+ listen.owner = nginx+ listen.group = nginx+ listen.mode = 0660 12echo &quot;&lt;?php phpinfo(); ?&gt;&quot; &gt;&gt; /usr/share/nginx/html/index.phpsystemctl restart php-fpm.service NginxBackup nginx default config file. 1mv /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf.bak Edit site config file . 1vim /etc/nginx/conf.d/ipam.kensho.toda.conf 123456789101112131415161718192021222324252627282930313233server &#123;listen 443 ssl http2;server_name ipam.kensho.toda;root /var/www/phpipam;index index.php;ssl_certificate &quot;/etc/pki/nginx/ipam.kensho.toda.crt&quot;;ssl_certificate_key &quot;/etc/pki/nginx/private/ipam.kensho.toda.key&quot;;ssl_session_cache shared:SSL:1m;ssl_session_timeout 10m;ssl_ciphers PROFILE=SYSTEM;ssl_prefer_server_ciphers on;location / &#123;try_files $uri $uri/ /phpipam/index.php;index index.php;&#125;location /api/ &#123;try_files $uri $uri/ /phpipam/api/index.php;&#125;location ~ \\.php$ &#123;fastcgi_pass unix:/run/php-fpm/www.sock;fastcgi_index index.php;try_files $uri $uri/ index.php = 404;fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;include fastcgi_params;&#125;&#125;server &#123;listen 80;server_name ipam.kensho.toda;return 301 https://ipam.kensho.toda$request_uri;&#125; 12nginx -tnginx -s reload Complete the initial configuration wizard The default Login credentials are: Username: admin Password: ipamadmin ToubleshotingReset phpipam admin password. 1php /var/www/phpipam/functions/scripts/reset-admin-password.php Check databaseâ€™s user. 123# mysql -u root -pmysql&gt; use mysql;mysql&gt; select user,host,plugin from user; Schedule check-ip via cron1234# crontab -e*/15 Install_JavaScripts_via_npm.sh README.md _config.landscape.yml _config.yml db.json i18n joplin2hexo node_modules package.json public scaffolds source themes tmp Install_JavaScripts_via_npm.sh README.md _config.landscape.yml _config.yml db.json i18n joplin2hexo node_modules package.json public scaffolds source themes tmp Install_JavaScripts_via_npm.sh README.md _config.landscape.yml _config.yml db.json i18n joplin2hexo node_modules package.json public scaffolds source themes tmp Install_JavaScripts_via_npm.sh README.md _config.landscape.yml _config.yml db.json i18n joplin2hexo node_modules package.json public scaffolds source themes tmp root /usr/bin/php /var/www/phpipam/functions/scripts/pingCheck.php*/15 Install_JavaScripts_via_npm.sh README.md _config.landscape.yml _config.yml db.json i18n joplin2hexo node_modules package.json public scaffolds source themes tmp Install_JavaScripts_via_npm.sh README.md _config.landscape.yml _config.yml db.json i18n joplin2hexo node_modules package.json public scaffolds source themes tmp Install_JavaScripts_via_npm.sh README.md _config.landscape.yml _config.yml db.json i18n joplin2hexo node_modules package.json public scaffolds source themes tmp Install_JavaScripts_via_npm.sh README.md _config.landscape.yml _config.yml db.json i18n joplin2hexo node_modules package.json public scaffolds source themes tmp root /usr/bin/php /var/www/phpipam/functions/scripts/discoveryCheck.php# crontab -l Reference https://github.com/phpipam/phpipam https://phpipam.net/documents/installation/ https://phpipam.net/news/phpipam-on-nginx/ https://computingforgeeks.com/install-and-configure-phpipam-on-ubuntu-debian-linux/","categories":[{"name":"Linux","slug":"Linux","permalink":"https://kenryu.cc/zh/categories/Linux/"}],"tags":[]},{"title":"ZFSå¸¸ç”¨å‘½ä»¤","slug":"ZFS/ZFSå¸¸ç”¨å‘½ä»¤","date":"2022-02-28T06:52:32.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2022/02/28/ZFS/ZFSå¸¸ç”¨å‘½ä»¤/","link":"","permalink":"https://kenryu.cc/zh/2022/02/28/ZFS/ZFS%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/","excerpt":"","text":"1. åˆ›å»ºpoolå’ŒZFSæ–‡ä»¶ç³»ç»Ÿ åˆ›å»ºåä¸º â€œtankâ€ çš„å­˜å‚¨æ±  (type: ,mirror,raidz,raidz2,raidz3) 1# zpool create tank &lt;type&gt; sdb sdc sdd sde æ³¨æ„ï¼š Linuxçš„å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œsdaï¼Œsdbï¼Œsdcå¹¶æ²¡æœ‰æŒ‰ç…§slotçš„é¡ºåºæ’åˆ—ï¼Œæ˜¯ä¹±åºçš„ã€‚ 1find -L /dev/disk/by-id -samefile /dev/sda å‘æ± ä¸­æ·»åŠ æ›´å¤šç©ºé—´ æ± (pool)ä¸­çš„å…¶ä»–ç©ºé—´(vdev)è¦ç›¸åŒtypeï¼Œç›¸åŒæ•°é‡ã€‚å¦åˆ™å‡ºç°â€mismatched replication levelâ€é”™è¯¯ã€‚ 1# zpool add tank mirror sdf sdg åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿï¼ŒæŒ‚è½½åœ¨ &#x2F;export&#x2F;home ä¸‹ 123# zfs create tank/home# df -Th# zfs set mountpoint=/export/home tank/home ä¸ºå¤šä¸ªç”¨æˆ·åˆ›å»ºèµ·å§‹ç›®å½•t&gt; è¯·æ³¨æ„ï¼šç”±äºç»§æ‰¿è€Œè‡ªåŠ¨æŒ‚è½½åœ¨ &#x2F;export&#x2F;home&#x2F;{ahrens,bonwick,billm} ä¸‹ 123# zfs create tank/home/ahrens# zfs create tank/home/bonwick# zfs create tank/home/billm ä¿®æ”¹æ–‡ä»¶ç³»ç»Ÿåç§° 1# zfs rename tank/home/ahrens tank/home/nahrens åˆ é™¤æ–‡ä»¶ç³»ç»Ÿ 1# zfs destroy -Rf tank/fs ä¿®æ”¹å­˜å‚¨æ± çš„åç§° 123# zpool export tank# zpool import tank newpool 2. è®¾ç½®å±æ€§ è‡ªåŠ¨ä»¥ NFS æ–¹å¼å…±äº«è¯¥æ–‡ä»¶ç³»ç»Ÿ1# zfs set sharenfs=rw tank/home å¯¹æ–‡ä»¶ç³»ç»Ÿä¸­æ‰€æœ‰æ•°æ®å¯ç”¨å‹ç¼©1# zfs set compression=on tank å°†ç”¨æˆ· Açš„æœ€å¤§ç©ºé—´é™åˆ¶ä¸º 10g1# zfs set quota=10g tank/home/userA ä¿è¯ç”¨æˆ· Bæœ‰ 20g çš„é¢„ç•™ç©ºé—´1# zfs set reservation=20g tank/home/userB å¯é€šè¿‡å‘½ä»¤æŸ¥è¯¢æ–‡ä»¶ç³»ç»Ÿçš„æ‰€æœ‰å±æ€§1# zfs get all tank/home å¯é€šè¿‡å‘½ä»¤æŸ¥è¯¢å­˜å‚¨æ± çš„æ‰€æœ‰å±æ€§1# zpool get all tank å¤§å¤šæ•°å±æ€§å¯é€šè¿‡ç»§æ‰¿æ–¹å¼è‡ªåŠ¨è®¾ç½® 1# zfs inherit &lt;property&gt; tank/home/eschrock 3. ZFS snapshot æ–‡ä»¶ç³»ç»Ÿçš„åªè¯»å‰¯æœ¬å³æ—¶åˆ›å»ºã€æ•°é‡ä¸é™,ä¸å ç”¨é¢å¤–ç©ºé—´ - å—ä»…åœ¨å‘ç”Ÿæ›´æ”¹æ—¶æ‰ä¼šè¢«å¤åˆ¶å¯é€šè¿‡æ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿæ ¹ç›®å½•ä¸‹çš„ .zfs&#x2F;snapshot è®¿é—®ä½¿ç”¨æˆ·å¯åœ¨æ²¡æœ‰ç³»ç»Ÿç®¡ç†å‘˜ä»‹å…¥çš„æƒ…å†µä¸‹æ¢å¤æ–‡ä»¶å¯¹ç”¨æˆ·ï¼¡ çš„èµ·å§‹ç›®å½•æ‰§è¡Œå¿«ç…§æ•è·1# zfs snapshot tank/home/usera@tuesday å›æ»šåˆ°å‰ä¸€ä¸ªå¿«ç…§1# zfs rollback tank/home/usera@monday æŸ¥çœ‹æ˜ŸæœŸä¸‰çš„ foo.c ç‰ˆæœ¬1$ cat /tank/home/usera/.zfs/snapshot/wednesday/foo.c åˆ é™¤å¿«ç…§1# zfs destroy -R tank/home/usera@monday 4. ZFS Clone å¿«ç…§çš„å¯å†™å‰¯æœ¬å³æ—¶åˆ›å»ºã€æ•°é‡ä¸é™å­˜å‚¨å¤§éƒ¨åˆ†ä¸ºå…±äº«æ•°æ®çš„ä¼—å¤šä¸“ç”¨å‰¯æœ¬çš„ç†æƒ³æ–¹æ³•è½¯ä»¶å®‰è£…å·¥ä½œåŒºæ— ç›˜å®¢æˆ·æœº åˆ›å»º OpenSolaris æºä»£ç çš„å…‹éš† 1# zfs clone tank/solaris@monday tank/ws/lori/fix 5. ZFS send&#x2F;receive åŸºäºå¿«ç…§ç‚¹å®Œæ•´å¤‡ä»½ï¼šä»»ä½•å¿«ç…§å¢é‡å¤‡ä»½ï¼šä»»ä½•å¿«ç…§å¢é‡é€Ÿåº¦å¾ˆå¿« - å¼€é”€ä¸æ›´æ”¹çš„æ•°æ®æˆæ¯”ä¾‹éå¸¸é«˜æ•ˆï¼Œå¯æ‰§è¡Œè¿œç¨‹å¤åˆ¶ ç”Ÿæˆå®Œæ•´å¤‡ä»½ 1# zfs send tank/fs@A &gt;/backup/A ç”Ÿæˆå¢é‡å¤‡ä»½ 1# zfs send -i tank/fs@A tank/fs@B &gt;/backup/B-A è¿œç¨‹å¤åˆ¶ï¼šæ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡å¢é‡ 1# zfs send -i tank/fs@11:31 tank/fs@11:32 | ssh host zfs receive -d /tank/fs 6. ZFS æ•°æ®è¿ç§» ç‹¬ç«‹äºä¸»æœºçš„ç£ç›˜æ ¼å¼å°†æœåŠ¡å™¨ä» x86 æ›´æ”¹ä¸º SPARCï¼Œä¹Ÿèƒ½è¿è¡Œè‡ªé€‚åº”å­—èŠ‚å­˜å‚¨é¡ºåº (Adaptive endianness)ï¼šåœ¨ä¸¤ä¸ªå¹³å°ä¸Šéƒ½æ— éœ€é¢å¤–æˆæœ¬å†™å…¥æ€»æ˜¯ä½¿ç”¨æœ¬åœ°å­—èŠ‚å­˜å‚¨é¡ºåº (native endianness)ï¼Œåœ¨å—æŒ‡é’ˆä¸­è®¾ç½®ä½ä»…å½“ä¸»æœºå­—èŠ‚å­˜å‚¨é¡ºåº (endianness) !&#x3D; å—å­—èŠ‚å­˜å‚¨é¡ºåºæ—¶ï¼Œæ‰ä¼šé’ˆå¯¹è¯»å–è¿›è¡Œå­—èŠ‚äº¤æ¢ ZFS è´Ÿè´£æ‰€æœ‰å¤„ç†æ— éœ€è€ƒè™‘è®¾å¤‡è·¯å¾„ã€é…ç½®æ–‡ä»¶ã€&#x2F;etc&#x2F;vfstab ç­‰ç­‰ZFS ä¼šåœ¨å¿…è¦æ—¶è¿›è¡Œå…±äº«&#x2F;å–æ¶ˆå…±äº«ã€æŒ‚è½½&#x2F;å–æ¶ˆæŒ‚è½½ç­‰ç­‰ ä»æ—§æœåŠ¡å™¨ä¸Šå¯¼å‡ºæ± tank 1old# zpool export tank ç‰©ç†ç§»åŠ¨ç£ç›˜å¹¶å°†æ± å¯¼å…¥åˆ°æ–°æœåŠ¡å™¨ä¸­ 1new# zpool import tank 7. è®¾å¤‡ç®¡ç† æ·»åŠ &#x2F;æ›¿æ¢æ–°è®¾å¤‡ (type: ,mirror,raidz,raidz2,raidz3) 123# zpool add tank &lt;type&gt; c0t2d0 c0t3d0 c0t4d0# zpool replace tank c0t1d0 c0t2d0 æ·»åŠ &#x2F;ç§»é™¤é•œåƒè®¾å¤‡ 12# zpool attach tank c0t1d0 c0t2d0# zpool detach tank c0t2d0 å°†è®¾å¤‡åœæ­¢æˆ–æ‰‹å·¥å¯åŠ¨ 12# zpool offline tank c0t2d0# zpool online tank c0t2d0 æŸ¥çœ‹å­˜å‚¨æ± å½“å‰çŠ¶æ€å’Œ I&#x2F;O çŠ¶å†µ 12# zpool status -v tank# zpool iostat tank 1 æ·»åŠ çƒ­å¤‡è®¾å¤‡ 1# zpool add tank spare c0t2d0 æŒ‡å®šçƒ­å¤‡å¯åŠ¨&#x2F;åœæ­¢çƒ­å¤‡ 12# zpool replace tank c0t1d0 c0t2d0# zpool detach tank c0t2d0 å°†çƒ­å¤‡è®¾å¤‡åˆ é™¤ 1# zpool remove tank c0t2d0 æ·»åŠ &#x2F;åˆ é™¤ç‹¬ç«‹çš„æ—¥å¿—è®¾å¤‡ï¼ˆæ€§èƒ½æ”¹å–„ï¼‰ 12# zpool add tank log c0t3d0# zpool remove tank c0t3d0 8. ZFS æƒé™ç®¡ç† å¯ä»¥å°†zfs(1M) çš„ç®¡ç†æƒé™åˆ†æ´¾ç»™æ™®é€šç”¨æˆ· 12 &#x27;zfs allow&#x27; &#x27;zfs unallow&#x27; å°†æƒé™æˆäºˆä¸€ä¸ªæ™®é€šç”¨æˆ· 1# zfs allow marks create,snapshot tank/marks å°†æŒ‡å®šæƒé™å›æ”¶ 1# zfs unallow marks create,snapshot tank/marks æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿå½“å‰çš„æƒé™ 1# zfs allow tank/marks 9. å…¶å®ƒå‘½ä»¤ æ˜¾ç¤ºå­˜å‚¨æ± æ‰€æœ‰æ“ä½œå†å²è®°å½•1# zpool history tank å‡çº§å­˜å‚¨æ± åˆ°æŒ‡å®š SPA ç‰ˆæœ¬1# zpool upgrade -V &lt;version&gt; tank å‡çº§æ–‡ä»¶ç³»ç»Ÿåˆ°æŒ‡å®š ZPL ç‰ˆæœ¬1# zfs upgrade -V &lt;version&gt; tank/fs æ‰‹å·¥æŒ‚è½½&#x2F;å¸è½½æ–‡ä»¶ç³»ç»Ÿ123# zfs mount -a# zfs unmount tank/fs# zfs unmount -a å‚è€ƒ ZFSå¸¸ç”¨å‘½ä»¤","categories":[{"name":"ZFS","slug":"ZFS","permalink":"https://kenryu.cc/zh/categories/ZFS/"}],"tags":[{"name":"Server","slug":"Server","permalink":"https://kenryu.cc/zh/tags/Server/"},{"name":"ZFS","slug":"ZFS","permalink":"https://kenryu.cc/zh/tags/ZFS/"},{"name":"Storage","slug":"Storage","permalink":"https://kenryu.cc/zh/tags/Storage/"}]},{"title":"Setup WebDAV server (Apache)","slug":"File_Sharing_Servers/Setup_WebDAV_server__Apache_","date":"2021-12-15T12:17:52.000Z","updated":"2025-12-19T08:19:46.062Z","comments":true,"path":"2021/12/15/File_Sharing_Servers/Setup_WebDAV_server__Apache_/","link":"","permalink":"https://kenryu.cc/zh/2021/12/15/File_Sharing_Servers/Setup_WebDAV_server__Apache_/","excerpt":"","text":"Premise Installed Apache . Installed SSL&#x2F;TLS server Private key &amp; Certificate. Disabled SELinux. Allowed Firewall. Enviroment1234567[root@rhel8 ~]# cat /etc/redhat-releaseRed Hat Enterprise Linux release 8.5 (Ootpa)[root@rhel8 ~]# httpd -vServer version: Apache/2.4.37 (Red Hat Enterprise Linux)Server built: Oct 26 2021 14:18:06[root@rhel8 ~]# smbstatus --versionVersion 4.14.5 Make Share Folder123mkdir -p /sharechmod -R 775 /sharechown -R apache. /share Configure WebDAVCreate new config file follwing:1234567891011121314151617181920vim /etc/httpd/conf.d/webdav.conf# create new&lt;IfModule mod_dav_fs.c&gt;DAVLockDB /var/lib/dav/lockdb&lt;/IfModule&gt;Alias /share /share&lt;Location /share&gt;DAV OnSSLRequireSSLOptions NoneAuthType BasicAuthName WebDAVAuthUserFile /etc/httpd/conf/.htpasswd&lt;RequireAny&gt;Require method GET POST OPTIONSRequire valid-user&lt;/RequireAny&gt;&lt;/Location&gt; Create WebDAV User Note: This user is not your operating systemâ€™s user. 1234htpasswd -c /etc/httpd/conf/.htpasswd &lt;InputYourUserName&gt;New password: &lt;InputYourPassword&gt;Re-type new password: &lt;InputYourPassword&gt;Adding password for user &lt;HereIsYourUserName&gt; (Optional) Edit Apache run userIt doesnâ€™t work. 1234567vim /etc/httpd/conf/httpd.conf69 #User apache70 #Group apache71 User cjl72 Group cjl Start Apache1systemctl enable --now httpd (Optional) Configure SMBWhen we want SMB to coexist with WebDAV. 12345678910111213141516171819vim /etc/samba/smb.conf[global]workgroup = WORKGROUPsecurity=usermap to guest =Bad User#æ·»åŠ åä¸ºshareçš„å…±äº«æ–‡ä»¶å¤¹[share]comment = share allpath = /sharebrowseable = yespublic = yeswritable = yescreate mode = 0744force create mode = 0744directory mode = 0744force directory mode = 0744force user = apache 1systemctl restart smb WebDAV ClientWindows111net use W: https://192.168.64.84:10443/share /user:cjh Passw0rd æ³¨ï¼šæ­¤æ—¶è¯¥ä½¿ç”¨ç‡ä¸º C ç›˜ä½¿ç”¨ç‡ ] å…å¯†ç ç™»å½• å‚è€ƒï¼šhttps://httpd.apache.org/docs/2.4/mod/mod_dav.html 1234567891011121314151617vim /etc/httpd/conf.d/webdav.conf# create newDAVLockDB /var/lib/dav/lockdbAlias /share /share&lt;Directory &quot;/share&quot;&gt;Require all grantedDav OnAuthType BasicAuthName DAVAuthUserFile &quot;user.passwd&quot;&lt;LimitExcept GET POST OPTIONS&gt;Require user admin&lt;/LimitExcept&gt;&lt;/Directory&gt;","categories":[{"name":"File Sharing Servers","slug":"File-Sharing-Servers","permalink":"https://kenryu.cc/zh/categories/File-Sharing-Servers/"}],"tags":[]},{"title":"SMART Monitoring Tools","slug":"Storage/SMART_Monitoring_Tools","date":"2021-12-11T03:09:02.000Z","updated":"2025-12-19T08:19:46.062Z","comments":true,"path":"2021/12/11/Storage/SMART_Monitoring_Tools/","link":"","permalink":"https://kenryu.cc/zh/2021/12/11/Storage/SMART_Monitoring_Tools/","excerpt":"","text":"Objectives Self-Monitoring, Analysis and Reporting Technology. Logging SMART errors and changes via the SYSLOG interface. Send email warnings if problems are detected. Make HDD enclosure LED blinking. Descriptionssmartmontoolssmartctl controls the Self-Monitoring, Analysis and Reporting Technology (SMART) system built into most ATA&#x2F;SATA and SCSI&#x2F;SAS hard drives and solid-state drives. The purpose of SMART is to monitor the reliability of the hard drive and predict drive failures, and to carry out different types of drive self-tests. smartctl also supports some features not related to SMART. This version of smartctl is compatible with ACS-3, ACS-2, ATA8-ACS, ATA&#x2F;ATAPI-7 and earlier standards (see REFERENCES below). ledmonThe ledctl is an user space application designed to control LEDs associated with each slot in an enclosure or a drive bay. The LEDs of devices listed in list_of_devices are set to the given pattern pattern_name and all other LEDs are turned off. User must have root privileges to use this application. InstallationInstall SMART monitor tool and set it to start automatically when OS start-up. 12dnf -y install smartmontoolssystemctl enable --now ledmon.service Install LEDâ€™s controller tool and set it to start automatically when OS start-up. 12dnf -y install ledmonsystemctl enable --now smartd.service ConfigurationsmartmontoolsSend Error massege via SMTP 123vim /etc/smartmontools/smartd.conf# Specify SMTP server and accounds. Maintenance Note: Not recommented to use &#x2F;dev&#x2F;sdX to specify HDD. 12smartctl --scansmartctl /dev/sda -i The following example illustrates how to locate a single block device. 1ledctl locate=/dev/disk/by-id/wwn-0x5000039b0810bcd9 The following example illustrates how to turn Locate LED off for the same block device. ledctl locate_off=/dev/disk/by-id/wwn-0x5000039b0810bcd9","categories":[{"name":"Storage","slug":"Storage","permalink":"https://kenryu.cc/zh/categories/Storage/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://kenryu.cc/zh/tags/linux/"},{"name":"server","slug":"server","permalink":"https://kenryu.cc/zh/tags/server/"},{"name":"storage","slug":"storage","permalink":"https://kenryu.cc/zh/tags/storage/"}]},{"title":"Deploy Nginx, MySQL, PHP on Linux (LEMP/LNMP stack)","slug":"Linux/Deploy-Linux-Nginx-MySQL-PHP-Server","date":"2021-11-21T15:00:00.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2021/11/22/Linux/Deploy-Linux-Nginx-MySQL-PHP-Server/","link":"","permalink":"https://kenryu.cc/zh/2021/11/22/Linux/Deploy-Linux-Nginx-MySQL-PHP-Server/","excerpt":"","text":"Name Version Command Linux Rocky Linux release 8.5 (Green Obsidian) cat &#x2F;etc&#x2F;os-release &#x2F;etc&#x2F;redhat-release &#x2F;etc&#x2F;system-release Nginx nginx version: nginx&#x2F;1.20.2 nginx -v MySQL mysql Ver 8.0.28 for Linux on x86_64 (MySQL Community Server - GPL) mysql â€“version PHP PHP 7.4.29 (cli) (built: Apr 12 2022 10:55:38) ( NTS ) php -v 0. PreparationCheck if old packages have been installed. 1# rpm -qa | grep -E &quot;nginx|php|mariadb&quot; If they are installed, remove them. 123# yum remove -y &quot;nginx*&quot;# yum remove -y &quot;php*&quot;# yum remove -y &quot;mariadb*&quot; 1. Add repositories1.1 Add Nginx Official repositoryCreate and edit the following file. 1# vim /etc/yum.repos.d/nginx.repo 12345678[nginx]name=nginx stable repobaseurl=http://nginx.org/packages/centos/$releasever/$basearchgpgcheck=1enable=1gpgkey=https://nginx.org/keys/nginx_signing.keymodule_hotfixes=trueenabled=1 12# yum-config-manager --enable nginx# dnf config-manager --enable nginx 1.2 Add MySQL Official repositoriesDownload and install repositories form : MySQL Community Downloads 123# dnf -y install https://repo.mysql.com//mysql80-community-release-el8-3.noarch.rpm# dnf config-manager --enable mysql80-community# yum repolist all | grep mysql 1.3 Add PHP repositoryExecute the following commands in sequence to add and update epel repository. 12# dnf install -y https://rpms.remirepo.net/enterprise/remi-release-8.rpm# dnf module enable php:remi-7.4 -y 2. Installation2.1 Install Nginx12# dnf -y install nginx# nginx -v 2.2 Install MySQL123# yum module disable mysql -y# yum install mysql-community-server -y# mysql -V 2.3 Install PHP12# dnf install php php-curl php-dom php-exif php-fileinfo php-fpm php-gd php-hash php-json php-mbstring php-mysqli php-openssl php-pcre php-xml libsodium php-ldap php-pdo php-pear php-snmp php-xml -y# php -v 3. Configuration3.1 Configure Nginx1# systemctl enable --now nginx 12# mv /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf.bak# vim default.conf 12345678910111213location / &#123;root /usr/share/nginx/html;- index index.html index.htm;+ index index.html index.htm index.php;&#125;location ~ .php$ &#123;root /usr/share/nginx/html;fastcgi_pass unix:/run/php-fpm/www.sock;fastcgi_index index.php;fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;include fastcgi_params;&#125;## Edit this file according to actual usage. 3.2 Configure MySQLStart and set enabled the MySQL server 1# systemctl enable --now mysqld A superuser account â€˜rootâ€˜@â€™localhostâ€™ is created. A password for the superuser is set and stored in the error log file. To reveal it, use the following command: 1# grep &#x27;temporary password&#x27; /var/log/mysqld.log 12# mysql -uroot -pmysql&gt; ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;Your_Password&#x27;; MySQLâ€™s validate_password plugin is installed by default. This will require that passwords contain at least one uppercase letter, one lowercase letter, one digit, and one special character, and that the total password length is at least 8 characters. Reference siteA Quick Guide to Using the MySQL Yum Repository 3.3 Configure PHP1# vim /etc/php-fpm.d/www.conf 1234- user = apache+ user = nginx- group = apache+ group = nginx 1234# grep timezone /etc/php.ini; Defines the default timezone used by the date functions; http://php.net/date.timezonedate.timezone = Asia/Tokyo 1# systemctl enable --now php-fpm (Optional) Verify environment configurationExecute the following command to create test file. The root directory of the site that has been configured in /usr/share/nginx/html, This article uses thatdirectory as an example. 123# echo &quot;&lt;?php phpinfo(); ?&gt;&quot; &gt;&gt; /usr/share/nginx/html/index.php# nginx -t# nginx -s reload Modify the firewall policy to make the server can be accessed. 12# firewall-cmd --permanent --add-port=&#123;443/tcp,80/tcp&#125;# firewall-cmd --reload Access the following address in your browser.http://your_lnmp_server_iphttp://your_lnmp_server_ip/index.php If the results are displayed as above, the environment is successfully configured.","categories":[{"name":"Linux","slug":"Linux","permalink":"https://kenryu.cc/zh/categories/Linux/"}],"tags":[{"name":"Server","slug":"Server","permalink":"https://kenryu.cc/zh/tags/Server/"},{"name":"Nginx","slug":"Nginx","permalink":"https://kenryu.cc/zh/tags/Nginx/"},{"name":"MySQL","slug":"MySQL","permalink":"https://kenryu.cc/zh/tags/MySQL/"},{"name":"PHP","slug":"PHP","permalink":"https://kenryu.cc/zh/tags/PHP/"}]},{"title":"æ­å»ºOpenVPN Over FRP","slug":"Network/æ­å»ºOpenVPN_Over_FRP","date":"2021-10-31T05:08:47.000Z","updated":"2025-12-19T08:19:46.062Z","comments":true,"path":"2021/10/31/Network/æ­å»ºOpenVPN_Over_FRP/","link":"","permalink":"https://kenryu.cc/zh/2021/10/31/Network/%E6%90%AD%E5%BB%BAOpenVPN_Over_FRP/","excerpt":"","text":"å‰è¨€åœ¨å­¦æ ¡æˆ–è€…å…¬å¸å¤–éƒ¨çš„ï¼Œæˆ–è€…å‡ºå·®åœ¨å¤–åœ°ï¼Œæƒ³è®¿é—®å­¦æ ¡æˆ–è€…å…¬å¸å†…ç½‘çš„æœåŠ¡å™¨ï¼Œä½†æ˜¯æ²¡ç”¨ç½‘ç»œç®¡ç†å‘˜çš„æƒé™ï¼Œæˆ–è€…ç½‘ç»œç®¡ç†å‘˜ä¸é…åˆè®¾å®šçš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•çªç ´NATç½‘ç»œé˜²ç«å¢™ï¼Œè¾¾åˆ°è®¿é—®å†…éƒ¨ç½‘ç»œã€‚è¿™æ˜¯æ­å»ºè¿™ä¸ªæœåŠ¡çš„ç›®çš„ã€‚ å…³äºfrp A fast reverse proxy to help you expose a local server behind a NAT or firewall to the internet. https://github.com/fatedier/frp å®ƒæ˜¯ä¸€ä¸ªåå‘ä»£ç†ç¨‹åºã€‚å®ƒå¯ä»¥å°†å€ŸåŠ©å­˜åœ¨äºå…¬ç½‘ä¸Šçš„ä»£ç†æœåŠ¡å™¨ï¼Œä¸­ç»§ NAT å’Œé˜²ç«å¢™åé¢çš„æœåŠ¡ï¼Œå®ç°å†…ç½‘ç©¿é€ï¼ˆNAT Traversalã€ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«é€éï¼†è²«é€šï¼‰çš„ä¸€ç§æ‰‹æ®µã€‚ åœ¨æ¥ä¸‹æ¥æ­å»ºå¥½çš„ProxyæœåŠ¡å™¨ä¸­ï¼Œsockstatå‘½ä»¤ï¼ˆæ‘˜å½•ï¼›è€ƒè™‘éšç§å…¬ç½‘IPéšä¾¿å†™çš„ï¼‰ä¸­å¯ä»¥äº†è§£åˆ°ï¼š 12345678910111213[2.5.2-RELEASE][root@Proxy]/root: sockstat | grep frp# ç›‘å¬7000ç«¯å£root frps 67615 3 tcp46 *:7000 *:*# åœ¨å†…ç½‘çš„Proxy Serverç»è¿‡è·¯ç”±NATè½¬æ¢ä¹‹åçš„å…¬ç½‘IPä¸Proxy Serverè¿›è¡Œäº†è¿æ¥root frps 67615 11 tcp4 110.120.119.1:7000 119.120.110.1:61662# ç›‘å¬6000ç«¯å£ï¼ˆSSHæœåŠ¡ï¼‰root frps 67615 10 tcp46 *:6000 *:*# æ¥å—äº†å®¢æˆ·ç«¯çš„è¿æ¥root frps 67615 14 tcp4 110.120.119.1:6000 192.168.10.10:68623# ç›‘å¬1194ç«¯å£ï¼ˆOpenVPNæœåŠ¡ï¼‰root frps 67615 9 tcp46 *:1194 *:* Clientä¸Proxyå»ºç«‹è¿æ¥ï¼ŒReverse Proxyä¹Ÿä¸Proxyå»ºç«‹è¿æ¥ï¼Œé€šè¿‡è¿™ç§å›´é­æ•‘èµµçš„æ–¹å¼å®ç°Clientä¸Reverse Proxyå»ºç«‹è¿æ¥ã€‚ ä»¥ä¸‹æ˜¯ä½¿ç”¨frpåå‘ä»£ç†openvpnçªç ´é˜²ç«å¢™çš„ä¸€ä¸ªdemoã€‚ 0. demoç¯å¢ƒ Host OS Service IP Allow Port (Inbound) Reverse Proxy Server CentOS Linux release 8.4.2105 frpc (frp_0.38.0_linux_amd64), openvpn P:172.16.10.10 (G:119.120.110.1) &#x2F; Proxy Server FreeBSD 12.2-STABLE frps (frp_0.38.0_freebsd_amd64) 110.120.119.1 #7000(from RPS) &amp; #6000(from client) &amp; #1194(from client) Client macOS openvpn-client 192.168.10.10 &#x2F; OSåŸºæœ¬å¯ä»¥æ— è§†ï¼Œå› ä¸ºä¸ç®¡æ˜¯frpæˆ–è€…OpenVPNåŸºæœ¬å…¨å¹³å°é€‚é… 1. éƒ¨ç½²Reverse Proxy Serveråœ¨æƒ³è¦çªç ´çš„å†…ç½‘ç¯å¢ƒï¼ˆå…¬å¸ï¼Œå­¦æ ¡ï¼‰çš„æœºå™¨ä¸Šå®‰è£…å¿…è¦çš„frpï¼Œå’Œå…¶ä»–æœåŠ¡è¿™é‡Œç”¨openvpnæ¼”ç¤ºã€‚é˜²ç«å¢™ç­–ç•¥å…è®¸outboundã€‚ 1.1 éƒ¨ç½²frpcç›®å‰å¯ä»¥åœ¨ Github çš„ Release é¡µé¢ä¸­ä¸‹è½½åˆ°æœ€æ–°ç‰ˆæœ¬çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ https://github.com/fatedier/frp/releases/ 12wget https://github.com/fatedier/frp/releases/download/v0.38.0/frp_0.38.0_linux_amd64.tar.gz 1.1.1 è§£å‹å®‰è£…åŒ…è§£å‹ç¼©ä¸‹è½½çš„å‹ç¼©åŒ…ï¼Œ æ”¾ç½®åœ¨ä»»æ„ç›®å½•ã€‚ 12tar -zxvf frp_0.38.0_linux_amd64.tar.gzcd frp_0.38.0_linux_amd64 è¿™é‡Œï¼ˆReverse Proxy Serverï¼‰ä¸Šåªç”¨åˆ°frpcç›¸å…³çš„æ–‡ä»¶ï¼Œfrpsç”¨ä¸åˆ°ã€‚ 1.1.2 é…ç½®ä»¥åŠå¯åŠ¨æœåŠ¡12345678910[root@ServerC /]# cat frpc.ini[common]server_addr = 110.120.119.1 # Proxy Serverçš„å…¬ç½‘IPserver_port = 7000 # Proxy Serverä¸Šçš„frpsç›‘å¬frpcè¿æ¥çš„ç«¯å£[ssh]type = tcplocal_ip = 127.0.0.1 # æŒ‡å‘æœ¬æœºIPlocal_port = 22 # æŒ‡å‘æœ¬æœºçš„SSHç«¯å£remote_port = 6000 # Proxy Serverç›‘å¬çš„ç«¯å£ã€‚ä¹‹åClientå¯ä»¥é€šè¿‡è®¿é—®Proxy Serverçš„6000ç«¯å£ï¼Œç«¯å£è½¬å‘åˆ°ä¸Šé¢çš„æœ¬æœºç«¯å£ é€šè¿‡ ./frpc -c ./frpc.ini &amp; å¯åŠ¨æœåŠ¡ç«¯ã€‚ 1234[root@cjl-docker frp_0.37.1_linux_amd64]# ./frpc -c ./frpc.ini2021/08/25 00:00:40 [I] [service.go:304] [a0e6112664ab2527] login to server success, get run id [a0e6112664ab2527], server udp port [0]2021/08/25 00:00:40 [I] [proxy_manager.go:144] [a0e6112664ab2527] proxy added: [ssh]2021/08/25 00:00:40 [I] [control.go:180] [a0e6112664ab2527] [ssh] start proxy success å¦‚æœéœ€è¦åœ¨åå°é•¿æœŸè¿è¡Œï¼Œå»ºè®®ç»“åˆå…¶ä»–å·¥å…·ä½¿ç”¨ï¼Œä¾‹å¦‚ systemd å’Œ supervisorã€‚ 1.1.3 éƒ¨ç½²openvpnè¿™é‡Œä¸åšæ¼”ç¤ºäº†ï¼Œè¯¦ç»†è¯·å‚é˜…æ­å»ºopenvpnæ•™ç¨‹ã€‚ å¦‚ä½•åœ¨ CentOS 8 ä¸Šè®¾ç½®å’Œé…ç½® OpenVPN æœåŠ¡å™¨ 2. æ­å»ºProxy Serveråœ¨ç”¨æœ‰å…¬ç½‘IPçš„æœºå™¨å®‰è£…frpsæœåŠ¡ï¼Œè®¾å®šå¥½é˜²ç«å¢™ã€‚è¿™é‡Œç”¨çš„æ˜¯FreeBSDï¼Œå…¬ç½‘IPä¸º110.120.119.1ï¼Œé˜²ç«å¢™ç­–ç•¥ä¸ºï¼šå…è®¸æ¥è‡ªReverse Proxy Serverå…¬ç½‘IPçš„è¿æ¥ï¼Œå’Œå…è®¸æ¥è‡ªClientçš„è¿æ¥ã€‚ 2.1 ä¸‹è½½å®‰è£…åŒ…ç›®å‰å¯ä»¥åœ¨ Github çš„ Release é¡µé¢ä¸­ä¸‹è½½åˆ°æœ€æ–°ç‰ˆæœ¬çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ‰€æœ‰æ–‡ä»¶è¢«æ‰“åŒ…åœ¨ä¸€ä¸ªå‹ç¼©åŒ…ä¸­ã€‚ https://github.com/fatedier/frp/releases/tag/v0.37.1 1wget https://github.com/fatedier/frp/releases/download/v0.37.1/frp_0.37.1_linux_amd64.tar.gz 2.2 è§£å‹å®‰è£…åŒ…è§£å‹ç¼©ä¸‹è½½çš„å‹ç¼©åŒ…ï¼Œæ”¾ç½®åœ¨ä»»æ„ç›®å½•ã€‚ 1tar -xzvf frp_0.37.1_linux_amd64.tar.gz Proxyåªç”¨åˆ°frpsã€‚ 2.3 é…ç½®æ–‡ä»¶ä»¥åŠå¯åŠ¨æœåŠ¡ç¼–å†™é…ç½®æ–‡ä»¶ 1234cat frp_0.37.1_linux_amd64/frps.ini---[common]bind_port = 7000 é€šè¿‡ ./frps -c ./frps.ini &amp; å¯åŠ¨æœåŠ¡ç«¯ï¼Œä¹‹åå†é€šè¿‡ ss -ntul æŸ¥çœ‹æ˜¯å¦å¼€å¯ç›‘å¬7000ç«¯å£ã€‚å¦‚æœéœ€è¦åœ¨åå°é•¿æœŸè¿è¡Œï¼Œå»ºè®®ç»“åˆå…¶ä»–å·¥å…·ä½¿ç”¨ï¼Œä¾‹å¦‚ systemd å’Œ supervisorã€‚ 2.4 é…ç½®é˜²ç«å¢™ ç­–ç•¥1ï¼šè®©Proxyçš„7000ç«¯å£æš´éœ²åœ¨å…¬ç½‘ä¸Šï¼Œæ‰èƒ½è®©Reverse Proxyç»è¡Œæ¡æ‰‹è¿æ¥ã€‚ ç­–ç•¥2ï¼š6000ç«¯å£è¦æš´éœ²ç»™Clientã€‚ å…·ä½“è®¾ç½®çš„è¯è¦æ ¹æ®æƒ…å†µä¸åŒï¼Œå¦‚æœProxyæˆ–è€…Clientä¹Ÿç»è¿‡NATï¼Œè·¯ç”±æˆ–è€…é˜²ç«å¢™çš„è¯ï¼Œé™¤äº†æœ¬æœºé˜²ç«ä¹‹å¤–ï¼Œè·¯ç”±å™¨çš„é˜²ç«å¢™ä¹Ÿè¦è®¾å®šã€‚ 3. æµ‹è¯•ä»¥åŠä½¿ç”¨3.1 å¼€å¯æœåŠ¡åè¿›è¡Œç«¯å£æ‰«æï¼šå…ˆå¼€å¯frpsï¼Œå†å¼€å¯frpcã€‚å½“frpcè¿æ¥ä¸Šfrpsçš„æ—¶å€™ï¼Œfrpsçš„6000å·ç«¯å£æ‰ä¼šå¼€å¯äº†ç›‘å¬ã€‚ æ–¹æ³•1åœ¨çº¿ç«¯å£æ‰«æhttps://www.cman.jp/network/support/go_port.cgi æ–¹æ³•2é€šè¿‡nmapå·¥å…·ç«¯å£æ‰«æ 12nmap -p 7000 110.120.119.1nmap -p 6000 110.120.119.1 3.2 å¼€å§‹ä½¿ç”¨Server Aæˆ–è€…ä»»æ„è®¾å¤‡é€šè¿‡SSHè®¿é—®Server Bçš„6000ç«¯å£ï¼Œå³å¯è½¬å‘åˆ°Server Cçš„22ç«¯å£ï¼ 1ssh 110.120.119.1 -p 6000 æ€»ç»“å†…ç½‘æœåŠ¡å™¨ä¸Šéƒ¨ç½²frpcæœåŠ¡ï¼ˆå¯ä»¥è®¾ç½®ä¸ºsystemctlå¼€æœºè‡ªå¯ï¼‰ï¼Œä¸reverse proxyæœåŠ¡å™¨frpså»ºç«‹æ¡æ‰‹è¿æ¥ï¼Œé€šè¿‡SSHè®¿é—®frpsçš„ç«¯å£è½¬å‘ï¼Œæœ€ç»ˆè¾¾åˆ°è®¿é—®frpcæ‰€åœ¨æœåŠ¡å™¨çš„ç›®çš„ã€‚ å‚è€ƒ","categories":[{"name":"Network","slug":"Network","permalink":"https://kenryu.cc/zh/categories/Network/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://kenryu.cc/zh/tags/linux/"},{"name":"network","slug":"network","permalink":"https://kenryu.cc/zh/tags/network/"},{"name":"vpn","slug":"vpn","permalink":"https://kenryu.cc/zh/tags/vpn/"}]},{"title":"SSL Certificates generation (On Linux use OpenSSL PKI)","slug":"Security/SSL_Certificates_generation__On_Linux_use_OpenSSL_PKI_","date":"2021-10-28T12:17:38.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2021/10/28/Security/SSL_Certificates_generation__On_Linux_use_OpenSSL_PKI_/","link":"","permalink":"https://kenryu.cc/zh/2021/10/28/Security/SSL_Certificates_generation__On_Linux_use_OpenSSL_PKI_/","excerpt":"","text":"[toc] Introduction Definitons PKI: Public Key InfrastructureSecurity architecture where trust is conveyed through the signature of a trusted CA. CA: Certificate AuthorityEntity issuing certificates and CRLs. TLS: ä¼ è¾“å±‚å®‰å…¨åè®® Transport Layer Securityçš„ç¼©å†™ SSL: å®‰å…¨å¥—æ¥å­—å±‚ Secure Socket Layerçš„ç¼©å†™ KEY: é€šå¸¸æŒ‡ç§é’¥Private keyã€‚ CSR: è¯ä¹¦ç­¾åè¯·æ±‚Certificate Signing Requestçš„ç¼©å†™ï¼Œå¯ä»¥ç®€å•ç†è§£æˆå…¬é’¥ï¼Œç”Ÿæˆè¯ä¹¦æ—¶è¦æŠŠè¿™ä¸ªæäº¤ç»™æƒå¨çš„è¯ä¹¦é¢å‘æœºæ„ã€‚ CRT: è¯ä¹¦Certificateçš„ç¼©å†™ CRL: è¯ä¹¦åŠé”€åˆ—è¡¨ Certificate Revocation Listsçš„ç¼©å†™ã€‚ X.509: æ˜¯ä¸€ç§è¯ä¹¦æ ¼å¼ã€‚å¯¹X.509è¯ä¹¦æ¥è¯´ï¼Œè®¤è¯è€…æ€»æ˜¯CAæˆ–ç”±CAæŒ‡å®šçš„äººï¼Œä¸€ä»½X.509è¯ä¹¦æ˜¯ä¸€äº›æ ‡å‡†å­—æ®µçš„é›†åˆï¼Œè¿™äº›å­—æ®µåŒ…å«æœ‰å…³ç”¨æˆ·æˆ–è®¾å¤‡åŠå…¶ç›¸åº”å…¬é’¥çš„ä¿¡æ¯ã€‚X.509çš„è¯ä¹¦æ–‡ä»¶ï¼Œä¸€èˆ¬ä»¥.crtç»“å°¾ï¼Œæ ¹æ®è¯¥æ–‡ä»¶çš„å†…å®¹ç¼–ç æ ¼å¼ï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹äºŒç§æ ¼å¼ï¼š t- PEM (Privacy Enhanced Mail)æ–‡æœ¬æ ¼å¼,ä»¥â€â€”BEGINâ€”â€œå¼€å¤´, â€œâ€”ENDâ€”â€œç»“å°¾,å†…å®¹æ˜¯BASE64ç¼–ç ã€‚Apacheå’ŒNginxæœåŠ¡å™¨åå‘äºä½¿ç”¨è¿™ç§ç¼–ç æ ¼å¼. t- DER (Distinguished Encoding Rules)äºŒè¿›åˆ¶æ ¼å¼,ä¸å¯è¯».Javaå’ŒWindowsæœåŠ¡å™¨åå‘äºä½¿ç”¨è¿™ç§ç¼–ç æ ¼å¼ OpenSSL ç›¸å½“äºSSLçš„ä¸€ä¸ªå®ç°ï¼Œå¦‚æœæŠŠSSLè§„èŒƒçœ‹æˆOOä¸­çš„æ¥å£ï¼Œé‚£ä¹ˆOpenSSLåˆ™è®¤ä¸ºæ˜¯æ¥å£çš„å®ç°ã€‚æ¥å£è§„èŒƒæœ¬èº«æ˜¯å®‰å…¨æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯å…·ä½“å®ç°å¯èƒ½ä¼šæœ‰ä¸å®Œå–„çš„åœ°æ–¹ï¼Œæ¯”å¦‚ä¹‹å‰çš„â€å¿ƒè„å‡ºè¡€â€æ¼æ´ï¼Œå°±æ˜¯OpenSSLä¸­çš„ä¸€ä¸ªbug. Prerequisites You have set up OpenSSL on your machine. You have established a process to sign trusted certificates. If you want to have the certificates signed by a certification authority, you have either established your own certification authority or you use an external certification authority. Alternatively, you can sign the generated certificate yourself. Procedure0. Edit OpenSSL conf file1234567891011121314151617181920212223242526272829303132333435363738394041424344cd /etc/pki/tls/cp openssl.cnf_org ca.confvim ca.conf[ ca ]default_ca = CA_default #56è¡Œã€ä½•ã‚‚å¤‰ã‚ã‚‰ãªã‹ã£ãŸ[ CA_default ]...x509_extensions = usr_cert #76è¡Œã€ä½•ã‚‚å¤‰ã‚ã‚‰ãªã‹ã£ãŸ...[ req ] #123è¡Œã‹ã‚‰default_bits = 2048# 125 default_md = sha256 #ã“ã®è¡Œã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆdefault_keyfile = privkey.pemdistinguished_name = req_distinguished_nameattributes = req_attributesx509_extensions = v3_careq_extensions = v3_req #130ã“ã®è¡Œã‚’è¿½è¨˜...[ usr_cert ]191 basicConstraints=CA:FALSE #ã‚³ãƒ¡ãƒ³ãƒˆã‚¤ãƒ³192 #basicConstraints=CA:TRUE #ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆnsComment = &quot;OpenSSL Generated Certificate&quot; #212è¡Œã€ä½•ã‚‚å¤‰ã‚ã‚‰ãªã‹ã£ãŸsubjectKeyIdentifier = hashauthorityKeyIdentifier=keyid,issuer:always #217è¡Œã€æœ€å¾Œã®`:always`ã‚’è¿½è¨˜subjectAltName = @alt_names #218è¡Œè¿½è¨˜[ v3_req ]basicConstraints = CA:FALSE #244è¡Œã€ä½•ã‚‚å¤‰ã‚ã‚‰ãªã‹ã£ãŸkeyUsage = nonRepudiation, digitalSignature, keyEncipherment #245è¡Œã€ä½•ã‚‚å¤‰ã‚ã‚‰ãªã‹ã£ãŸsubjectAltName = @alt_names #246è¡Œã€è¿½è¨˜[alt_names] #ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯å…ƒã€…å­˜åœ¨ã›ãšè¿½è¨˜ã™ã‚‹ã‚‚ã®DNS.1 = example.comDNS.2 = *.example.comIP.1 = 192.168.0.1IP.2 = 192.168.0.2 CSRã‚’ä½œã‚‹éš› 1234567[req] req_extensions = v3_reqâ†“[v3_req] subjectAltName = @alt_namesâ†“[alt_names]DNS.1 = ã‚µãƒ¼ãƒã®ãƒ‰ãƒ¡ã‚¤ãƒ³åIP.1 = ã‚µãƒ¼ãƒã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ ã¨ã„ã£ãŸæµã‚Œã§å‚ç…§ã—ã¾ã™ã€‚ã“ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ -config ã§æŒ‡å®šã—ã¦ CSR ã‚’ä½œã‚‹ã¨ã€CSR ã« X509v3 Subject Alternative Name:ã‚¨ãƒ³ãƒˆãƒªãŒå…¥ã‚Šã¾ã™ã€‚ 1. Generate Private Key &amp; CSR12345openssl req -new -newkey rsa:2048 -nodes -sha256 \\-subj &quot;/C=JP/ST=Saitama/L=Toda/O=Core Micro Systems, Inc./CN=cmsinc.co.jp/emailAddress=cjl@kensho.toda&quot; \\-config server.conf \\-keyout server.key \\-out server.csr View CSR details 1openssl req -noout -text -in /etc/pki/tls/server.csr 2. Signing Submit the CSR to the certification authority. Alternatively, sign the certificate yourself. 123456openssl ca -batch \\-keyfile /etc/pki/CA/private/cakey.pem \\-days 365 \\-config ca.conf \\-in server.csr \\-out server.crt View Certificateâ€™s details 1openssl x509 -text -noout -in server.crt OtherFile Convert1. Certificate1openssl x509 -in kvm-bmc.crt -out kvm-bmc.pem 2. KeyPublic key or Private key 1openssl rsa -in kvm-bmc.key -out kvm-bmc-private.pem CAã§ç™ºè¡Œã—ãŸã‚µãƒ¼ãƒè¨¼æ˜æ›¸ã‚’å¤±åŠ¹ã«ã™ã‚‹æ–¹æ³•1openssl ca -revoke /etc/pki/CA/newcerts/xxx.pem #replacing the serial number Trouble ShootingReference OpenSSL Essentials: Working with SSL Certificates, Private Keys and CSRs Chrome58ã§ã€HTTPSã®è‡ªå·±è¨¼æ˜æ›¸ãŒNET::ERR_CERT_COMMON_NAME_INVALID ã«ãªã‚‹å ´åˆã®å¯¾å¿œ OpenSSL PKI Tutorial OpenSSL Certificate Manager","categories":[{"name":"Security","slug":"Security","permalink":"https://kenryu.cc/zh/categories/Security/"}],"tags":[]},{"title":"Redmineæ­å»ºï¼ˆPostgreSQL+Apacheç‰ˆï¼‰","slug":"Redmine/Redmineæ­å»ºï¼ˆPostgreSQL+Apacheç‰ˆï¼‰","date":"2021-10-27T07:41:47.000Z","updated":"2025-12-19T08:19:46.062Z","comments":true,"path":"2021/10/27/Redmine/Redmineæ­å»ºï¼ˆPostgreSQL+Apacheç‰ˆï¼‰/","link":"","permalink":"https://kenryu.cc/zh/2021/10/27/Redmine/Redmine%E6%90%AD%E5%BB%BA%EF%BC%88PostgreSQL+Apache%E7%89%88%EF%BC%89/","excerpt":"","text":"0. ç¯å¢ƒè¯´æ˜Redmineéœ€è¦çš„ç¯å¢ƒï¼š èƒ½è¿è¡ŒRubyçš„OS æ•°æ®åº“ï¼ˆMySQL &#x2F; PostgreSQL &#x2F; SQLite &#x2F; SQLæœåŠ¡å™¨ï¼‰ ç½‘ç«™æœåŠ¡ï¼ˆApache &#x2F; Nginx ï¼‰ æœ¬æ¬¡æ­å»ºç¯å¢ƒï¼š Software Version Command OS CentOS Linux release 8.4.2105 cat &#x2F;etc&#x2F;os-release &#x2F;etc&#x2F;redhat-release &#x2F;etc&#x2F;system-release Redmine 4.2.3 Postgresql postgres (PostgreSQL) 10.17 postgres -V Ruby ruby 2.5.9p229 (2021-04-05 revision 67939) [x86_64-linux] ruby -v Apache Apache&#x2F;2.4.37 (centos) apachectl -v 1. ä¸‹è½½éœ€è¦çš„è½¯ä»¶åŒ…123dnf -y updatednf -y groupinstall &quot;Development Tools&quot;dnf -y install vim wget tar openssl* httpd httpd-devel ruby ruby-devel libcurl-devel 2. å®‰è£…æ•°æ®åº“12dnf -y install postgresql-server postgresql-develrpm -qa | grep postgresql åˆå§‹åŒ–æ•°æ®åº“ 1postgresql-setup initdb å¼€æœºè‡ªåŠ¨å¯åŠ¨ 12systemctl enable --now postgresqlsystemctl status postgresql åˆ›å»ºredmineç”¨æˆ·ä»¥åŠredmineæ•°æ®åº“ 1234[root@localhost ~]# su - postgres[postgres@localhost ~]$ psqlCREATE ROLE redmine LOGIN ENCRYPTED PASSWORD &#x27;Your_Password&#x27; NOINHERIT VALID UNTIL &#x27;infinity&#x27;;CREATE DATABASE redmine WITH ENCODING=&#x27;UTF8&#x27; OWNER=redmine; 123\\du #æŸ¥çœ‹ç”¨æˆ·\\l #æŸ¥çœ‹æ•°æ®åº“\\q #é€€å‡º ç¼–è¾‘pg_hba.confæ–‡ä»¶ 12345vim /var/lib/pgsql/data/pg_hba.conf# configuration parameter, or via the -i or -h command line switches.host redmine redmine 127.0.0.1/32 md5host redmine redmine ::1/128 md5 æ³¨æ„ï¼šæ·»åŠ çš„è§„åˆ™æ”¾åœ¨73è¡Œçš„: configuration parameterâ€¦ä¸‹é¢ã€‚å¦åˆ™ä¼šå‡ºç°psql: FATAL: Ident authentication failed for user &quot;postgres&quot; çš„é”™è¯¯è€Œä¸”æ— æ³•è®¿é—®æ•°æ®åº“çš„é—®é¢˜ã€‚ é‡å¯æ•°æ®åº“ 1systemctl restart postgresql éªŒè¯çœ‹çœ‹èƒ½ä¸èƒ½æ­£å¸¸è®¿é—®æ•°æ®åº“ 123psql -U redmine -d redmine -h 127.0.0.1Password for user redmine: #â†æ­£å¸¸æƒ…å†µä¸‹ä¼šæç¤ºè¾“å…¥å¯†ç  3. å…³é—­Selinux1234vim /etc/selinux/config#SELINUX=enforcingSELINUX=disabled 12rebootgetenforce # ç¡®è®¤ç»“æœ 4. ä¸‹è½½å®‰è£…Redmine è·å–æœ€æ–°ç‰ˆæœ¬:Redmineå®˜æ–¹ä¸‹è½½åœ°å€ 4.1. ä¸‹è½½ä»¥åŠè§£å‹123wget https://www.redmine.org/releases/redmine-4.2.3.tar.gztar -zxvf redmine-4.2.3.tar.gzmv redmine-4.2.3 /redmine 4.2. é…ç½®database.ymlæ–‡ä»¶æ ¹æ®æ•°æ®åº“è®¾ç½®ï¼Œé…ç½®Redmineçš„è¿æ¥æ•°æ®åº“è®¾å®šæ–‡ä»¶ 12345678910111213cd /redmine/config/cp database.yml.example database.ymlvim database.yml###postgresqlproduction:adapter: postgresqldatabase: redminehost: localhostusername: redminepassword: &quot;Your_Password&quot;encoding: utf8t#pool: 5 æ³¨æ„ï¼šè¦æŠŠdevelopmentï¼Œtestç­‰åŒºåŸŸç»™åˆ äº†æ’ç‰ˆç¼©è¿›è¦æ­£ç¡®ï¼ 4.3. é€šè¿‡Rubyéƒ¨ç½²æˆ‘å¯¹Rubyä¸äº†è§£ï¼Œè¿™äº›å‘½ä»¤ä¸æ˜¯å¾ˆæ‡‚ï¼Œä¼¼ä¹å¯ä»¥è‡ªåŠ¨å¯¼å…¥ Redmine æ“ä½œæ‰€éœ€çš„ Ruby è½¯ä»¶åŒ…ï¼Œä¸º MySQL æ•°æ®åº“åˆ›å»ºæ‰€éœ€çš„è¡¨æˆ–åŠ è½½é»˜è®¤æ•°æ®ï¼Ÿæ³¨æ„ä¸èƒ½å¿˜äº†ï¼Œåœ¨æ‰§è¡Œæ“ä½œå‰ç§»åŠ¨åˆ°Redmineç›®å½•ã€‚ 12345678cd /redminegem install bundler --no-rdoc --no-rigem install bundlerbundle install --without development test rmagickbundle exec rake generate_secret_tokenRAILS_ENV=production bundle exec rake db:migrateRAILS_ENV=production bundle exec rake redmine:load_default_data æ‰§è¡Œæœ€åä¸€è¡Œçš„æ—¶å€™é€‰æ‹©æƒ³è¦çš„è¯­è¨€ã€‚ 5. é…ç½®Apache5.1. å®‰è£…passenger12gem install passengerpassenger-install-apache2-module --auto --languages ruby æœ‰å¤§é‡çš„æ—¥å¿—åœ¨ç”»é¢ä¸Šæ»šåŠ¨ï¼Œéœ€è¦èŠ±ä¸€ç‚¹æ—¶é—´ã€‚è™½ç„¶æœ‰å¾ˆå¤šè­¦å‘Šï¼Œä½†æ˜¯å¦‚æœä¸å› é”™è¯¯è€Œæ‰è½çš„è¯åº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜ã€‚ 5.2. å®‰è£…snippet123456[root@localhost redmine]# passenger-install-apache2-module --snippetLoadModule passenger_module /usr/local/share/gems/gems/passenger-6.0.11/buildout/apache2/mod_passenger.so&lt;IfModule mod_passenger.c&gt;PassengerRoot /usr/local/share/gems/gems/passenger-6.0.11PassengerDefaultRuby /usr/bin/ruby&lt;/IfModule&gt; 5.3. è®¾ç½®Redmineä¸ºApacheçš„æ ¹ç›®å½•ï¼Œå¹¶æŠŠä¸Šä¸€æ­¥5.2çš„ç»“æœå¤åˆ¶ä¸‹æ¥ç²˜è´´åˆ°redmine.confæ–‡ä»¶ä¸­123456789101112vim /etc/httpd/conf.d/redmine.conf&lt;Directory &quot;/redmine/public&quot;&gt;Require all granted&lt;/Directory&gt;LoadModule passenger_module /usr/local/share/gems/gems/passenger-6.0.11/buildout/apache2/mod_passenger.so&lt;IfModule mod_passenger.c&gt;PassengerRoot /usr/local/share/gems/gems/passenger-6.0.11PassengerDefaultRuby /usr/bin/ruby&lt;/IfModule&gt; 5.4.123vim /etc/httpd/conf/httpd.confDocumentRoot &quot;/redmine/public&quot; 5.5. ç»™Apacheæƒé™1chown -R apache:apache /redmine 5.6. é‡å¯Apache123systemctl enable httpdsystemctl start httpd 6. é˜²ç«å¢™123firewall-cmd --zone=public --permanent --add-service=httpfirewall-cmd --zone=public --permanent --add-service=httpsfirewall-cmd --reload 7. æ’é”™7.1. åˆ é™¤PostgreSQLæ•°æ®åº“ä»¥åŠç”¨æˆ·1234[root@localhost ~]# su - postgres[postgres@localhost ~]$ psqldrop database redmine;drop role redmine; 123\\du #æŸ¥çœ‹ç”¨æˆ·\\l #æŸ¥çœ‹æ•°æ®åº“\\q #é€€å‡º å‚è€ƒï¼šRedmineå®˜æ–¹å®‰è£…æ•™ç¨‹CentOS8ã«Redmine4.1ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¦‚ä½•åœ¨ CentOS 8 ä¸Šå®‰è£… Postgresql","categories":[{"name":"Redmine","slug":"Redmine","permalink":"https://kenryu.cc/zh/categories/Redmine/"}],"tags":[]},{"title":"Redmineæ­å»ºï¼ˆMySQL+Apacheç‰ˆï¼‰","slug":"Redmine/Redmineæ­å»ºï¼ˆMySQL_Apacheç‰ˆï¼‰","date":"2021-10-26T06:42:55.000Z","updated":"2025-12-19T08:19:46.062Z","comments":true,"path":"2021/10/26/Redmine/Redmineæ­å»ºï¼ˆMySQL_Apacheç‰ˆï¼‰/","link":"","permalink":"https://kenryu.cc/zh/2021/10/26/Redmine/Redmine%E6%90%AD%E5%BB%BA%EF%BC%88MySQL_Apache%E7%89%88%EF%BC%89/","excerpt":"","text":"0. ç¯å¢ƒè¯´æ˜Redmineéœ€è¦çš„ç¯å¢ƒï¼š èƒ½è¿è¡ŒRubyçš„OS æ•°æ®åº“ï¼ˆMySQL &#x2F; PostgreSQL &#x2F; SQLite &#x2F; SQLæœåŠ¡å™¨ï¼‰ ç½‘ç«™æœåŠ¡ï¼ˆApache &#x2F; Nginx ï¼‰ æœ¬æ¬¡æ­å»ºç¯å¢ƒï¼š Software Version Command OS CentOS Linux release 8.4.2105 cat &#x2F;etc&#x2F;os-release &#x2F;etc&#x2F;redhat-release &#x2F;etc&#x2F;system-release Redmine 4.2.3 MySQL Ver 14.14 Distrib 5.7.36, for Linux (x86_64) using EditLine wrapper mysql â€“version MySQL mysql Ver 8.0.26 for Linux on x86_64 (Source distribution) mysql â€“version Ruby ruby 2.5.9p229 (2021-04-05 revision 67939) [x86_64-linux] ruby -v Apache Apache&#x2F;2.4.37 (centos) apachectl -v 1. ä¸‹è½½éœ€è¦çš„è½¯ä»¶åŒ…123dnf -y updatednf -y groupinstall &quot;Development Tools&quot;dnf -y install vim wget tar openssl* httpd httpd-devel ruby ruby-devel libcurl-devel 2. å®‰è£…æ•°æ®åº“ï¼ˆé€‰é¡¹1ï¼‰2.1. å®‰è£…æœ€æ–°ç‰ˆçš„Mysqlæ•°æ®åº“ï¼ˆ8.0.26ï¼‰1dnf -y install mysql-server mysql-devel ï¼ˆé€‰é¡¹2ï¼‰2.2. å®‰è£…æ—§ç‰ˆçš„Mysqlæ•°æ®åº“ï¼ˆ5.7.36ï¼‰123456789wget http://dev.mysql.com/get/mysql57-community-release-el7-8.noarch.rpmyum localinstall mysql57-community-release-el7-8.noarch.rpmyum repolist enabled | grep &quot;mysql.*-community.*&quot;yum module disable mysqlyum install mysql-community-server -ysystemctl enable mysqldsystemctl start mysqldsystemctl daemon-reload ï¼ˆé€‰é¡¹3ï¼‰2.3. å®‰è£…æ—§ç‰ˆçš„Mysqlæ•°æ®åº“ï¼ˆ5.7.36ï¼‰12wget http://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpmrpm -ivh mysql80-community-release-el7-3.noarch.rpm æŒ‡å®šç‰ˆæœ¬ (5.7) 12cd /etc/yum.repos.d/vim mysql-community.repo 12yum -y module disable mysqlyum -y install mysql-community-server ç¡®è®¤ 1mysql --version ï¼ˆé€‰é¡¹4ï¼‰2.4. è·å–æ•°æ®åº“åˆå§‹å¯†ç ï¼ˆæ—§ç‰ˆæ•°æ®åº“éœ€è¦ï¼‰ 1grep &#x27;temporary password&#x27; /var/log/mysqld.log 2.5. é…ç½®æ•°æ®åº“åˆå§‹åŒ–æ•°æ®åº“ï¼Œæ ¹æ®éœ€æ±‚é€‰æ‹© Y &#x2F; N 1mysql_secure_installation ä¸ºRedmineåˆ›å»ºæ•°æ®åº“ 123456mysql -uroot -pCREATE DATABASE redmine CHARACTER SET utf8mb4;set global validate_password.policy=0; #å¯†ç ç­–ç•¥ä¸º0è¿™ä¸€æ­¥å¯é€‰CREATE USER &#x27;redmine&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;my_password&#x27;; #æŠŠ&#x27;my_password&#x27;æ”¹ä¸ºæˆ‘ä»¬æƒ³è¦è®¾å®šçš„å¯†ç GRANT ALL PRIVILEGES ON redmine.* TO &#x27;redmine&#x27;@&#x27;localhost&#x27;; é‡å¯æ•°æ®åº“ 12systemctl enable mysqldsystemctl restart mysqld 3. å…³é—­Selinux1234vim /etc/selinux/config#SELINUX=enforcingSELINUX=disabled 12rebootgetenforce # ç¡®è®¤ç»“æœ 4. ä¸‹è½½å®‰è£…Redmine è·å–æœ€æ–°ç‰ˆæœ¬:Redmineå®˜æ–¹ä¸‹è½½åœ°å€ 4.1. ä¸‹è½½ä»¥åŠè§£å‹123wget https://www.redmine.org/releases/redmine-4.2.3.tar.gztar -zxvf redmine-4.2.3.tar.gzmv redmine-4.2.3 /redmine 4.2. é…ç½®database.ymlæ–‡ä»¶æ ¹æ®æ•°æ®åº“è®¾ç½®ï¼Œé…ç½®Redmineçš„è¿æ¥æ•°æ®åº“è®¾å®šæ–‡ä»¶ 12345678910111213cd /redmine/config/cp database.yml.example database.ymlvim database.ymlproduction:adapter: mysql2database: redminehost: localhostusername: redminepassword: &quot;my_password&quot;# Use &quot;utf8&quot; instead of &quot;utfmb4&quot; for MySQL prior to 5.7.7encoding: utf8mb4 æ³¨æ„ï¼šè¦æŠŠdevelopmentï¼Œtestç­‰åŒºåŸŸç»™åˆ äº†æ’ç‰ˆç¼©è¿›è¦æ­£ç¡®ï¼ 4.3. é€šè¿‡Rubyéƒ¨ç½²æˆ‘å¯¹Rubyä¸äº†è§£ï¼Œè¿™äº›å‘½ä»¤ä¸æ˜¯å¾ˆæ‡‚ï¼Œä¼¼ä¹å¯ä»¥è‡ªåŠ¨å¯¼å…¥ Redmine æ“ä½œæ‰€éœ€çš„ Ruby è½¯ä»¶åŒ…ï¼Œä¸º MySQL æ•°æ®åº“åˆ›å»ºæ‰€éœ€çš„è¡¨æˆ–åŠ è½½é»˜è®¤æ•°æ®ï¼Ÿæ³¨æ„ä¸èƒ½å¿˜äº†ï¼Œåœ¨æ‰§è¡Œæ“ä½œå‰ç§»åŠ¨åˆ°Redmineç›®å½•ã€‚ 1234567cd /redminegem install bundlerbundle install --without development test rmagickbundle exec rake generate_secret_tokenRAILS_ENV=production bundle exec rake db:migrateRAILS_ENV=production bundle exec rake redmine:load_default_data æ‰§è¡Œæœ€åä¸€è¡Œçš„æ—¶å€™é€‰æ‹©æƒ³è¦çš„è¯­è¨€ã€‚ 5. é…ç½®Apache5.1. å®‰è£…passenger12gem install passengerpassenger-install-apache2-module --auto --languages ruby æœ‰å¤§é‡çš„æ—¥å¿—åœ¨ç”»é¢ä¸Šæ»šåŠ¨ï¼Œéœ€è¦èŠ±ä¸€ç‚¹æ—¶é—´ã€‚è™½ç„¶æœ‰å¾ˆå¤šè­¦å‘Šï¼Œä½†æ˜¯å¦‚æœä¸å› é”™è¯¯è€Œæ‰è½çš„è¯åº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜ã€‚ 5.2. å®‰è£…snippet123456[root@localhost redmine]# passenger-install-apache2-module --snippetLoadModule passenger_module /usr/local/share/gems/gems/passenger-6.0.11/buildout/apache2/mod_passenger.so&lt;IfModule mod_passenger.c&gt;PassengerRoot /usr/local/share/gems/gems/passenger-6.0.11PassengerDefaultRuby /usr/bin/ruby&lt;/IfModule&gt; 5.3. è®¾ç½®Redmineä¸ºApacheçš„æ ¹ç›®å½•ï¼Œå¹¶æŠŠä¸Šä¸€æ­¥5.2çš„ç»“æœå¤åˆ¶ä¸‹æ¥ç²˜è´´åˆ°redmine.confæ–‡ä»¶ä¸­123456789101112vim /etc/httpd/conf.d/redmine.conf&lt;Directory &quot;/redmine/public&quot;&gt;Require all granted&lt;/Directory&gt;LoadModule passenger_module /usr/local/share/gems/gems/passenger-6.0.11/buildout/apache2/mod_passenger.so&lt;IfModule mod_passenger.c&gt;PassengerRoot /usr/local/share/gems/gems/passenger-6.0.11PassengerDefaultRuby /usr/bin/ruby&lt;/IfModule&gt; 5.4.123vim /etc/httpd/conf/httpd.confDocumentRoot &quot;/redmine/public&quot; 5.5. ç»™Apacheæƒé™1chown -R apache:apache /redmine 5.6. é‡å¯Apache123systemctl enable httpdsystemctl start httpd 6. é˜²ç«å¢™123firewall-cmd --zone=public --permanent --add-service=httpfirewall-cmd --zone=public --permanent --add-service=httpsfirewall-cmd --reload 7. æ’é”™7.1. åˆ é™¤Mysqlæ•°æ®åº“12dnf -y remove mysql mysql-server mysql-libs mysql-commonrm -rf /var/lib/mysql å‚è€ƒï¼šRedmineå®˜æ–¹å®‰è£…æ•™ç¨‹CentOS8ã«Redmine4.1ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ 12[root@localhost ~]# sudo su - postgres[postgres@localhost ~]$ psql CREATE ROLE redmine LOGIN ENCRYPTED PASSWORD &#39;Your_Password&#39; NOINHERIT VALID UNTIL &#39;infinity&#39;; CREATE DATABASE redmine WITH ENCODING=&#39;UTF8&#39; OWNER=redmine;","categories":[{"name":"Redmine","slug":"Redmine","permalink":"https://kenryu.cc/zh/categories/Redmine/"}],"tags":[]},{"title":"PCI pass though (Ethernet port)","slug":"Virtualization/PCI_pass_though_(Ethernet_port)","date":"2021-08-26T06:51:28.000Z","updated":"2025-12-19T08:19:46.062Z","comments":true,"path":"2021/08/26/Virtualization/PCI_pass_though_(Ethernet_port)/","link":"","permalink":"https://kenryu.cc/zh/2021/08/26/Virtualization/PCI_pass_though_(Ethernet_port)/","excerpt":"","text":"1ifconfig 1234567891011[root@SMC-KVM ~]# ethtool -i eno2driver: ixgbeversion: 4.18.0-305.10.2.el8_4.x86_64firmware-version: 0x800007f6, 1.1747.0expansion-rom-version:bus-info: 0000:01:00.1supports-statistics: yessupports-test: yessupports-eeprom-access: yessupports-register-dump: yessupports-priv-flags: yes 1234# vim /etc/grub2-efi.cfg# vim /etc/grub2.cfgset kernelopts=&quot;...iommu.passthrough=1&quot; Enable intel iommu: 1234vim /etc/default/grubGRUB_CMDLINE_LINUX=&quot;... intel_iommu=on iommu=pt#GRUB_CMDLINE_LINUX=&quot; ... amd_iommu=on If intel_iommu&#x3D;on or amd_iommu&#x3D;on works, you can try replacing them with iommu&#x3D;pt or amd_iommu&#x3D;pt. 123grub2-mkconfig -o /boot/grub2/grub.cfgcat /etc/grub2.cfg | grep &#x27;set kernelopt&#x27; # è¿™æ—¶å€™ä¸Šé¢çš„è®¾ç½®å·²ç»è¢«æ˜ å°„è¿‡æ¥äº†reboot 1dmesg | grep IOMMU Modify VMâ€™s specification: 12cp /etc/libvirt/qemu/cjl-test.xml /etc/libvirt/qemu/cjl-test.xml.bakvim /etc/libvirt/qemu/cjl-test.xml 1234567&lt;hostdev mode=&#x27;subsystem&#x27; type=&#x27;pci&#x27; managed=&#x27;yes&#x27;&gt;&lt;source&gt;&lt;address domain=&#x27;0x0000&#x27; bus=&#x27;0x01&#x27; slot=&#x27;0x00&#x27; function=&#x27;0x1&#x27;/&gt;&lt;/source&gt;##&lt;address type=&#x27;pci&#x27; domain=&#x27;0x0000&#x27; bus=&#x27;0x01&#x27; slot=&#x27;0x02&#x27; function=&#x27;0x0&#x27;/&gt;&lt;/hostdev&gt; 1virsh define &amp;VMname 12ethtool -i eno2ethtool -i eno1 Guest (VM) 12[root@localhost ~]# lspci | grep Ethernet00:02.0 Ethernet controller: Intel Corporation Ethernet Controller 10G X550T (rev 01) 1234567891011[root@localhost ~]# ethtool -i ens2driver: ixgbeversion: 4.18.0-305.10.2.el8_4.x86_64firmware-version: 0x800007f6, 1.1747.0expansion-rom-version:bus-info: 0000:00:02.0supports-statistics: yessupports-test: yessupports-eeprom-access: yessupports-register-dump: yessupports-priv-flags: yes","categories":[{"name":"Virtualization","slug":"Virtualization","permalink":"https://kenryu.cc/zh/categories/Virtualization/"}],"tags":[{"name":"kvm","slug":"kvm","permalink":"https://kenryu.cc/zh/tags/kvm/"},{"name":"hypervisor","slug":"hypervisor","permalink":"https://kenryu.cc/zh/tags/hypervisor/"}]},{"title":"Setup NFS client (nfs-utils)","slug":"File_Sharing_Servers/Setup_NFS_client__nfs_utils_","date":"2021-05-11T06:01:24.000Z","updated":"2025-12-19T08:19:46.062Z","comments":true,"path":"2021/05/11/File_Sharing_Servers/Setup_NFS_client__nfs_utils_/","link":"","permalink":"https://kenryu.cc/zh/2021/05/11/File_Sharing_Servers/Setup_NFS_client__nfs_utils_/","excerpt":"","text":"nfså®¢æˆ·ç«¯é€šè¿‡mountå®ç°è¿æ¥æœåŠ¡å™¨ ä¸‹è½½å®‰è£…nfs-utils 1yum install nfs-utils ç¡®è®¤ 123[root@client ~]# showmount -e 192.168.64.48Export list for 192.168.64.48:/tmp/nfs 192.168.64.0/22 æŒ‚è½½é”šç‚¹ 123mount -t nfs 192.168.64.48:/tmp/nfs /mntdf -hT Automatically mount by using autofs One drawback of using &#x2F;etc&#x2F;fstab is that, regardless of how infrequently a user accesses the NFS mounted file system, the system must dedicate resources to keep the mounted file system in place. This is not a problem with one or two mounts, but when the system is maintaining mounts to many systems at one time, overall system performance can be affected.https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/storage_administration_guide/nfs-autofs Step1. Install autofs 12dnf -y install autofssystemctl enable autofs Step2. Edit auto.master for direct mapping 123vim /etc/auto.master#/misc /etc/auto.misc/- /etc/auto.misc Step3. Edit auto.misc 12vim /etc/auto.misc/share -fstype=nfs4,rw 192.168.65.129:/share Step4. Restart autofs to apply the changes systemctl restart autofs","categories":[{"name":"File Sharing Servers","slug":"File-Sharing-Servers","permalink":"https://kenryu.cc/zh/categories/File-Sharing-Servers/"}],"tags":[]},{"title":"Setup NFS server (nfs-utils)","slug":"File_Sharing_Servers/Setup_NFS_server__nfs_utils_","date":"2021-05-11T05:06:04.000Z","updated":"2025-12-19T08:19:46.062Z","comments":true,"path":"2021/05/11/File_Sharing_Servers/Setup_NFS_server__nfs_utils_/","link":"","permalink":"https://kenryu.cc/zh/2021/05/11/File_Sharing_Servers/Setup_NFS_server__nfs_utils_/","excerpt":"","text":"Socket Statisticsã®ç¢ºèª 1234[root@localhost html]# ss -ntulNetid State Recv-Q Send-Q Local Address:Port Peer Address:Porttcp LISTEN 0 128 0.0.0.0:22 0.0.0.0:*tcp LISTEN 0 128 [::]:22 [::]:* å®‰è£…nfs-utils 1yum install nfs-utils è®¾ç½®é˜²ç«å¢™ 123firewall-cmd --zone=public --permanent --add-service=&#123;rpc-bind,mountd,nfs&#125;firewall-cmd --reloadfirewall-cmd --list-all è®¾ç½®å¼€æœºè‡ªå¯ 12systemctl enable rpcbindsystemctl enable nfs-server.service è®¾ç½®é…ç½®æ–‡ä»¶ 12[root@localhost nfs]# vi /etc/exports/tmp/nfs/ 192.168.64.0/22(rw,sync,no_root_squash,no_all_squash) é…ç½®æ–‡ä»¶çš„å‚æ•° å‚æ•° ä½œç”¨ ro åªè¯» rw è¯»å†™ root_squash å½“NFSå®¢æˆ·ç«¯ä»¥rootç®¡ç†å‘˜è®¿é—®æ—¶ï¼Œæ˜ å°„ä¸ºNFSæœåŠ¡å™¨çš„åŒ¿åç”¨æˆ· no_root_squash å½“NFSå®¢æˆ·ç«¯ä»¥rootç®¡ç†å‘˜è®¿é—®æ—¶ï¼Œæ˜ å°„ä¸ºNFSæœåŠ¡å™¨çš„rootç®¡ç†å‘˜ all_squash æ— è®ºNFSå®¢æˆ·ç«¯ä½¿ç”¨ä»€ä¹ˆè´¦æˆ·è®¿é—®ï¼Œå‡æ˜ å°„ä¸ºNFSæœåŠ¡å™¨çš„åŒ¿åç”¨æˆ· sync åŒæ—¶å°†æ•°æ®å†™å…¥åˆ°å†…å­˜ä¸ç¡¬ç›˜ä¸­ï¼Œä¿è¯ä¸ä¸¢å¤±æ•°æ® async ä¼˜å…ˆå°†æ•°æ®å†™å…¥åˆ°å†…å­˜ï¼Œç„¶åå†å†™å…¥ç¡¬ç›˜ï¼›è¿™æ ·æ•ˆç‡æ›´é«˜ï¼Œä½†å¯èƒ½ä¼šä¸¢å¤±æ•°æ® anonuid æŒ‡å®šuidçš„å€¼ï¼Œæ­¤uidå¿…é¡»å­˜åœ¨äº&#x2F;etc&#x2F;passwdä¸­ anongid æŒ‡å®šgidçš„å€¼ å¯åŠ¨nfsæœåŠ¡ 1systemctl restart rpcbind nfs-server.service ç¡®è®¤ 123456789101112[root@centos8 mnt]# ss -ntulNetid State Recv-Q Send-Q Local Address:Port Peer Address:Portudp UNCONN 0 0 0.0.0.0:111 0.0.0.0:*udp UNCONN 0 0 [::]:111 [::]:*tcp LISTEN 0 128 0.0.0.0:111 0.0.0.0:*tcp LISTEN 0 128 0.0.0.0:22 0.0.0.0:*tcp LISTEN 0 128 [::]:111 [::]:*tcp LISTEN 0 128 [::]:22 [::]:*[root@localhost tmp]# showmount -e localhostExport list for localhost:/tmp/nfs 192.168.64.0/22","categories":[{"name":"File Sharing Servers","slug":"File-Sharing-Servers","permalink":"https://kenryu.cc/zh/categories/File-Sharing-Servers/"}],"tags":[]},{"title":"Setup SMB server (samba)","slug":"File_Sharing_Servers/Setup_SMB_server__samba_","date":"2021-05-10T08:16:45.000Z","updated":"2025-12-19T08:19:46.062Z","comments":true,"path":"2021/05/10/File_Sharing_Servers/Setup_SMB_server__samba_/","link":"","permalink":"https://kenryu.cc/zh/2021/05/10/File_Sharing_Servers/Setup_SMB_server__samba_/","excerpt":"","text":"Socket Statisticsã®ç¢ºèª 1234[root@localhost html]# ss -ntulNetid State Recv-Q Send-Q Local Address:Port Peer Address:Porttcp LISTEN 0 128 0.0.0.0:22 0.0.0.0:*tcp LISTEN 0 128 [::]:22 [::]:* smb serverã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€FWã®è¨­å®š 1234567891011121314151617yum install sambafirewall-cmd --zone=public --add-service=samba --permanentfirewall-cmd --reload[root@localhost ~]# firewall-cmd --list-allpublic (active)target: defaulticmp-block-inversion: nointerfaces: enp0s3sources:services: cockpit dhcpv6-client ftp http samba sshports:protocols:masquerade: noforward-ports:source-ports:icmp-blocks:rich rules: ä¿®æ”¹é…ç½®æ–‡ä»¶ 12cp /etc/samba/smb.conf /etc/samba/smb.conf.bak t#å¤‡ä»½é…ç½®æ–‡ä»¶vim /etc/samba/smb.conftttt#ç¼–è¾‘å†…å®¹ vimç¼–è¾‘é‡Œé¢ä¿®æ”¹æˆ–è€…æ·»åŠ ä»¥ä¸‹å†…å®¹ 1234567891011121314151617181920#ä¿®æ”¹globalå…¨å±€é…ç½®#samba4è¾ƒä¹‹å‰çš„samba3æœ‰ä¸€ä¸ªé‡å¤§çš„å˜åŒ–æ˜¯ï¼šsecurityä¸å†æ”¯æŒshare[global]workgroup = WORKGROUPsecurity=usermap to guest =Bad Usertt#æ·»åŠ åä¸ºshareçš„å…±äº«æ–‡ä»¶å¤¹[share]comment = share allpath = /tmp/sambabrowseable = yespublic = yeswritable = yescreate mode = 0755force create mode = 0755directory mode = 0755force directory mode = 0755force user = apache æ£€æµ‹è¯­æ³•æ˜¯å¦é”™è¯¯ 123456[root@localhost ~]# testparmLoad smb config files from /etc/samba/smb.confLoaded services file OK.Server role: ROLE_STANDALONEPress enter to see a dump of your service definitions åˆ›å»ºä¸€ä¸ªå…±äº«æ–‡ä»¶å¤¹ 1234mkdir /tmp/sambachmod 777 /tmp/sambatouch /tmp/samba/sharefilesecho &quot;111111&quot; &gt; /tmp/samba/sharefiles å¯åŠ¨smbæœåŠ¡ 1[root@localhost ~]# systemctl start smb ç¡®è®¤smbç‰ˆæœ¬ 1smbstatus --version é€šè¿‡Socket Statisticså¯ä»¥çœ‹åˆ°139, 445ç«¯å£å·²ç»è¢«æ‰“å¼€ 12345678[root@localhost ~]# ss -tunlNetid State Recv-Q Send-Q Local Address:Port Peer Address:Porttcp LISTEN 0 50 0.0.0.0:139 0.0.0.0:*tcp LISTEN 0 128 0.0.0.0:22 0.0.0.0:*tcp LISTEN 0 50 0.0.0.0:445 0.0.0.0:*tcp LISTEN 0 50 [::]:139 [::]:*tcp LISTEN 0 128 [::]:22 [::]:*tcp LISTEN 0 50 [::]:445 [::]:* æ­¤æ—¶é˜²ç«å¢™æ˜¯æ‰“å¼€çš„çŠ¶æ€ 1234567891011121314[root@localhost ~]# systemctl status firewalldâ— firewalld.service - firewalld - dynamic firewall daemonLoaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; vendor preset: enabled)Active: active (running) since Tue 2021-05-11 09:40:50 JST; 37min agoDocs: man:firewalld(1)Main PID: 857 (firewalld)Tasks: 2 (limit: 12404)Memory: 36.5MCGroup: /system.slice/firewalld.servicemq857 /usr/libexec/platform-python -s /usr/sbin/firewalld --nofork --nopidMay 11 09:40:49 localhost.localdomain systemd[1]: Starting firewalld - dynamic firewall daemon...May 11 09:40:50 localhost.localdomain systemd[1]: Started firewalld - dynamic firewall daemon.May 11 09:40:51 localhost.localdomain firewalld[857]: WARNING: AllowZoneDrifting is enabled. This is considered an insecure configuration option. It w&gt; å…³äºSELinux 123[root@localhost ~]# getenforceEnforcingttt#å¼ºåˆ¶æ‰§è¡Œ#è¿™ç§çŠ¶æ€ä¸å¯è®¿é—® 123[root@localhost ~]# getenforcePermissivettt#è®¸å¯çš„#è¿™ç§çŠ¶æ€åªæœ‰åªè¯»æƒé™ 123456789[root@localhost ~]# vim /etc/selinux/config#SELINUX=enforcingtt#å¼ºåˆ¶æ‰§è¡ŒSELINUX=disabledtt#å…³é—­[root@localhost ~]# reboott#éœ€è¦é‡å¯[root@localhost ~]# getenforcedisabled#è¿™ç§çŠ¶æ€åªæœ‰åªè¯»æƒé™ åœ¨win10ä¸‹æ‰“å¼€æœåŠ¡å™¨åœ°å€","categories":[{"name":"File Sharing Servers","slug":"File-Sharing-Servers","permalink":"https://kenryu.cc/zh/categories/File-Sharing-Servers/"}],"tags":[]},{"title":"Setup FTP server (vsftpd)","slug":"File_Sharing_Servers/Setup_FTP_server__vsftpd_","date":"2021-05-10T01:44:49.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2021/05/10/File_Sharing_Servers/Setup_FTP_server__vsftpd_/","link":"","permalink":"https://kenryu.cc/zh/2021/05/10/File_Sharing_Servers/Setup_FTP_server__vsftpd_/","excerpt":"","text":"Socket Statistics 1234[root@localhost html]# ss -ntulNetid State Recv-Q Send-Q Local Address:Port Peer Address:Porttcp LISTEN 0 128 0.0.0.0:22 0.0.0.0:*tcp LISTEN 0 128 [::]:22 [::]:* FTP server pakege install 1yum install vsftpd -y FW setting 12firewall-cmd --zone=public --add-service=ftp --permanentfirewall-cmd --reload å¿…é¡»è®¾ç½®selinuxä¸ºå…³é—­ ä¸´æ—¶è®¾ç½®ï¼ˆé‡å¯å¤±æ•ˆï¼‰123[root@centos8 ~]# setenforce 0[root@centos8 ~]# getenforcePermissive æ°¸ä¹…è®¾ç½®123456[root@centos8 ~]# vim /etc/selinux/config#SELINUX=enforcingSELINUX=disabled[root@centos8 ~]# reboot[root@centos8 ~]# getenforceDisabled FTPçš„é…ç½®æ–‡ä»¶ 12[root@localhost ~]# ls /etc/vsftpd/ftpusers user_list vsftpd.conf vsftpd_conf_migrate.sh å¤‡ä»½ä¸»é…ç½®æ–‡ä»¶ 1cp /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.bak FTPå¯ä»¥æœ‰ä¸‰ç§ç™»å…¥æ–¹å¼åˆ†åˆ«æ˜¯ï¼š åŒ¿åç™»å½•æ–¹å¼ï¼šä¸éœ€è¦ç”¨æˆ·å¯†ç æœ¬åœ°ç”¨æˆ·ç™»å…¥ï¼šä½¿ç”¨æœ¬åœ°ç”¨æˆ·å’Œå¯†ç ç™»å…¥è™šæ‹Ÿç”¨æˆ·æ–¹å¼ï¼šä¹Ÿæ˜¯ä½¿ç”¨ç”¨æˆ·å’Œå¯†ç ç™»å…¥ï¼Œä½†æ˜¯è¯¥ç”¨æˆ·ä¸æ˜¯linuxä¸­åˆ›å»ºçš„ç”¨æˆ·vsftpd.conf: ä¸»é…ç½®æ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192[root@centos8 ~]# vim /etc/vsftpd/vsftpd.confanonymous_enable=YEStt#å…è®¸åŒ¿åç”¨æˆ·ç™»é™†anon_upload_enable=YES tt#åŒ¿åç”¨æˆ·å¯ä»¥ä¸Šä¼ æ–‡ä»¶anon_mkdir_write_enable=YESt#åŒ¿åç”¨æˆ·å¯ä»¥ä¿®æ”¹æ–‡ä»¶å¤¹anon_other_write_enable=YESt#åŒ¿åç”¨æˆ·å¯ä»¥ä¿®æ”¹æ–‡ä»¶å¤¹no_anon_password=YEStt#åŒ¿åç”¨æˆ·loginæ—¶ä¸è¯¢é—®å£ä»¤anon_umask=011tt#åŒ¿åç”¨æˆ·åˆ›å»ºæ–‡ä»¶çš„æ©ç ï¼Œä¸æŒ‡å®šæ—¶å€™ä¸º077local_enable=YES #vsftpdæ‰€åœ¨ç³»ç»Ÿçš„ç”¨æˆ·å¯ä»¥ç™»å½•vsftpdwrite_enable=YES #å…¨å±€è®¾ç½®ï¼Œæ˜¯å¦å®¹è®¸å†™å…¥ï¼ˆæ— è®ºæ˜¯åŒ¿åç”¨æˆ·è¿˜æ˜¯æœ¬åœ°ç”¨æˆ·ï¼Œè‹¥è¦å¯ç”¨ä¸Šä¼ æƒé™çš„è¯ï¼Œå°±è¦å¼€å¯ä»–ï¼‰local_umask=002 #åŒ¿åç”¨æˆ·æ–°å¢æ–‡ä»¶çš„umaskæ•°å€¼xferlog_enable=YES #å¯ç”¨ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œç”¨äºè¯¦ç»†è®°å½•ä¸Šä¼ å’Œä¸‹è½½ã€‚use_localtime=YES #ä½¿ç”¨æœ¬åœ°æ—¶é—´è€Œä¸æ˜¯GMTvsftpd_log_file=/var/log/vsftpd.log #vsftpdæ—¥å¿—å­˜æ”¾ä½ç½®dual_log_enable=YES #ç”¨æˆ·ç™»é™†æ—¥å¿—connect_from_port_20=YES #å¼€å¯20ç«¯å£xferlog_file=/var/log/xferlog #è®°å½•ä¸Šä¼ ä¸‹è½½æ–‡ä»¶çš„æ—¥å¿—xferlog_std_format=YES #è®°å½•æ—¥å¿—ä½¿ç”¨æ ‡å‡†æ ¼å¼idle_session_timeout=600 #ç™»é™†ä¹‹åè¶…æ—¶æ—¶é—´60ç§’ï¼Œç™»é™†ä¹‹åï¼Œä¸€åˆ†é’Ÿä¸æ“ä½œï¼Œå°±ä¼šæ–­å¼€è¿æ¥ã€‚chroot_local_user=YES #ç”¨äºæŒ‡å®šç”¨æˆ·åˆ—è¡¨æ–‡ä»¶ä¸­çš„ç”¨æˆ·,æ˜¯å¦å…è®¸åˆ‡æ¢åˆ°ä¸Šçº§ç›®å½•listen=YES #å¼€å¯ç›‘å¬pam_service_name=vsftpd.vu #éªŒè¯æ–‡ä»¶çš„åå­—userlist_enable=YES #å…è®¸ç”±user_listæŒ‡å®šæ–‡ä»¶ä¸­çš„ç”¨æˆ·ç™»å½•FTPæœåŠ¡å™¨tcp_wrappers=YES #æ”¯æŒtcp_wrappers,é™åˆ¶è®¿é—®(/etc/hosts.allow,/etc/hosts.deny)guest_enable=YES #èµ·ç”¨è™šæ‹Ÿç”¨æˆ·guest_username=taokey #è™šæ‹Ÿç”¨æˆ·å#user_config_dir=/etc/vsftpd/vsftpuser #è™šæ‹Ÿç”¨æˆ·é…ç½®æ–‡ä»¶è·¯å¾„local_root=/home/ftpUser/ #è‡ªå®šä¹‰ftpä¸Šä¼ è·¯å¾„ï¼ˆæ³¨æ„æ–‡ä»¶å¤¹æƒé™ï¼‰pasv_min_port=35000pasv_max_port=45000pasv_enable=YESpasv_promiscuous=YESanon_other_write_enable=YES## 1. ç›‘å¬ç›¸å…³#listen=&lt;YES/NO&gt; # YES: æœåŠ¡ä»¥ç‹¬ç«‹è¿è¡Œæ–¹å¼è¿è¡Œ; NO: è¿è¡Œåœ¨ xinetd å†…ã€‚ é»˜è®¤ä¸º YESlisten_address=&lt;ip address&gt; # æœåŠ¡ç›‘å¬åœ°å€, å¦‚æœæœ‰å¤šä¸ªç½‘å¡, éœ€è¦å°†æœåŠ¡ç»‘å®šåˆ°æŒ‡å®š IP åœ°å€listen_port=&lt;port&gt; # æœåŠ¡ç›‘å¬ç«¯å£, é»˜è®¤ä¸º 21## 2. åŒ¿åç”¨æˆ·ç›¸å…³#anonymous_enable=&lt;YES/NO&gt; # æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·è®¿é—®, é»˜è®¤ NOno_anon_password=YES t # åŒ¿åç”¨æˆ·loginæ—¶ä¸è¯¢é—®å£ä»¤anon_mkdir_write_enable=&lt;YES/NO&gt; # æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·åˆ›å»ºæ–‡ä»¶å¤¹, é»˜è®¤ NOanon_other_write_enable=&lt;YES/NO&gt; # æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·é‡å‘½åã€åˆ é™¤æ–‡ä»¶å¤¹ç­‰å…¶ä»–æƒé™ï¼ˆé»˜è®¤ä¸º NO, åŸºäºå®‰å…¨æ€§è€ƒè™‘è¿™ä¸ªæƒé™ä¸€èˆ¬ä¸æ‰“å¼€ï¼‰anon_upload_enable=&lt;YES/NO&gt; # æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·ä¸Šä¼ , é»˜è®¤ NOanon_umask=&lt;nnn&gt; # åŒ¿åç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶çš„ç”Ÿæˆæ©ç , é»˜è®¤ä¸º077anon_max_rate=&lt;n&gt; # åŒ¿åç”¨æˆ·çš„æœ€å¤§ä¼ è¾“é€Ÿç‡, å•ä½ä¸º Byte/s, å€¼ä¸º 0 è¡¨ç¤ºä¸é™åˆ¶anon_world_readable_only=&lt;YES/NO&gt; # æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·åªè¯»æµè§ˆ## 3. æœ¬åœ°ç”¨æˆ·(Linuxæ ‡å‡†ç³»ç»Ÿç”¨æˆ·)ç›¸å…³#local_enable=&lt;YES/NO&gt; # æ˜¯å¦æ”¯æŒæœ¬åœ°ç”¨æˆ·å¸å·è®¿é—®write_enable=&lt;YES/NO&gt; # æ˜¯å¦å¼€æ”¾æœ¬åœ°ç”¨æˆ·çš„å†™æƒé™local_umask=&lt;nnn&gt; # æœ¬åœ°ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶çš„ç”Ÿæˆæ©ç , é»˜è®¤ä¸º077local_max_rate=&lt;n&gt; # æœ¬åœ°ç”¨æˆ·æœ€å¤§çš„ä¼ è¾“é€Ÿç‡, å•ä½ä¸º Byte/sï¼Œå€¼ä¸º 0 è¡¨ç¤ºä¸é™åˆ¶local_root=&lt;file&gt; # æœ¬åœ°ç”¨æˆ·ç™»é™†åçš„ç›®å½•ï¼Œé»˜è®¤ä¸º æœ¬åœ°ç”¨æˆ· çš„ ä¸»ç›®å½•chroot_local_user=&lt;YES/NO&gt; # æœ¬åœ°ç”¨æˆ·æ˜¯å¦å¯ä»¥æ‰§è¡Œ chroot, é»˜è®¤ä¸º NOchroot_list_enable=&lt;YES/NO&gt; # æ˜¯å¦åªæœ‰æŒ‡å®šçš„ç”¨æˆ·æ‰èƒ½æ‰§è¡Œ chroot, é»˜è®¤ä¸º NOchroot_list_file=&lt;filename&gt; # å½“ chroot_local_user=NO ä¸” chroot_list_enable=YES æ—¶,# åªæœ‰ filename æ–‡ä»¶å†…æŒ‡å®šçš„ç”¨æˆ·ï¼ˆæ¯è¡Œä¸€ä¸ªç”¨æˆ·åï¼‰å¯ä»¥æ‰§è¡Œ chroot,# é»˜è®¤å€¼ä¸º /etc/vsftpd.chroot_list## 4. æœ¬åœ°ç”¨æˆ· é»‘/ç™½åå•ç®¡ç†#userlist_enable=&lt;YES/NO&gt; # æ˜¯å¦å¯ç”¨ userlist_file ç”¨æˆ·åˆ—è¡¨, é»˜è®¤ä¸º YESï¼Œè®¾ç½®ä¸ºNOçš„æ—¶å€™ï¼Œå¹¶ä¸”ç”¨æˆ·åä¸åœ¨é»‘åå•ï¼ˆuser_listï¼‰å¯ä»¥ç™»å½•ï¼Œå¹¶æŸ¥çœ‹ls ~ä¸­çš„æ–‡ä»¶userlist_deny=&lt;YES/NO&gt; # å½“ userlist_enable=YESï¼ˆå³å¯ç”¨ userlist_file ï¼‰æ—¶, åˆ™è¯¥å­—æ®µæ‰æœ‰æ•ˆã€‚# userlist_deny=YES: userlist_file ä¸º é»‘åå•, å³åœ¨è¯¥æ–‡ä»¶å†…çš„ç”¨æˆ·å‡ä¸å¯ç™»å½•, å…¶ä»–ç”¨æˆ·å¯ä»¥ç™»å½•# userlist_deny=NO: userlist_file ä¸º ç™½åå•, å³åœ¨è¯¥æ–‡ä»¶å†…çš„ç”¨æˆ·æ‰å¯ä»¥ç™»å½•, å…¶ä»–ç”¨æˆ·å‡ä¸å¯ç™»å½•userlist_file=&lt;filename&gt; # é»‘/ç™½åå•ç”¨æˆ·åˆ—è¡¨æ–‡ä»¶ï¼ˆæ¯è¡Œä¸€ä¸ªç”¨æˆ·åï¼‰,# æ˜¯é»‘åå•è¿˜æ˜¯ç™½åå•, æ ¹æ® userlist_deny çš„å€¼å†³å®š,# é»˜è®¤å€¼ä¸º /etc/vsftpd/user_list## 5. è¿æ¥ç›¸å…³#ftpd_banner=&lt;message&gt; # å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨åæ˜¾ç¤ºçš„æ¬¢è¿ä¿¡æ¯connect_timeout=&lt;n&gt; # è¿œç¨‹å®¢æˆ·ç«¯å“åº”ç«¯å£æ•°æ®è¿æ¥è¶…æ—¶æ—¶é—´, å•ä½ä¸ºç§’, é»˜è®¤ 60accept_connection_timeout=&lt;n&gt; # ç©ºé—²çš„æ•°æ®è¿æ¥è¶…æ—¶æ—¶é—´, å•ä½ä¸ºç§’, é»˜è®¤ 120data_connection_timeout=&lt;n&gt; # ç©ºé—²çš„ç”¨æˆ·ä¼šè¯è¶…æ—¶æ—¶é—´, å•ä½ä¸ºç§’, é»˜è®¤ 300max_clients=&lt;n&gt; # åœ¨ç‹¬ç«‹æ¨¡å¼è¿è¡Œæ—¶, æœ€å¤§è¿æ¥æ•°, 0 è¡¨ç¤ºæ— é™åˆ¶max_per_ip=&lt;n&gt; # åœ¨ç‹¬ç«‹æ¨¡å¼è¿è¡Œæ—¶, æ¯ IP çš„æœ€å¤§è¿æ¥æ•°, 0è¡¨ç¤ºæ— é™åˆ¶ å¦å¤–é»˜è®¤VsftpdåŒ¿åç”¨æˆ·æœ‰ä¸¤ä¸ªï¼šanonymousã€ftpï¼Œæ‰€ä»¥åŒ¿åç”¨æˆ·å¦‚æœéœ€è¦ä¸Šä¼ æ–‡ä»¶ã€åˆ é™¤åŠä¿®æ”¹ç­‰æƒé™ï¼Œéœ€è¦ftpç”¨æˆ·å¯¹&#x2F;var&#x2F;ftp&#x2F;pubç›®å½•æœ‰å†™å…¥æƒé™ï¼Œä½¿ç”¨å¦‚ä¸‹chownå’Œchmodä»»æ„ä¸€ç§å³å¯ï¼Œè®¾ç½®å‘½ä»¤å¦‚ä¸‹ï¼š 123chown -R ftp /var/ftp/pub/chgrp -R ftp /var/ftp/pub/chmod -R 766 /var/ftp/pub/ ç¡®è®¤ç«¯å£å¼€å¯çŠ¶æ€ 123456[root@localhost html]# systemctl start vsftpd[root@localhost html]# ss -ntulNetid State Recv-Q Send-Q Local Address:Port Peer Address:Porttcp LISTEN 0 128 0.0.0.0:22 0.0.0.0:*tcp LISTEN 0 32 *:21 *:*tcp LISTEN 0 128 [::]:22 [::]:*","categories":[{"name":"File Sharing Servers","slug":"File-Sharing-Servers","permalink":"https://kenryu.cc/zh/categories/File-Sharing-Servers/"}],"tags":[]},{"title":"æš—å·åŒ–æŠ€è¡“","slug":"Security/æš—å·åŒ–æŠ€è¡“","date":"2021-04-23T13:31:10.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2021/04/23/Security/æš—å·åŒ–æŠ€è¡“/","link":"","permalink":"https://kenryu.cc/zh/2021/04/23/Security/%E6%9A%97%E5%8F%B7%E5%8C%96%E6%8A%80%E8%A1%93/","excerpt":"","text":"å…±é€šéµ ä¸€å¯¹èƒ½ä¸Šé”å¹¶ä¸”è§£é”çš„é’¥åŒ™ å…¬é–‹éµ å…¬å¼€é’¥ï¼šè°éƒ½å¯ä»¥æ‹¥æœ‰ï¼Œåªèƒ½ä¸Šé”ğŸ”’ï¼Œä¸èƒ½å¼€é”âŒğŸ”“ å¯†é’¥ï¼šæ¥æ”¶è€…è‡ªå·±1äººæ‹¥æœ‰ï¼Œèƒ½å¼€é”ğŸ”“ å‘é€è€…å…ˆå¾—åˆ°æ¥æ”¶è€…çš„å…¬å¼€é’¥ ç»™å†…å®¹ä¸Šé”åå‘ç»™æ¥æ”¶è€… æ¥æ”¶è€…ç”¨è‡ªå·±çš„å¯†é’¥å¼€é” æ··åˆå¼SSHä¿®æ”¹å…¬å¼€é’¥åŒ™MACé’¥åŒ™ä½ç½®Offending RSA key /Users/cjl/.ssh/known_hosts æ–¹æ³•1åˆ é™¤æœ¬åœ°çš„é’¥åŒ™,å¹¶å¤‡ä»½æ—§é’¥åŒ™åˆ—è¡¨ssh-keygen -R 192.168.1.1 æ–¹æ³•2æ‰‹åŠ¨åˆ é™¤æœ¬åœ°çš„é’¥åŒ™vi /Users/cjl/.ssh/known_hosts","categories":[{"name":"Security","slug":"Security","permalink":"https://kenryu.cc/zh/categories/Security/"}],"tags":[{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://kenryu.cc/zh/tags/%E7%BD%91%E7%BB%9C/"},{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kenryu.cc/zh/tags/%E6%8A%80%E6%9C%AF/"}]},{"title":"Linux edit Route Table","slug":"Linux/Linux_edit_Route_Table","date":"2021-04-22T08:21:42.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2021/04/22/Linux/Linux_edit_Route_Table/","link":"","permalink":"https://kenryu.cc/zh/2021/04/22/Linux/Linux_edit_Route_Table/","excerpt":"","text":"View the current state of the routing tableOption 1ip route Option 2 minimal version need to install â€œnet-toolsâ€ package dnf -y install net-tools type the following command and hit Enter: netstat -rn Option 3 minimal version need to install â€œnet-toolsâ€ package type the following command and hit Enter: route Add a Static Route to the Linux Routing TableWhen the add or del options are used, route modifies the routing tables. Without these options, route displays the current contents of the routing tables. Option 1The target is a network route -p add -net network-address -gateway gateway-address Creates a route that must persist across system reboots. If you want the route to prevail only for the current session, do not use the -p option. Option 2The target is a host route -p add -host network-address -gateway gateway-address Remove a Static Route from the Linux Routing TableOption 1The target is a network route -p del -net network-address -gateway gateway-address Creates a route that must persist across system reboots. If you want the route to prevail only for the current session, do not use the -p option. Option 2The target is a host route -p del -host network-address -gateway gateway-address","categories":[{"name":"Linux","slug":"Linux","permalink":"https://kenryu.cc/zh/categories/Linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://kenryu.cc/zh/tags/linux/"},{"name":"network","slug":"network","permalink":"https://kenryu.cc/zh/tags/network/"},{"name":"server","slug":"server","permalink":"https://kenryu.cc/zh/tags/server/"}]},{"title":"Used iSCSI to connect storage","slug":"File_Sharing_Servers/Used_iSCSI_to_connect_storage","date":"2021-04-19T01:52:38.000Z","updated":"2025-12-19T08:19:46.062Z","comments":true,"path":"2021/04/19/File_Sharing_Servers/Used_iSCSI_to_connect_storage/","link":"","permalink":"https://kenryu.cc/zh/2021/04/19/File_Sharing_Servers/Used_iSCSI_to_connect_storage/","excerpt":"","text":"iSCSI Target Configuration:Step 0: Check the disk existslsblk Step 1:Prepare LVM12345678910[root@localhost ~]# vgcreate vgsan /dev/sdbPhysical volume &quot;/dev/sdb&quot; successfully createdVolume group &quot;vgsan&quot; successfully created[root@localhost ~]# lvcreate -n lvsan -l 100%VG /dev/vgsanLogical volume &quot;lvsan&quot; created.[root@localhost ~]# lvsLV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convertroot centos -wi-ao---- 6.67gswap centos -wi-ao---- 820.00mlvsan vgsan -wi-a----- 8.00g Step 2:Install softwareyum -y install targetcli Step 3:Enter the targetcli interfacetargetcli Step 3.1: Configure backstores/&gt; cd backstoresFirst thing is to configure a backstorage device from our previously configured lvm volume/backstores&gt; block/ create block1 /dev/vgsan/lvsan Step 3.2 :Configure IQNIQN is the unique identifier of each iSCSI-target. IQN follows strict naming convention. It is in iqn.YY-MM.[inverse-DNS]:[target name] format. We have to make to sure to follow this convention, otherwise iqn creation will fail. To create iqn, move to the iscsi section./backstores&gt; cd /iscsi/iscsi&gt; create iqn.2017-09.com.example:rock Step 3.3 : Create ACLCreate an ACL to allow â€œclient1â€ to access this target/iscsi/iqn.20....example:rock&gt; tpg1/acls/ create iqn.2017-09.com.example:client1 Step 3.4 : Create LUN/iscsi/iqn.20....example:rock&gt; tpg1/luns/ create /backstores/block/block1Now we will go back to targetcli root to get a whole picture of what we created so far.This completes the iscsi setup. Enter the command â€œexitâ€ to come out of the targetcli prompt. this also saves the configuration./&gt; exit Step 4: Service &amp; FW Configurationsystemctl start targetsystemctl enable targetfirewall-cmd --add-service=iscsi-target --zone=public --permanentfirewall-cmd --reload referenceshttps://rmahmood.tech/configuring-iscsi-on-centos-systems/ Initiator(Client) configuration:Step 0: Check the disk existsuse the â€œlsblkâ€ command , so later we can see the differencelsblk Step 1: Install Softwareyum -y install iscsi-initiator-utils Step 2: Edit or View InitiatorNamevi /etc/iscsi/initiatorname.iscsirestart the iscsid service to configuration change to take effect.systemctl restart iscsid Step 3: Discover iscsi targetiscsiadm --mode discovery --type sendtargets --portal 192.168.1.56 Step 4: Log into the targetiscsiadm --mode node --targetname iqn.2017-09.com.example:rock --portal 192.168.1.56:3260 --login Logout Targetiscsiadm --mode node --targetname iqn.2017-09.com.example:rock --portal 192.168.1.56:3260 --logout Step 5: Specifically check the iscsi deviceslsblk reference","categories":[{"name":"File Sharing Servers","slug":"File-Sharing-Servers","permalink":"https://kenryu.cc/zh/categories/File-Sharing-Servers/"}],"tags":[]},{"title":"Storage Benchmark (fio command)","slug":"Storage/Storage_Benchmark_(fio_command)","date":"2021-04-08T05:40:00.000Z","updated":"2025-12-19T08:19:46.062Z","comments":true,"path":"2021/04/08/Storage/Storage_Benchmark_(fio_command)/","link":"","permalink":"https://kenryu.cc/zh/2021/04/08/Storage/Storage_Benchmark_(fio_command)/","excerpt":"","text":"123456789101112# é¡ºåºå†™ï¼šfio -filename=/dev/md -direct=1 -iodepth 1 -thread -rw=write -ioengine=psync -bs=8M -size=60G -numjobs=64 -runtime=10 -group_reporting -name=file# é¡ºåºè¯»ï¼šfio -filename=/dev/md -direct=1 -iodepth 1 -thread -rw=read -ioengine=psync -bs=8M -size=60G -numjobs=64 -runtime=10 -group_reporting -name=file# éšæœºå†™ï¼šfio -filename=/dev/md -direct=1 -iodepth 1 -thread -rw=randwrite -ioengine=psync -bs=8M -size=60G -numjobs=64 -runtime=10 -group_reporting -name=file# éšæœºè¯»ï¼šfio -filename=/dev/md -direct=1 -iodepth 1 -thread -rw=randread -ioengine=psync -bs=8M -size=60G -numjobs=64 -runtime=10 -group_reporting -name=file# æ··åˆéšæœºè¯»å†™ï¼šfio -filename=/dev/md -direct=1 -iodepth 1 -thread -rw=randrw -rwmixread=30 -ioengine=psync -bs=8M -size=60G -numjobs=64 -runtime=10 -group_reporting -name=file -ioscheduler=noop# å½“ç›®æ ‡ä¸ºDirectoryçš„æ—¶å€™fio -directory=/mnt/ -direct=1 -iodepth 1 -thread -rw=write -ioengine=psync -bs=8M -size=60G -numjobs=64 -runtime=10 -group_reporting -name=file 12345umount -l 10.0.1.2:/mnt/nas/nasmount -t nfs 10.0.1.2:/mnt/nas/nas /mntmount -t nfs -o nolock,timeo=15 10.0.1.2:/mnt/nas/nas /mntmount -t nfs 10.0.1.2:/mnt/nas/nas /mnt -o nolock, rsize=1024,wsize=1024,timeo=15mount -t nfs -o rsize=131072,wsize=131072 10.0.1.2:/mnt/nas/nas /mnt","categories":[{"name":"Storage","slug":"Storage","permalink":"https://kenryu.cc/zh/categories/Storage/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://kenryu.cc/zh/tags/linux/"},{"name":"server","slug":"server","permalink":"https://kenryu.cc/zh/tags/server/"},{"name":"storage","slug":"storage","permalink":"https://kenryu.cc/zh/tags/storage/"}]},{"title":"Binary Search","slug":"Sort-Algorithm/Binary-Search","date":"2020-09-29T15:00:00.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2020/09/30/Sort-Algorithm/Binary-Search/","link":"","permalink":"https://kenryu.cc/zh/2020/09/30/Sort-Algorithm/Binary-Search/","excerpt":"","text":"123456789101112131415161718#ifndef ALGORITHM_BINARY_SEARCH_METHOD_H#define ALGORITHM_BINARY_SEARCH_METHOD_H/* äºŒåˆ†æ¢ç´¢ */int binary_search (int list[], int list_size, int x) &#123; int left, right, mid; left = 0; right = list_size - 1; while (left &lt;= right) &#123; mid = (left + right)/2; if (list[mid] == x) &#123; return mid; &#125; else if (list[mid] &lt; x) &#123; left = mid + 1; &#125; else &#123; right = mid - 1; &#125; &#125; return -1;&#125;#endif //ALGORITHM_BINARY_SEARCH_METHOD_H","categories":[{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/categories/Algorithm/"}],"tags":[{"name":"C","slug":"C","permalink":"https://kenryu.cc/zh/tags/C/"},{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/tags/Algorithm/"},{"name":"FE","slug":"FE","permalink":"https://kenryu.cc/zh/tags/FE/"}]},{"title":"Bubble Sort","slug":"Sort-Algorithm/Bubble-Sort","date":"2020-09-29T15:00:00.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2020/09/30/Sort-Algorithm/Bubble-Sort/","link":"","permalink":"https://kenryu.cc/zh/2020/09/30/Sort-Algorithm/Bubble-Sort/","excerpt":"","text":"12345678910111213141516171819202122232425262728#ifndef ALGORITHM_BUBBLE_SORT_H#define ALGORITHM_BUBBLE_SORT_H/* ãƒãƒ–ãƒ«ã‚½ãƒ¼ãƒˆ */void bubble_sort (int *array, int array_size) &#123; int i, j;// for (i = 0; i &lt; array_size - 1; i++)&#123;// for (j = array_size - 1; j &gt;= i + 1; j--)&#123; // å³ã‹ã‚‰å·¦ã«æ“ä½œ// if (array[j] &lt; array[j-1]) &#123;// swap(&amp;array[j], &amp;array[j-1]);// &#125;// &#125;// printf(&quot;step %2d: &quot;,i);// print_array(array,array_size);// &#125; for(i=0;i&lt;array_size-1;i++)&#123; for(j=0;j&lt;array_size-1-i;j++)&#123;//å·¦ã‹ã‚‰å³ã«æ“ä½œ if(array[j]&gt;array[j+1])&#123; swap(&amp;array[j],&amp;array[j+1]); &#125; &#125; printf(&quot;step %2d: &quot;,i+1); print_array(array,array_size); &#125;&#125;#endif //ALGORITHM_BUBBLE_SORT_H","categories":[{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/categories/Algorithm/"}],"tags":[{"name":"C","slug":"C","permalink":"https://kenryu.cc/zh/tags/C/"},{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/tags/Algorithm/"},{"name":"FE","slug":"FE","permalink":"https://kenryu.cc/zh/tags/FE/"}]},{"title":"Function Head","slug":"Sort-Algorithm/Function-Head","date":"2020-09-29T15:00:00.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2020/09/30/Sort-Algorithm/Function-Head/","link":"","permalink":"https://kenryu.cc/zh/2020/09/30/Sort-Algorithm/Function-Head/","excerpt":"","text":"123456789101112131415161718192021#ifndef ALGORITHM_FUNCTION_H#define ALGORITHM_FUNCTION_H/* å€¤ã‚’äº¤æ›ã™ã‚‹é–¢æ•° */void swap (int *x, int *y) &#123; int temp; // å€¤ã‚’ä¸€æ™‚ä¿å­˜ã™ã‚‹å¤‰æ•° temp = *x; *x = *y; *y = temp;&#125;/*ä¸€æ¬¡é…åˆ—ã‚’å‡ºåŠ›ã™ã‚‹é–¢æ•°*/void print_array(int array[], int array_size)&#123; int i; for (i = 0; i &lt; array_size; i++) &#123; printf(&quot;%d &quot;, array[i]); &#125; printf(&quot;\\n&quot;);&#125;#endif //ALGORITHM_FUNCTION_H","categories":[{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/categories/Algorithm/"}],"tags":[{"name":"C","slug":"C","permalink":"https://kenryu.cc/zh/tags/C/"},{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/tags/Algorithm/"},{"name":"FE","slug":"FE","permalink":"https://kenryu.cc/zh/tags/FE/"}]},{"title":"Global Head","slug":"Sort-Algorithm/Global-Head","date":"2020-09-29T15:00:00.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2020/09/30/Sort-Algorithm/Global-Head/","link":"","permalink":"https://kenryu.cc/zh/2020/09/30/Sort-Algorithm/Global-Head/","excerpt":"","text":"12345678910111213141516#ifndef ALGORITHM_GLOBAL_H#define ALGORITHM_GLOBAL_H#include&lt;stdio.h&gt;#include&quot;function.h&quot;#include&quot;selection_sort.h&quot;#include&quot;bubble_sort.h&quot;#include&quot;merge_sort.h&quot;#include&quot;insertion_sort.h&quot;#include&quot;shell_sort.h&quot;#include&quot;quick_sort.h&quot;#include&quot;heap_sort.h&quot;#include&quot;linear_search_method.h&quot;#include&quot;binary_search_method.h&quot;#include&quot;hash_table_search_method.h&quot;#endif //ALGORITHM_GLOBAL_H","categories":[{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/categories/Algorithm/"}],"tags":[{"name":"C","slug":"C","permalink":"https://kenryu.cc/zh/tags/C/"},{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/tags/Algorithm/"},{"name":"FE","slug":"FE","permalink":"https://kenryu.cc/zh/tags/FE/"}]},{"title":"Heap Sort","slug":"Sort-Algorithm/Heap-Sort","date":"2020-09-29T15:00:00.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2020/09/30/Sort-Algorithm/Heap-Sort/","link":"","permalink":"https://kenryu.cc/zh/2020/09/30/Sort-Algorithm/Heap-Sort/","excerpt":"","text":"12345678910111213141516171819202122232425262728293031#ifndef ALGORITHM_HEAP_SORT_H#define ALGORITHM_HEAP_SORT_H/* pushdownæ“ä½œ */void pushdown (int array[], int first, int last) &#123; int parent = first; // è¦ª int child = 2*parent; // å·¦ã®å­ while (child &lt;= last) &#123; if ((child &lt; last) &amp;&amp; (array[child] &lt; array[child+1])) &#123; child++; // å³ã®å­ã®æ–¹ãŒå¤§ãã„ã¨ãã€å³ã®å­ã‚’æ¯”è¼ƒå¯¾è±¡ã«è¨­å®š &#125; if (array[child] &lt;= array[parent]) &#123; break; &#125; // ãƒ’ãƒ¼ãƒ—æ¸ˆã¿ swap(&amp;array[child], &amp;array[parent]); parent = child; child = 2* parent; &#125;&#125;/* ãƒ’ãƒ¼ãƒ—ã‚½ãƒ¼ãƒˆ */void heap_sort (int array[], int array_size) &#123; int i; for (i = array_size/2; i &gt;= 1; i--) &#123; pushdown(array, i, array_size); // å…¨ä½“ã‚’ãƒ’ãƒ¼ãƒ—åŒ– &#125; for (i = array_size; i &gt;= 2; i--) &#123; swap(&amp;array[1], &amp;array[i]); // æœ€å¤§ã®ã‚‚ã®ã‚’æœ€å¾Œã« pushdown(array, 1, i-1); // ãƒ’ãƒ¼ãƒ—å†æ§‹ç¯‰ &#125;&#125;#endif //ALGORITHM_HEAP_SORT_H","categories":[{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/categories/Algorithm/"}],"tags":[{"name":"C","slug":"C","permalink":"https://kenryu.cc/zh/tags/C/"},{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/tags/Algorithm/"},{"name":"FE","slug":"FE","permalink":"https://kenryu.cc/zh/tags/FE/"}]},{"title":"Insertion Sort","slug":"Sort-Algorithm/Insertion-Sort","date":"2020-09-29T15:00:00.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2020/09/30/Sort-Algorithm/Insertion-Sort/","link":"","permalink":"https://kenryu.cc/zh/2020/09/30/Sort-Algorithm/Insertion-Sort/","excerpt":"","text":"1234567891011121314151617181920212223242526272829303132333435#ifndef ALGORITHM_INSERTION_SORT_H#define ALGORITHM_INSERTION_SORT_H/* æŒ¿å…¥ã‚½ãƒ¼ãƒˆ */void insertion_sort (int array[], int array_size) &#123; int i, j; for (i = 1; i &lt; array_size; i++) &#123; // å…ˆé ­ã‹ã‚‰é †ã«ã‚½ãƒ¼ãƒˆ j = i; while ((j &gt; 0) &amp;&amp; (array[j-1] &gt; array[j])) &#123; //æ•´åˆ—æ¸ˆã¿ã®å ´åˆã¯å‡¦ç†ã—ãªã„ swap(&amp;array[j-1], &amp;array[j]); // æ•´åˆ—ã•ã‚Œã¦ã„ãªã„è¦ç´ ã‚’äº¤æ› j--; &#125; printf(&quot;step %2d: &quot;,i); print_array(array,array_size); &#125;&#125;//void insertion_sort (int array[], int array_size) &#123;// int i, j, k,l;// for(j=1;j&lt;array_size;j++)&#123;// for(i=0;i&lt;j;i++)&#123;// if(array[j]&lt;array[i])&#123;// k=array[j];// for(l=j;l&gt;i;l--)&#123;// array[l]=array[l-1];// &#125;// array[i]=k;// &#125;// &#125;// printf(&quot;step %2d: &quot;,j);// print_array(array,array_size);// &#125;//&#125;#endif //ALGORITHM_INSERTION_SORT_H","categories":[{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/categories/Algorithm/"}],"tags":[{"name":"C","slug":"C","permalink":"https://kenryu.cc/zh/tags/C/"},{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/tags/Algorithm/"},{"name":"FE","slug":"FE","permalink":"https://kenryu.cc/zh/tags/FE/"}]},{"title":"Main.c","slug":"Sort-Algorithm/Main.c","date":"2020-09-29T15:00:00.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2020/09/30/Sort-Algorithm/Main.c/","link":"","permalink":"https://kenryu.cc/zh/2020/09/30/Sort-Algorithm/Main.c/","excerpt":"","text":"123456789101112131415161718192021222324252627282930313233343536#include&quot;global.h&quot;int main (void) &#123; int array[10] = &#123; 2, 1, 8, 5, 4, 7, 9, 0, 6, 3 &#125;; int array_size=sizeof(array) / sizeof(int); printf(&quot;step %2d: &quot;,0); print_array(array,array_size);// selection_sort(array, array_size);// bubble_sort(array, array_size);// merge_sort(array, 0, 9);// insertion_sort(array, array_size); shell_sort(array, array_size);// quick_sort(array, 0, 9);// heap_sort(array, 9); print_array(array,10); return 0;// int list[10] = &#123;0, 4, 9, 10, 13, 17, 25, 36, 37, 40&#125;;// int x;// int answer;//// printf(&quot;x?&gt; &quot;);// scanf(&quot;%d&quot;, &amp;x);//// answer = liner_search(list, 10, x);// answer = sorted_liner_search(list, 10, x);// answer = binary_search(list, 10, x);//// if (answer != -1) &#123;// printf(&quot;%d\\n&quot;, answer);// &#125;else&#123;// printf(&quot;not exist\\n&quot;);// &#125;&#125;","categories":[{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/categories/Algorithm/"}],"tags":[{"name":"C","slug":"C","permalink":"https://kenryu.cc/zh/tags/C/"},{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/tags/Algorithm/"},{"name":"FE","slug":"FE","permalink":"https://kenryu.cc/zh/tags/FE/"}]},{"title":"Merge Sort","slug":"Sort-Algorithm/Merge-Sort","date":"2020-09-29T15:00:00.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2020/09/30/Sort-Algorithm/Merge-Sort/","link":"","permalink":"https://kenryu.cc/zh/2020/09/30/Sort-Algorithm/Merge-Sort/","excerpt":"","text":"1234567891011121314151617181920212223242526272829303132333435363738394041#ifndef ALGORITHM_MERGE_SORT_H#define ALGORITHM_MERGE_SORT_H/* ãƒãƒ¼ã‚¸ã‚½ãƒ¼ãƒˆ */void merge_sort (int array[], int left, int right) &#123; int i, j, k, mid,l; int work[10]; // ä½œæ¥­ç”¨é…åˆ— if (left &lt; right) &#123; mid = (left + right)/2; // çœŸã‚“ä¸­ã®Index merge_sort(array, left, mid); // å†å¸°é–¢æ•°ã«ã‚ˆã‚‹å·¦ã‚’æ•´åˆ— merge_sort(array, mid+1, right); // å†å¸°é–¢æ•°ã«ã‚ˆã‚‹å³ã‚’æ•´åˆ— for (i = mid; i &gt;= left; i--) &#123;// å·¦åŠåˆ† work[i] = array[i]; &#125; for (j = mid+1; j &lt;= right; j++) &#123; work[right-(j-(mid+1))] = array[j]; // å³åŠåˆ†ã‚’é€†é † &#125; i = left; j = right; for (k = left; k &lt;= right; k++) &#123; if (work[i] &lt; work[j]) &#123; array[k] = work[i++]; &#125;else&#123; array[k] = work[j--]; &#125; &#125; for (l = 0; l &lt;= right; l++) &#123; printf(&quot;%d &quot;, work[l]); if(l==mid)&#123; printf(&quot;| &quot;); &#125; &#125; printf(&quot;\\n&quot;); &#125;// printf(&quot;step %2d: &quot;,k);// print_array(array,10);&#125;#endif //ALGORITHM_MERGE_SORT_H","categories":[{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/categories/Algorithm/"}],"tags":[{"name":"C","slug":"C","permalink":"https://kenryu.cc/zh/tags/C/"},{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/tags/Algorithm/"},{"name":"FE","slug":"FE","permalink":"https://kenryu.cc/zh/tags/FE/"}]},{"title":"Quick Sort","slug":"Sort-Algorithm/Quick-Sort","date":"2020-09-29T15:00:00.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2020/09/30/Sort-Algorithm/Quick-Sort/","link":"","permalink":"https://kenryu.cc/zh/2020/09/30/Sort-Algorithm/Quick-Sort/","excerpt":"","text":"12345678910111213141516171819202122232425262728293031323334353637383940#ifndef ALGORITHM_QUICK_SORT_H#define ALGORITHM_QUICK_SORT_H/**** pivotã‚’æ±ºã‚ã€* å…¨ãƒ‡ãƒ¼ã‚¿ã‚’pivotã‚’å¢ƒç›®ã«æŒ¯ã‚Šåˆ†ã‘ã€* pivotã®æ·»ãˆå­—ã‚’è¿”ã™***/int partition (int array[], int left, int right) &#123; int i, j, pivot; i = left; j = right + 1; pivot = left; // å…ˆé ­è¦ç´ ã‚’pivotã¨ã™ã‚‹ do &#123; do &#123; i++; &#125; while (array[i] &lt; array[pivot]); do &#123; j--; &#125; while (array[pivot] &lt; array[j]); // pivotã‚ˆã‚Šå°ã•ã„ã‚‚ã®ã‚’å·¦ã¸ã€å¤§ãã„ã‚‚ã®ã‚’å³ã¸ if (i &lt; j) &#123; swap(&amp;array[i], &amp;array[j]); &#125; &#125; while (i &lt; j); swap(&amp;array[pivot], &amp;array[j]); //pivotã‚’æ›´æ–° return j;&#125;/* ã‚¯ã‚¤ãƒƒã‚¯ã‚½ãƒ¼ãƒˆ */void quick_sort (int array[], int left, int right) &#123; int pivot; if (left &lt; right) &#123; pivot = partition(array, left, right); quick_sort(array, left, pivot-1); // pivotã‚’å¢ƒã«å†å¸°çš„ã«ã‚¯ã‚¤ãƒƒã‚¯ã‚½ãƒ¼ãƒˆ quick_sort(array, pivot+1, right); &#125; print_array(array,10);&#125;#endif //ALGORITHM_QUICK_SORT_H","categories":[{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/categories/Algorithm/"}],"tags":[{"name":"C","slug":"C","permalink":"https://kenryu.cc/zh/tags/C/"},{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/tags/Algorithm/"},{"name":"FE","slug":"FE","permalink":"https://kenryu.cc/zh/tags/FE/"}]},{"title":"Selection Sort","slug":"Sort-Algorithm/Selection-Sort","date":"2020-09-29T15:00:00.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2020/09/30/Sort-Algorithm/Selection-Sort/","link":"","permalink":"https://kenryu.cc/zh/2020/09/30/Sort-Algorithm/Selection-Sort/","excerpt":"","text":"123456789101112131415161718192021222324252627#ifndef ALGORITHM_SELECTION_SORT_H#define ALGORITHM_SELECTION_SORT_H/* é¸æŠã‚½ãƒ¼ãƒˆ * æœ€å°å€¤ï¼ˆã¾ãŸã¯æœ€å¤§å€¤ï¼‰ã‚’è¦‹ã¤ã‘ã¦ã€å…ˆé ­ã«ç§»å‹•ã€‚2ç•ªç›®ã«å°ã•ã„ï¼ˆã¾ãŸã¯å¤§ãã„ï¼‰è¦ç´ ã‚’è¦‹ã¤ã‘ã¦ã€2ç•ªç›®ã«ç§»å‹•ã€‚ * ã“ã‚Œã‚’ è¦ç´ æ•°-1ç•ªç›® ã¾ã§ç¹°ã‚Šè¿”ã—ã¦ã€æ•´åˆ—ã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã€‚ * åˆ†ã‹ã‚Šã‚„ã™ã„ãŒã€é…ã„ã€‚å®‰å®šã§ã¯ãªã„ã€‚ * æ¯”è¼ƒå›æ•°=(n-1)+(n-2)+...+2+1=n(n-1)/2=O(n^2) * swapå›æ•°=n-1 */void selection_sort (int array[], int array_size) &#123; int i, j, min_index; for (i = 0; i &lt; array_size-1; i++) &#123; min_index = i; // å…ˆé ­è¦ç´ ãŒä¸€ç•ªå°ã•ã„ã¨ã™ã‚‹ for (j = i + 1; j &lt; array_size; j++) &#123; if (array[j] &lt; array[min_index]) &#123; min_index = j; &#125; // å€¤ã®æ¯”è¼ƒã€æœ€å°å€¤ã®æ›´æ–° &#125; swap(&amp;array[min_index], &amp;array[i]); // æœ€å°å€¤ã¨å…ˆé ­è¦ç´ ã‚’äº¤æ› printf(&quot;step %2d: &quot;,i+1); print_array(array,array_size); &#125;&#125;#endif //ALGORITHM_SELECTION_SORT_H","categories":[{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/categories/Algorithm/"}],"tags":[{"name":"C","slug":"C","permalink":"https://kenryu.cc/zh/tags/C/"},{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/tags/Algorithm/"},{"name":"FE","slug":"FE","permalink":"https://kenryu.cc/zh/tags/FE/"}]},{"title":"Shell Sort","slug":"Sort-Algorithm/Shell-Sort","date":"2020-09-29T15:00:00.000Z","updated":"2025-12-19T08:19:46.063Z","comments":true,"path":"2020/09/30/Sort-Algorithm/Shell-Sort/","link":"","permalink":"https://kenryu.cc/zh/2020/09/30/Sort-Algorithm/Shell-Sort/","excerpt":"","text":"123456789101112131415161718192021#ifndef ALGORITHM_SHELL_SORT_H#define ALGORITHM_SHELL_SORT_H/* ã‚·ã‚§ãƒ«ã‚½ãƒ¼ãƒˆ */void shell_sort (int array[], int array_size) &#123; int i, j, h; for (h = 1; h &lt;= array_size/9; h = 3*h + 1); // é–“éš”hã‚’æ±ºã‚ã‚‹ for ( ; h &gt; 0; h /= 3) &#123; // hã‚’ç‹­ã‚ã¦ã„ã /* ä»¥ä¸‹ã€æŒ¿å…¥ã‚½ãƒ¼ãƒˆã¨ã»ã¼åŒã˜ */ for (i = h; i &lt; array_size; i++) &#123; j = i; while ((j &gt; h - 1) &amp;&amp; (array[j-h] &gt; array[j])) &#123; swap(&amp;array[j-h], &amp;array[j]); j -= h; &#125; &#125;// printf(&quot;step %2d: &quot;,h);// print_array(array,array_size); &#125;&#125;#endif //ALGORITHM_SHELL_SORT_H","categories":[{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/categories/Algorithm/"}],"tags":[{"name":"C","slug":"C","permalink":"https://kenryu.cc/zh/tags/C/"},{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/tags/Algorithm/"},{"name":"FE","slug":"FE","permalink":"https://kenryu.cc/zh/tags/FE/"}]}],"categories":[{"name":"Linux","slug":"Linux","permalink":"https://kenryu.cc/zh/categories/Linux/"},{"name":"macOS","slug":"macOS","permalink":"https://kenryu.cc/zh/categories/macOS/"},{"name":"Storage","slug":"Storage","permalink":"https://kenryu.cc/zh/categories/Storage/"},{"name":"Windows","slug":"Windows","permalink":"https://kenryu.cc/zh/categories/Windows/"},{"name":"ZFS","slug":"ZFS","permalink":"https://kenryu.cc/zh/categories/ZFS/"},{"name":"File Sharing Servers","slug":"File-Sharing-Servers","permalink":"https://kenryu.cc/zh/categories/File-Sharing-Servers/"},{"name":"Network","slug":"Network","permalink":"https://kenryu.cc/zh/categories/Network/"},{"name":"Security","slug":"Security","permalink":"https://kenryu.cc/zh/categories/Security/"},{"name":"Redmine","slug":"Redmine","permalink":"https://kenryu.cc/zh/categories/Redmine/"},{"name":"Virtualization","slug":"Virtualization","permalink":"https://kenryu.cc/zh/categories/Virtualization/"},{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/categories/Algorithm/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://kenryu.cc/zh/tags/linux/"},{"name":"storage","slug":"storage","permalink":"https://kenryu.cc/zh/tags/storage/"},{"name":"smb","slug":"smb","permalink":"https://kenryu.cc/zh/tags/smb/"},{"name":"webdav","slug":"webdav","permalink":"https://kenryu.cc/zh/tags/webdav/"},{"name":"sftp","slug":"sftp","permalink":"https://kenryu.cc/zh/tags/sftp/"},{"name":"windows","slug":"windows","permalink":"https://kenryu.cc/zh/tags/windows/"},{"name":"macOS","slug":"macOS","permalink":"https://kenryu.cc/zh/tags/macOS/"},{"name":"git","slug":"git","permalink":"https://kenryu.cc/zh/tags/git/"},{"name":"blog","slug":"blog","permalink":"https://kenryu.cc/zh/tags/blog/"},{"name":"shell","slug":"shell","permalink":"https://kenryu.cc/zh/tags/shell/"},{"name":"zsh","slug":"zsh","permalink":"https://kenryu.cc/zh/tags/zsh/"},{"name":"console","slug":"console","permalink":"https://kenryu.cc/zh/tags/console/"},{"name":"aws","slug":"aws","permalink":"https://kenryu.cc/zh/tags/aws/"},{"name":"Server","slug":"Server","permalink":"https://kenryu.cc/zh/tags/Server/"},{"name":"Nginx","slug":"Nginx","permalink":"https://kenryu.cc/zh/tags/Nginx/"},{"name":"MySQL","slug":"MySQL","permalink":"https://kenryu.cc/zh/tags/MySQL/"},{"name":"PHP","slug":"PHP","permalink":"https://kenryu.cc/zh/tags/PHP/"},{"name":"ZFS","slug":"ZFS","permalink":"https://kenryu.cc/zh/tags/ZFS/"},{"name":"Storage","slug":"Storage","permalink":"https://kenryu.cc/zh/tags/Storage/"},{"name":"server","slug":"server","permalink":"https://kenryu.cc/zh/tags/server/"},{"name":"network","slug":"network","permalink":"https://kenryu.cc/zh/tags/network/"},{"name":"vpn","slug":"vpn","permalink":"https://kenryu.cc/zh/tags/vpn/"},{"name":"kvm","slug":"kvm","permalink":"https://kenryu.cc/zh/tags/kvm/"},{"name":"hypervisor","slug":"hypervisor","permalink":"https://kenryu.cc/zh/tags/hypervisor/"},{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","permalink":"https://kenryu.cc/zh/tags/%E7%BD%91%E7%BB%9C/"},{"name":"æŠ€æœ¯","slug":"æŠ€æœ¯","permalink":"https://kenryu.cc/zh/tags/%E6%8A%80%E6%9C%AF/"},{"name":"C","slug":"C","permalink":"https://kenryu.cc/zh/tags/C/"},{"name":"Algorithm","slug":"Algorithm","permalink":"https://kenryu.cc/zh/tags/Algorithm/"},{"name":"FE","slug":"FE","permalink":"https://kenryu.cc/zh/tags/FE/"}]}