<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Kenryu</title>
  
  <subtitle>hello there.</subtitle>
  <link href="https://kenryu.cc/ja/atom.xml" rel="self"/>
  
  <link href="https://kenryu.cc/ja/"/>
  <updated>2025-12-17T12:11:31.415Z</updated>
  <id>https://kenryu.cc/ja/</id>
  
  <author>
    <name>Kenryu</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä¸‰æ­¥é…ç½®ï¼ˆæˆ‘ä»¬å–œæ¬¢çš„ï¼‰ç»ˆç«¯è½¯ä»¶ for macOS/ Windows</title>
    <link href="https://kenryu.cc/ja/2025/12/17/Windows/%E4%B8%89%E6%AD%A5%E9%85%8D%E7%BD%AE%EF%BC%88%E6%88%91%E4%BB%AC%E5%96%9C%E6%AC%A2%E7%9A%84%EF%BC%89%E7%BB%88%E7%AB%AF%E8%BD%AF%E4%BB%B6_for_macOS_or_Windows/"/>
    <id>https://kenryu.cc/ja/2025/12/17/Windows/%E4%B8%89%E6%AD%A5%E9%85%8D%E7%BD%AE%EF%BC%88%E6%88%91%E4%BB%AC%E5%96%9C%E6%AC%A2%E7%9A%84%EF%BC%89%E7%BB%88%E7%AB%AF%E8%BD%AF%E4%BB%B6_for_macOS_or_Windows/</id>
    <published>2025-12-17T11:30:30.000Z</published>
    <updated>2025-12-17T12:11:31.415Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¤§æ¦‚æ€è·¯"><a href="#å¤§æ¦‚æ€è·¯" class="headerlink" title="å¤§æ¦‚æ€è·¯"></a>å¤§æ¦‚æ€è·¯</h2><ol><li>å®‰è£…ä¾èµ–</li><li>é…ç½®Git&#x2F;GitHUB</li><li>ä»GitHubå…‹éš†Dotfiles</li></ol><h2 id="Step1-å®‰è£…ä¾èµ–"><a href="#Step1-å®‰è£…ä¾èµ–" class="headerlink" title="Step1. å®‰è£…ä¾èµ–"></a>Step1. å®‰è£…ä¾èµ–</h2><h3 id="ä¸‹è½½æˆ‘ä»¬å–œæ¬¢Consoleè½¯ä»¶"><a href="#ä¸‹è½½æˆ‘ä»¬å–œæ¬¢Consoleè½¯ä»¶" class="headerlink" title="ä¸‹è½½æˆ‘ä»¬å–œæ¬¢Consoleè½¯ä»¶"></a>ä¸‹è½½æˆ‘ä»¬å–œæ¬¢Consoleè½¯ä»¶</h3><p>éšæ„é€‰æ‹©ä½ å–œæ¬¢çš„ï¼š<br>MacOSï¼šiTerm2ï¼Œalacrrityï¼ŒTabbyï¼Œetcã€‚<br>Windowsï¼šTerminalï¼ŒTeraTermï¼Œetcã€‚</p><h3 id="Zsh"><a href="#Zsh" class="headerlink" title="Zsh"></a>Zsh</h3><ul><li>Oh-my-zsh(zsh manager)</li><li>Powerlevel10k(zsh theme)</li><li>Zsh-syntax-highlighting</li><li>Zsh-autosuggestions</li></ul><h3 id="Nerd-Font"><a href="#Nerd-Font" class="headerlink" title="Nerd Font"></a>Nerd Font</h3><ul><li><a href="https://github.com/romkatv/powerlevel10k#meslo-nerd-font-patched-for-powerlevel10k">MesloLGS NF</a> (Install on your OS and set terminal emulator font for powerlevel10k theme)</li></ul><h2 id="Step2-é…ç½®Git-x2F-GitHub"><a href="#Step2-é…ç½®Git-x2F-GitHub" class="headerlink" title="Step2. é…ç½®Git&#x2F;GitHub"></a>Step2. é…ç½®Git&#x2F;GitHub</h2><p>ç™»é™†GitHUB</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure><p>Before<br><img src="/resources/ssh_test_before.png" alt="ssh_test_before.png"><br>After<br><img src="/resources/ssh_test_after.png" alt="ssh_test_after.png"></p><p>åœ¨è®¾ç½®gitçš„ç”¨æˆ·å&amp;é‚®ç®±è´¦å·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;k3nryu&quot;</span><br><span class="line">git config --global user.email &quot;tinkenryu@gmail.com&quot;</span><br></pre></td></tr></table></figure><p>æœ¬æœºä¸Šç”Ÿæˆä¸€å¯¹å…¬å¼€å¯†é’¥ï¼Œä¹‹åæˆ‘ä»¬æŠŠå…¬é’¥æ”¾è¿›ä¸ªäººGitHubçš„è´¦æˆ·é‡Œï¼Œå‘Šè¯‰GitHubè¿™å°æœºå™¨æ˜¯è‡ªå·±äººï¼Œä»è€Œå¯ä»¥è¿›è¡Œsshåè®®çš„å„é¡¹æ“ä½œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -C &quot;tinkenryu@gmail.com&quot;</span><br><span class="line">cat .ssh/id_rsa.pub</span><br></pre></td></tr></table></figure><p>ç™»å½•æˆ‘ä»¬çš„Githubè´¦å·ï¼Œå¹¶ç²˜è´´ä¸Šé¢çš„å…¬é’¥ã€‚<br><a href="https://github.com/settings/keys">https://github.com/settings/keys</a><br>ç¡®è®¤èƒ½ä¸èƒ½é€šè¿‡sshè¿ä¸ŠGitHubçš„æœåŠ¡å™¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure><h2 id="Step3-ä»GitHubå…‹éš†Dotfiles"><a href="#Step3-ä»GitHubå…‹éš†Dotfiles" class="headerlink" title="Step3. ä»GitHubå…‹éš†Dotfiles"></a>Step3. ä»GitHubå…‹éš†Dotfiles</h2><p>Clone repositories to local.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --recursive -b macOS git@github.com:k3nryu/dotfiles.git</span><br></pre></td></tr></table></figure><p>Execute â€˜install.shâ€™ shell script.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docfiles/install.sh</span><br></pre></td></tr></table></figure><h2 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gitæ‹‰å–è¿œç¨‹åˆ°æœ¬åœ°</span></span><br><span class="line">git status</span><br><span class="line">git pull origin main/ master/ develop</span><br><span class="line"></span><br><span class="line"><span class="comment"># (Option/Recommand)åˆ›å»ºåˆ†æ”¯</span></span><br><span class="line">git checkout -b bugfix/xxx</span><br><span class="line">git checkout -b feature/yyy</span><br><span class="line">git checkout -b forZZZ/zzz</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœ¬åœ°ç¼–è¾‘Dotfiles</span></span><br><span class="line">vim xxx</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ”¹äº†ä»€ä¹ˆ</span></span><br><span class="line">git diff</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†æ®µæäº¤</span></span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;Fix few Bugs&quot;</span></span><br><span class="line"><span class="comment">#ä¸€æ¬¡commitåªåšä¸€ä»¶äº‹æƒ…ï¼ˆFix/Add/Updata/Refactorï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒæ­¥ä¸»åˆ†æ”¯</span></span><br><span class="line">git fetch origin <span class="comment">#</span></span><br><span class="line">git rebase origin/main</span><br><span class="line">or </span><br><span class="line">git merge origin/main</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨é€è¿œç«¯åˆ†æ”¯</span></span><br><span class="line">git push origin feature/yyy</span><br></pre></td></tr></table></figure><h2 id="Uninstall"><a href="#Uninstall" class="headerlink" title="Uninstall"></a>Uninstall</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf ~/dotfiles</span><br><span class="line"><span class="built_in">rm</span> -rf ~/.oh-my-zsh</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å¤§æ¦‚æ€è·¯&quot;&gt;&lt;a href=&quot;#å¤§æ¦‚æ€è·¯&quot; class=&quot;headerlink&quot; title=&quot;å¤§æ¦‚æ€è·¯&quot;&gt;&lt;/a&gt;å¤§æ¦‚æ€è·¯&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;å®‰è£…ä¾èµ–&lt;/li&gt;
&lt;li&gt;é…ç½®Git&amp;#x2F;GitHUB&lt;/li&gt;
&lt;li&gt;ä»GitHubå…‹éš†Dotfil</summary>
      
    
    
    
    <category term="macOS" scheme="https://kenryu.cc/ja/categories/macOS/"/>
    
    
    <category term="windows" scheme="https://kenryu.cc/ja/tags/windows/"/>
    
    <category term="macOS" scheme="https://kenryu.cc/ja/tags/macOS/"/>
    
    <category term="git" scheme="https://kenryu.cc/ja/tags/git/"/>
    
    <category term="blog" scheme="https://kenryu.cc/ja/tags/blog/"/>
    
    <category term="shell" scheme="https://kenryu.cc/ja/tags/shell/"/>
    
    <category term="zsh" scheme="https://kenryu.cc/ja/tags/zsh/"/>
    
    <category term="console" scheme="https://kenryu.cc/ja/tags/console/"/>
    
  </entry>
  
  <entry>
    <title>Amazon Linux 2ï¼ˆAWSï¼‰ã®root&amp;ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®SSHãƒ­ã‚°ã‚¤ãƒ³</title>
    <link href="https://kenryu.cc/ja/2022/08/03/Linux/Amazon_Linux_2%EF%BC%88AWS%EF%BC%89%E3%81%AEroot&amp;%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%81%AESSH%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3/"/>
    <id>https://kenryu.cc/ja/2022/08/03/Linux/Amazon_Linux_2%EF%BC%88AWS%EF%BC%89%E3%81%AEroot&amp;%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%81%AESSH%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3/</id>
    <published>2022-08-03T01:21:22.000Z</published>
    <updated>2025-12-17T10:20:06.385Z</updated>
    
    <content type="html"><![CDATA[<p>VNC ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã€<kbd>E</kbd>ã‚’æŠ¼ã—ã¾ã™ã€‚<br><img src="/resources/60ef1180c9404fae9955e7419591ae73.png" alt="vncviewer_1143x861_220803.png"></p><p>linux16ã®è¡Œã®å¾Œã‚ã«<code>rd.break</code>ã‚’è¿½è¨˜ã—ã€<kbd>CTRL</kbd> + <kbd>X</kbd>ã‚’æŠ¼ã—èµ·å‹•ã—ã¾ã™ã€‚<br><img src="/resources/a87ec93a3244470c9c4609bdb8ba6144.png" alt="vncviewer_1143x861_220803_1.png"></p><p>ä»¥ä¸‹ã®ã‚ˆã†ã«ã€rootãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’æ“ä½œã§ãã‚‹<code>switch_root:/#</code>ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã«ãŸã©ã‚Šç€ãã¾ã—ãŸã€‚<br><img src="/resources/a2dbd4a1eb5949ef846677664422bb7b.png" alt="vncviewer_1127x772_220803.png"></p><p>ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¾ã™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mount -o remount,rw /sysroot</span><br><span class="line"><span class="built_in">chroot</span> /sysroot</span><br><span class="line">passwd root</span><br></pre></td></tr></table></figure><p><img src="/resources/e142798769e049b8add32705c2fe2da6.png" alt="vncviewer_1127x772_220803_change_passwd.png"></p><p>ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€SeLinuxã‚’è¨­å®šã—ã¦ã€å†èµ·å‹•ã—ã¾ã™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">touch /.autorelabel</span><br><span class="line">exit</span><br><span class="line">exit</span><br></pre></td></tr></table></figure><p><img src="/resources/a8aea795b03e455aace65e8b005c17c3.png" alt="vncviewer_1127x772_220803_selinux.png"></p><p>ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ãŸã©ã‚Šç€ãã¾ã—ãŸã€rootã¨å…ˆç¨‹è¨­å®šã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚<br><img src="/resources/4c8ff34776b443aa8c82b80ac992bbe1.png" alt="vncviewer_1127x772_220803_login.png"></p><p>OSã‚’rootã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‚ˆã†ã«ã€<code>/etc/ssh/sshd_config</code> ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ï¼’ã‹æ‰€ã‚’ç·¨é›†ã—ã¾ã™ã€‚</p><p><img src="/resources/8a23132f267b4149b0efdf4f2f982885.png" alt="vncviewer_1127x772_220803_PermitRootLogin.png"></p><p><img src="/resources/355440df0fbb4062b2558c3fa2c923cd.png" alt="vncviewer_1127x772_220803_PermitPasswdLogin.png"></p><p>ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã€<code>/etc/ssh/sshd_config</code> è¨­å®šã‚’åæ˜ ã—ã¾ã™ã€‚ãã—ã¦ã€OSã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’èª¿ã¹ã¾ã™ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart sshd</span><br><span class="line">hostname -I</span><br></pre></td></tr></table></figure><p><img src="/resources/08fead9e564e441aab1187f72102fb5b.png" alt="vncviewer_1127x772_220803_getIP.png"></p><p>ä»¥ä¸Šã®æ“ä½œã§ã€Amazon Linux ã®root ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ãŸã®ã§ã€ssh ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹çŠ¶æ…‹ã«ãªã‚Šã¾ã—ãŸã®ã§ã€ssh ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ã‚‡ã†ï¼<br><img src="/resources/f1b7cbe8eaf64ad6bfbcdd9650e9ff37.png" alt="WindowsTerminal_1118x718_220803.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;VNC ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã€&lt;kbd&gt;E&lt;/kbd&gt;ã‚’æŠ¼ã—ã¾ã™ã€‚&lt;br&gt;&lt;img src=&quot;/resources/60ef1180c9404fae9955e7419591ae73.png&quot; alt=&quot;vncviewer_1143x861_220803.png&quot;&gt;&lt;/p&gt;
&lt;p</summary>
      
    
    
    
    <category term="Linux" scheme="https://kenryu.cc/ja/categories/Linux/"/>
    
    
    <category term="linux" scheme="https://kenryu.cc/ja/tags/linux/"/>
    
    <category term="aws" scheme="https://kenryu.cc/ja/tags/aws/"/>
    
  </entry>
  
  <entry>
    <title>LSI Storage Authority (LSA) on Linux</title>
    <link href="https://kenryu.cc/ja/2022/06/30/Storage/LSI_Storage_Authority_(LSA)_on_Linux/"/>
    <id>https://kenryu.cc/ja/2022/06/30/Storage/LSI_Storage_Authority_(LSA)_on_Linux/</id>
    <published>2022-06-30T07:55:45.000Z</published>
    <updated>2022-06-30T13:52:05.000Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><p><img src="/resources/0095ad2ae257418a89d9961bbf3343f3.png" alt="chrome_1346x624_220630.png"></p><h5 id="step0-firewall-and-selinux"><a href="#step0-firewall-and-selinux" class="headerlink" title="step0. firewall and selinux"></a>step0. firewall and selinux</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --add-port=2463/tcp --permanent</span><br><span class="line">firewall-cmd --add-port=9000/tcp --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">firewall-cmd --list-all</span><br><span class="line"></span><br><span class="line">sed -i &#x27;s/^SELINUX=.*/SELINUX=disabled/&#x27; /etc/selinux/config</span><br><span class="line"></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h5 id="step1-From-following-URL-search-your-HBA-controller-and-download-LSA-packages"><a href="#step1-From-following-URL-search-your-HBA-controller-and-download-LSA-packages" class="headerlink" title="step1. From following URL search your HBA controller and download LSA packages"></a>step1. From following URL search your HBA controller and download LSA packages</h5><p><a href="https://www.broadcom.com/products/storage/raid-controllers">https://www.broadcom.com/products/storage/raid-controllers</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip x.x.x.x_LSA_Linux-x64.zip</span><br></pre></td></tr></table></figure><h5 id="step2-Download-and-install-OpenSLP"><a href="#step2-Download-and-install-OpenSLP" class="headerlink" title="step2. Download and install OpenSLP"></a>step2. Download and install OpenSLP</h5><p><a href="http://www.openslp.org/download.html">http://www.openslp.org/download.html</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall -y &#x27;Development Tools&#x27;</span><br><span class="line">wget https://jaist.dl.sourceforge.net/project/openslp/2.0.0/2.0.0%20Release/openslp-2.0.0.tar.gz</span><br><span class="line">tar -zxvf openslp-2.0.0.tar.gz</span><br><span class="line">cd openslp-2.0.0/</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">/usr/local/sbin/slpd stop</span><br></pre></td></tr></table></figure><h5 id="step3-Install-LSA"><a href="#step3-Install-LSA" class="headerlink" title="step3. Install LSA"></a>step3. Install LSA</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd x.x.x.x_LSA_Linux-x64/x64/</span><br><span class="line">./install.sh</span><br><span class="line">ln -sf /usr/local/lib/libslp.so.1.0.0 /opt/lsi/LSIStorageAuthority/bin/libslp.so.1</span><br><span class="line">/etc/init.d/LsiSASH restart</span><br></pre></td></tr></table></figure><p><img src="/resources/0ce63fe5c4884710a862af6a0c13eca3.png" alt="chrome_1920x1032_220630 (2.png).png"></p><p><img src="/resources/fb45842d17a9474ba4afcd4215851e8e.png" alt="chrome_1920x955_220630 (2.png).png"></p><p><img src="/resources/1fb96b3b6b20474eb0fe0443942834a0.png" alt="chrome_1920x1032_220630.png"></p><h5 id="Uninstall"><a href="#Uninstall" class="headerlink" title="Uninstall"></a>Uninstall</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/lsi/LSIStorageAuthority/uninstaller.sh</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/resources/0095ad2ae257418a89d9961bbf3343f3.png&quot; alt=&quot;chrome_1346x624_220630.png&quot;&gt;&lt;/p&gt;
&lt;h5 id=&quot;step0-firewall-and-</summary>
      
    
    
    
    <category term="Storage" scheme="https://kenryu.cc/ja/categories/Storage/"/>
    
    
  </entry>
  
  <entry>
    <title>Make Unix terminal beautiful &amp; productive</title>
    <link href="https://kenryu.cc/ja/2022/05/25/Linux/Make_Unix_terminal_beautiful_&amp;_productive/"/>
    <id>https://kenryu.cc/ja/2022/05/25/Linux/Make_Unix_terminal_beautiful_&amp;_productive/</id>
    <published>2022-05-25T04:12:17.000Z</published>
    <updated>2022-06-30T13:52:05.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/resources/c64efe2ef23a48c9916d40d47ddedbcb.gif" alt="iShot_0004-06-30_21.30.44.gif"></p><p>First of all, check the activated shell using this command.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo $SHELL</span><br></pre></td></tr></table></figure><p>The below command will display all the available shell.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/shells</span><br></pre></td></tr></table></figure><h2 id="Install-ZSH"><a href="#Install-ZSH" class="headerlink" title="Install ZSH"></a>Install ZSH</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dnf -y install zsh</span><br><span class="line"># If chsh command no found :</span><br><span class="line">dnf -y install util-linux-user</span><br></pre></td></tr></table></figure><h2 id="change-shell"><a href="#change-shell" class="headerlink" title="change shell"></a>change shell</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chsh -s $(which zsh)</span><br></pre></td></tr></table></figure><h2 id="Install-Oh-My-ZSH"><a href="#Install-Oh-My-ZSH" class="headerlink" title="Install Oh-My-ZSH"></a>Install Oh-My-ZSH</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sh -c &quot;$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)&quot;</span><br><span class="line"># or</span><br><span class="line">sh -c &quot;$(wget https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh -O -)&quot;</span><br><span class="line"># or</span><br><span class="line">curl -Lo install.sh https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Install-powerlevle10k-theme"><a href="#Install-powerlevle10k-theme" class="headerlink" title="Install powerlevle10k theme"></a>Install powerlevle10k theme</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ~/oh-my-zsh/themes/powerlevel10k</span><br><span class="line">echo &#x27;source ~/oh-my-zsh/themes/powerlevel10k/powerlevel10k.zsh-theme&#x27; &gt;&gt;~/.zshrc</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Execute <code>vim .zshrc</code> and modify <code>ZSH_THEME=&quot;powerlevel10k/powerlevel10k&quot; </code></p><p><a href="https://github.com/romkatv/powerlevel10k#installation">https://github.com/romkatv/powerlevel10k#installation</a></p><h2 id="Specify-Terminal-Tab-title-on-ZSH"><a href="#Specify-Terminal-Tab-title-on-ZSH" class="headerlink" title="Specify Terminal Tab title on ZSH"></a>Specify Terminal Tab title on ZSH</h2><p>Execute <code>vim .zshrc</code> add following.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># Uncomment the following line to disable auto-setting terminal title.</span><br><span class="line">DISABLE_AUTO_TITLE=&quot;true&quot;</span><br><span class="line"></span><br><span class="line"># To display HostnameğŸ˜PWD_Name as title text</span><br><span class="line">HOSTNAME=$(hostname -s)</span><br><span class="line"></span><br><span class="line"># Let zsh launch with the custom title.</span><br><span class="line">window_title=&quot;\033]0;$HOSTNAMEğŸ˜$&#123;PWD##*/&#125;\007&quot;</span><br><span class="line">echo -ne &quot;$window_title&quot;</span><br><span class="line"># Refresh the custome title when the directory changes. Changed from precmd as it shall suppress the set-title function below</span><br><span class="line">function chpwd () &#123;</span><br><span class="line">window_title=&quot;\033]0;$HOSTNAMEğŸ˜$&#123;PWD##*/&#125;\007&quot;</span><br><span class="line">echo -ne &quot;$window_title&quot;</span><br><span class="line">&#125;</span><br><span class="line"># Setting your own title text on demand. (Don&#x27;t change dir after setting it ğŸ˜)</span><br><span class="line">function set-title()&#123;</span><br><span class="line">TITLE=&quot;\[\e]2;$*\a\]&quot;</span><br><span class="line">echo -e $&#123;TITLE&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/resources/c64efe2ef23a48c9916d40d47ddedbcb.gif&quot; alt=&quot;iShot_0004-06-30_21.30.44.gif&quot;&gt;&lt;/p&gt;
&lt;p&gt;First of all, check the activated </summary>
      
    
    
    
    <category term="Linux" scheme="https://kenryu.cc/ja/categories/Linux/"/>
    
    
  </entry>
  
  <entry>
    <title>Windows11 ã®ã€ŒNum Lockã€ã‚­ãƒ¼ã‚’ç„¡åŠ¹åŒ–</title>
    <link href="https://kenryu.cc/ja/2022/05/20/Windows/Windows11_%E3%81%AE%E3%80%8CNum_Lock%E3%80%8D%E3%82%AD%E3%83%BC%E3%82%92%E7%84%A1%E5%8A%B9%E5%8C%96/"/>
    <id>https://kenryu.cc/ja/2022/05/20/Windows/Windows11_%E3%81%AE%E3%80%8CNum_Lock%E3%80%8D%E3%82%AD%E3%83%BC%E3%82%92%E7%84%A1%E5%8A%B9%E5%8C%96/</id>
    <published>2022-05-20T08:02:05.000Z</published>
    <updated>2022-07-01T10:18:11.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èª²é¡Œ"><a href="#èª²é¡Œ" class="headerlink" title="èª²é¡Œ"></a>èª²é¡Œ</h2><p>ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å…¥åŠ›ã™ã‚‹ãªã©ã«ãƒ†ãƒ³ã‚­ãƒ¼ã‚’é‡å®ã—ã¾ã™ã€‚ã—ã‹ã—ã€ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã™ã‚‹ã¨ãã«é–“é•ãˆã¦<kbd>Num Lock</kbd>ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã—ã¾ã£ãŸã‚‰ã€æ¬¡ã«æ•°å­—ã‚’æ‰“ã¡ãŸã„ã®ã«ã‚«ãƒ¼ã‚½ãƒ«ãŒæ“ä½œã•ã‚Œã¦ã—ã¾ã„ã€è‹¥å¹²è‹›ç«‹ãŸã—ããªã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿç”Ÿç”£æ€§ã«ã¯ã¨ã‚‚ã‹ãã€å¿ƒèº«ã®å¥åº·ã«ã‚‚æ‚ªå½±éŸ¿ã‚’åŠã¼ã—ã¾ã™ã€‚</p><p>ã¨ã“ã‚ã§ã€ä»Šå›ã¯ã€<kbd>Num Lock</kbd>ã‚­ãƒ¼ã‚’åŠæ°¸ä¹…çš„ã«ç„¡åŠ¹åŒ–ã™ã‚‹æ–¹æ³•ã‚’ã”ç´¹ä»‹è‡´ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚</p><blockquote><p>ã€æ°¸ä¹…çš„ã€‘ï¼šç‰©ç†çš„ã«ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‹ã‚‰ã€ŒNum Lockã€ã‚­ãƒ¼ã‚’å–ã‚Šå¤–ã—</p></blockquote><p><img src="/resources/1c11b9c1ed07489dae49c0e7d016a5cd.png" alt="chrome_1505x521_220701.png"></p><h2 id="è§£æ±ºæ–¹æ³•"><a href="#è§£æ±ºæ–¹æ³•" class="headerlink" title="è§£æ±ºæ–¹æ³•"></a>è§£æ±ºæ–¹æ³•</h2><ol><li><p><kbd>Win</kbd>+<kbd>R</kbd>ã‚’åŒæ™‚ã«æŠ¼ã—ã¦ã€<code>regedit</code>ã€€ã¨å…¥åŠ›ã—ã€ã€Œãƒ¬ã‚¸ã‚¹ãƒˆãƒª ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã€ã‚’é–‹ãã¾ã™ã€‚ã€€<br><img src="/resources/42353ad6d2a34de89a552598c2093117.png" alt="explorer_456x272_220701.png"></p></li><li><p>ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã«<code>ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Keyboard Layout</code>ã¨å…¥åŠ›ã—ã¾ã™ã€‚<br><img src="/resources/d1da1be4dfc44d2f946d714940015859.png" alt="regedit_1155x509_220701.png"></p></li><li><p>æ–°ã—ã„ãƒã‚¤ãƒŠãƒªã‚¨ãƒ‡ã‚£ã‚¿<code>Scancode Map</code><br><img src="/resources/4f001eb6e94e4d57aa5ab4a1c3e6663d.png" alt="regedit_1065x423_220701.png"></p></li><li><p>ãƒ€ãƒ–ãƒ«ãƒã‚§ãƒƒã‚¯ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚</p><blockquote><p>æ³¨æ„ï¼šNum Lockãƒ­ãƒƒã‚¯ã—ã¦ã„ã‚‹ã‹ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</p></blockquote><p><img src="/resources/b6b505c4d3984ad086836b911f800778.png" alt="regedit_617x387_220701.png"></p></li><li><p>å†èµ·å‹•ã—ã¦å®Œäº†ã§ã™ã€‚</p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;èª²é¡Œ&quot;&gt;&lt;a href=&quot;#èª²é¡Œ&quot; class=&quot;headerlink&quot; title=&quot;èª²é¡Œ&quot;&gt;&lt;/a&gt;èª²é¡Œ&lt;/h2&gt;&lt;p&gt;ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¯IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®å…¥åŠ›ã™ã‚‹ãªã©ã«ãƒ†ãƒ³ã‚­ãƒ¼ã‚’é‡å®ã—ã¾ã™ã€‚ã—ã‹ã—ã€ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã™ã‚‹ã¨ãã«é–“é•ãˆã¦&lt;kbd&gt;Num Lock&lt;/</summary>
      
    
    
    
    <category term="Windows" scheme="https://kenryu.cc/ja/categories/Windows/"/>
    
    
    <category term="windows" scheme="https://kenryu.cc/ja/tags/windows/"/>
    
  </entry>
  
  <entry>
    <title>Postfix Dovecot MySQL Mail Server</title>
    <link href="https://kenryu.cc/ja/2022/05/02/Linux/Mail-Server/Postfix-Dovecot-MySQL-Mail-Server/"/>
    <id>https://kenryu.cc/ja/2022/05/02/Linux/Mail-Server/Postfix-Dovecot-MySQL-Mail-Server/</id>
    <published>2022-05-01T15:00:00.000Z</published>
    <updated>2022-06-30T13:52:05.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Objective"><a href="#Objective" class="headerlink" title="Objective"></a>Objective</h1><ul><li>Local network (web)mail server.</li><li>Local private PKI.</li><li>On LNMP-base use Postfix &amp; Dovecot &amp; PostfixAdmin &amp; RoundCube.</li></ul><table><thead><tr><th>Name</th><th>Version</th><th>Command</th></tr></thead><tbody><tr><td>Linux</td><td>Rocky Linux release 8.5 (Green Obsidian)</td><td>cat &#x2F;etc&#x2F;centos-release &#x2F;etc&#x2F;os-release &#x2F;etc&#x2F;redhat-release &#x2F;etc&#x2F;rocky-release &#x2F;etc&#x2F;system-release</td></tr><tr><td>Nginx</td><td>nginx version: nginx&#x2F;1.20.2</td><td>nginx -v</td></tr><tr><td>MySQL</td><td>mysql Ver 8.0.28 for Linux on x86_64 (MySQL Community Server - GPL)</td><td>mysql â€“version</td></tr><tr><td>PHP</td><td>PHP 7.4.29 (fpm-fcgi) (built: Apr 12 2022 10:55:38)</td><td>php -v</td></tr><tr><td>Postfix</td><td>mail_version &#x3D; 3.5.8</td><td>postconf mail_version</td></tr><tr><td>Dovecot</td><td>2.3.8 (9df20d2db)</td><td>dovecot â€“version</td></tr><tr><td>PostfixAdmin</td><td>3.3.11</td><td></td></tr><tr><td>Roundcube</td><td>1.5.2</td><td></td></tr></tbody></table><h1 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h1><ul><li>Have a host with CPU more than 1Core and Memory higher than 2GB.</li><li>Have an LNMP-Base or LAMP-Base host;</li><li>Have an FQDN that can be resolved;</li><li>Have private CA root certificate, Hostâ€™s private key, Hostâ€™s certificate;</li></ul><p><code>free</code> command</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># free -h</span><br><span class="line">total used free shared buff/cache available</span><br><span class="line">Mem: 1.9Gi 624Mi 746Mi 20Mi 606Mi 1.2Gi</span><br><span class="line">Swap: 2.0Gi 0B 2.0Gi</span><br></pre></td></tr></table></figure><p>DNS Record on name server:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mail.example.com. IN A 192.168.65.132</span><br><span class="line">132.65 IN PTR mail.example.com.</span><br></pre></td></tr></table></figure><p>SSL&#x2F;TSLâ€™s private key and certificate file is following path :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@email ~]# ll /etc/pki/tls/certs/mail.example.com.crt</span><br><span class="line">-r--r--r-- 1 root root 5439 Apr 23 16:41 /etc/pki/tls/certs/mail.example.com.crt</span><br><span class="line">[root@email ~]#</span><br><span class="line">[root@email ~]# ll /etc/pki/tls/private/mail.example.com.key</span><br><span class="line">-r-------- 1 root root 1704 Apr 23 16:41 /etc/pki/tls/private/mail.example.com.key</span><br></pre></td></tr></table></figure><h1 id="Step1-OS-Setting"><a href="#Step1-OS-Setting" class="headerlink" title="Step1. OS Setting"></a>Step1. OS Setting</h1><p>Setting hostname.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># dnf -y update</span><br><span class="line"># hostnamectl set-hostname mail.example.com</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/hosts</span><br><span class="line">127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 mail.example.com</span><br><span class="line">::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 mail.example.com</span><br></pre></td></tr></table></figure><p>Disable SELinux</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># sed -i s/^SELINUX=.*$/SELINUX=disabled/ /etc/selinux/config</span><br><span class="line"># reboot</span><br></pre></td></tr></table></figure><p>Allow the following packages to pass though the firewall.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># firewall-cmd --permanent --add-service=&#123;http,https,smtp,smtp-submission,smtps,imap,imaps,pop3,pop3s&#125;</span><br><span class="line"># firewall-cmd --reload</span><br><span class="line"># firewall-cmd --list-all</span><br></pre></td></tr></table></figure><p>Install some required packages and recommended PHP modules.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># dnf -y install vim wget tar git nmap bind-utils telnet mailx openssl</span><br><span class="line"># dnf -y install php php-fpm php-imap php-mbstring php-mysqlnd php-gd php-opcache php-json php-curl php-zip php-xml php-bz2 php-intl php-gmp</span><br></pre></td></tr></table></figure><h1 id="Step2-Create-Databases"><a href="#Step2-Create-Databases" class="headerlink" title="Step2. Create Databases"></a>Step2. Create Databases</h1><p>Create a database for PostfixAdmin.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE DATABASE postfixadmin;</span><br><span class="line">mysql&gt; CREATE USER &#x27;postfixadmin&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;YourPassword&#x27;;</span><br><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON `postfixadmin` . _config.landscape.yml _config.yml db.json Get_Joplin_resources.sh i18n Install_JavaScripts_via_npm.sh node_modules package.json package-lock.json public scaffolds source symlink.sh test.md themes tmp.md TO &#x27;postfixadmin&#x27;@&#x27;localhost&#x27;;</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure><p>Create a database for roundcubu.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE DATABASE roundcube DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;</span><br><span class="line">mysql&gt; CREATE USER roundcube@localhost IDENTIFIED BY &#x27;YourPassword&#x27;;</span><br><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON roundcube.* TO roundcube@localhost;</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure><h1 id="Step3-Create-Web-Servers"><a href="#Step3-Create-Web-Servers" class="headerlink" title="Step3. Create Web Servers"></a>Step3. Create Web Servers</h1><p>Create Nginx config file for PostfixAdmin and RoundCube.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"># cat /etc/nginx/conf.d/mail.example.com.conf</span><br><span class="line"># Redirect http to https.</span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">listen [::]:80;</span><br><span class="line">server_name mail.example.com, 192.168.65.132;</span><br><span class="line">return 301 https://mail.example.com$request_uri;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Listen https://mail.example.com</span><br><span class="line">server &#123;</span><br><span class="line">listen 443 ssl http2;</span><br><span class="line">server_name mail.example.com;</span><br><span class="line"></span><br><span class="line"># SSl/TLS configuration</span><br><span class="line">ssl_certificate &quot;/etc/pki/tls/certs/mail.example.com.crt&quot;;</span><br><span class="line">ssl_certificate_key &quot;/etc/pki/tls/private/mail.example.com.key&quot;;</span><br><span class="line">ssl_session_cache shared:SSL:1m;</span><br><span class="line">ssl_session_timeout 10m;</span><br><span class="line">ssl_ciphers PROFILE=SYSTEM;</span><br><span class="line">ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line"># Roundcube configuration</span><br><span class="line">root /usr/share/nginx/roundcube/;</span><br><span class="line">index index.php index.html index.htm;</span><br><span class="line"></span><br><span class="line"># Roundcube logs</span><br><span class="line">error_log /var/log/nginx/roundcube.error;</span><br><span class="line">access_log /var/log/nginx/roundcube.access;</span><br><span class="line"></span><br><span class="line"># Roundcube Locations</span><br><span class="line">location / &#123;</span><br><span class="line">try_files $uri $uri/ /index.php;</span><br><span class="line">&#125;</span><br><span class="line">location ~ .php$ &#123;</span><br><span class="line">try_files $uri =404;</span><br><span class="line">fastcgi_pass unix:/run/php-fpm/www.sock;</span><br><span class="line">fastcgi_index index.php;</span><br><span class="line">fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">include fastcgi_params;</span><br><span class="line">&#125;</span><br><span class="line">location ~ /.well-known/acme-challenge &#123;</span><br><span class="line">allow all;</span><br><span class="line">&#125;</span><br><span class="line">location ~ ^/(README|INSTALL|LICENSE|CHANGELOG|UPGRADING)$ &#123;</span><br><span class="line">deny all;</span><br><span class="line">&#125;</span><br><span class="line">location ~ ^/(bin|SQL)/ &#123;</span><br><span class="line">deny all;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Sub-Location of PostfixAdmin</span><br><span class="line">location /postfixadmin &#123;</span><br><span class="line">alias /usr/share/nginx/postfixadmin/public;</span><br><span class="line">access_log /var/log/nginx/postfixadmin_access.log;</span><br><span class="line">error_log /var/log/nginx/postfixadmin_error.log;</span><br><span class="line">try_files $uri $uri/ /index.php;</span><br><span class="line"></span><br><span class="line">location ~ ^/(.+.php)$ &#123;</span><br><span class="line">try_files $uri =404;</span><br><span class="line">fastcgi_pass unix:/run/php-fpm/www.sock;</span><br><span class="line">fastcgi_index index.php;</span><br><span class="line">fastcgi_param SCRIPT_FILENAME $request_filename;</span><br><span class="line">include /etc/nginx/fastcgi_params;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># A long browser cache lifetime can speed up repeat visits to your page</span><br><span class="line"># location ~* .(jpg|jpeg|gif|png|webp|svg|woff|woff2|ttf|css|js|ico|xml)$ &#123;</span><br><span class="line"># access_log off;</span><br><span class="line"># log_not_found off;</span><br><span class="line"># expires 360d;</span><br><span class="line"># &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Step4-Configure-Postfix"><a href="#Step4-Configure-Postfix" class="headerlink" title="Step4. Configure Postfix"></a>Step4. Configure Postfix</h1><p>Install and start Postfix.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># dnf -y install postfix postfix-mysql</span><br><span class="line"># systemctl enable --now postfix</span><br></pre></td></tr></table></figure><p>Edit Postfix main config file with following command. This will defined our <code>domain</code> <code>hostname</code> <code>tls_level</code> etcâ€¦</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cp /etc/postfix/main.cf /etc/postfix/main.cf.bak</span><br><span class="line"># vim /etc/postfix/main.cf</span><br></pre></td></tr></table></figure><p><a href="/resources/0e222d97baca4600b523da77666a1419.cf">main.cf</a></p><p>We can configure postfix by direct modifying above file or use following <code>postconf</code> command.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Change to:</span><br><span class="line"># postconf -e &quot;inet_interfaces = all&quot;</span><br><span class="line"># postconf -e &#x27;inet_protocols = ipv4&#x27;</span><br><span class="line"># postconf &#x27;smtpd_tls_cert_file = /etc/pki/tls/certs/mail.example.com.crt&#x27;</span><br><span class="line"># postconf &#x27;smtpd_tls_key_file = /etc/pki/tls/private/mail.example.com.key&#x27;</span><br><span class="line">Add:</span><br><span class="line"># postconf -e &#x27;smtp_address_preference = ipv4&#x27;</span><br><span class="line"># postconf &quot;smtpd_tls_loglevel = 1&quot;</span><br><span class="line"># postconf &quot;smtp_tls_loglevel = 1&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#Add following to the end of the file.</span><br><span class="line"># Force TLSv1.3 or TLSv1.2</span><br><span class="line">smtpd_tls_mandatory_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1</span><br><span class="line">smtpd_tls_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1</span><br><span class="line">smtp_tls_mandatory_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1</span><br><span class="line">smtp_tls_protocols = !SSLv2, !SSLv3, !TLSv1, !TLSv1.1</span><br><span class="line"></span><br><span class="line">mailbox_transport = lmtp:unix:private/dovecot-lmtp</span><br><span class="line">smtputf8_enable = no</span><br><span class="line"></span><br><span class="line">virtual_mailbox_domains = proxy:mysql:/etc/postfix/sql/mysql_virtual_domains_maps.cf</span><br><span class="line">virtual_mailbox_maps =</span><br><span class="line">proxy:mysql:/etc/postfix/sql/mysql_virtual_mailbox_maps.cf,</span><br><span class="line">proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_domain_mailbox_maps.cf</span><br><span class="line">virtual_alias_maps =</span><br><span class="line">proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_maps.cf,</span><br><span class="line">proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_domain_maps.cf,</span><br><span class="line">proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_domain_catchall_maps.cf</span><br><span class="line">virtual_transport = lmtp:unix:private/dovecot-lmtp</span><br><span class="line"></span><br><span class="line">virtual_mailbox_base = /var/vmail</span><br><span class="line">virtual_minimum_uid = 2000</span><br><span class="line">virtual_uid_maps = static:2000</span><br><span class="line">virtual_gid_maps = static:2000</span><br></pre></td></tr></table></figure><p>Enable Submssion port (587) and SMTP-S (465) by editting <code>/etc/postfix/master.cf</code> file.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cp /etc/postfix/master.cf /etc/postfix/master.cf.bak</span><br><span class="line"># vim /etc/postfix/master.cf</span><br></pre></td></tr></table></figure><p><a href="/resources/aef18d6512de4fffa179363b41ca9710.cf">master.cf</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># For Submission</span><br><span class="line">submission inet n - y - - smtpd</span><br><span class="line">-o syslog_name=postfix/submission</span><br><span class="line">-o smtpd_tls_security_level=encrypt</span><br><span class="line">-o smtpd_tls_wrappermode=no</span><br><span class="line">-o smtpd_sasl_auth_enable=yes</span><br><span class="line">-o smtpd_relay_restrictions=permit_sasl_authenticated,reject</span><br><span class="line">-o smtpd_recipient_restrictions=permit_mynetworks,permit_sasl_authenticated,reject</span><br><span class="line">-o smtpd_sasl_type=dovecot</span><br><span class="line">-o smtpd_sasl_path=private/auth</span><br><span class="line"></span><br><span class="line"># For SMTP-S</span><br><span class="line">smtps inet n - y - - smtpd</span><br><span class="line">-o syslog_name=postfix/smtps</span><br><span class="line">-o smtpd_tls_wrappermode=yes</span><br><span class="line">-o smtpd_sasl_auth_enable=yes</span><br><span class="line">-o smtpd_relay_restrictions=permit_sasl_authenticated,reject</span><br><span class="line">-o smtpd_recipient_restrictions=permit_mynetworks,permit_sasl_authenticated,reject</span><br><span class="line">-o smtpd_sasl_type=dovecot</span><br><span class="line">-o smtpd_sasl_path=private/auth</span><br></pre></td></tr></table></figure><p>(Option) We can follow the steps below to create a watchdog to prevent the service from terminating unexpectedly.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># mkdir -p /etc/systemd/system/postfix.service.d/</span><br><span class="line"># vim /etc/systemd/system/postfix.service.d/restart.conf</span><br><span class="line">[Service]</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=5s</span><br></pre></td></tr></table></figure><p>(Option) Verify the watchdog is working.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># systemctl daemon-reload</span><br><span class="line"># pkill master</span><br><span class="line"># systemctl status postfix</span><br></pre></td></tr></table></figure><h1 id="Step5-Configure-Dovecot"><a href="#Step5-Configure-Dovecot" class="headerlink" title="Step5. Configure Dovecot"></a>Step5. Configure Dovecot</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># dnf -y install dovecot dovecot-mysql</span><br><span class="line"># systemctl enable --now dovecot</span><br></pre></td></tr></table></figure><p>Add the dovecot to the mail group.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># gpasswd -a dovecot mail</span><br></pre></td></tr></table></figure><p>Add the web server(nginx) to the dovecot group.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># gpasswd -a nginx dovecot</span><br></pre></td></tr></table></figure><p>Generating DH parameters, This is going to take a long time.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># openssl dhparam -out /etc/dovecot/dh.pem 4096</span><br></pre></td></tr></table></figure><p>Uncomment following line and remove <del>submission</del> because we have enabled submission using Postfix.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># cp /etc/dovecot/dovecot.conf /etc/dovecot/dovecot.conf.bak</span><br><span class="line"># vim /etc/dovecot/dovecot.conf</span><br><span class="line">#protocols = imap pop3 lmtp submission</span><br><span class="line">protocols = imap pop3 lmtp</span><br></pre></td></tr></table></figure><p>Create new file and fill in the following. This will enable Dovecot to connect to our MySQL database.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/dovecot/dovecot-sql.conf.ext</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">driver = mysql</span><br><span class="line">connect = host=localhost dbname=postfixadmin user=postfixadmin password=YourPassword</span><br><span class="line">default_pass_scheme = SHA512</span><br><span class="line">password_query = SELECT username AS user,password FROM mailbox WHERE username = &#x27;%u&#x27; AND active=&#x27;1&#x27;</span><br><span class="line">user_query = SELECT maildir, 2000 AS uid, 2000 AS gid FROM mailbox WHERE username = &#x27;%u&#x27; AND active=&#x27;1&#x27;</span><br><span class="line">iterate_query = SELECT username AS user FROM mailbox</span><br></pre></td></tr></table></figure><p>Modify the file as below. This will define the mail location as well as the namespace.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/dovecot/conf.d/10-mail.conf</span><br><span class="line"># Add following in the end.</span><br><span class="line">mail_location = maildir:~/Maildir</span><br><span class="line">mail_home = /var/vmail/%d/%n</span><br><span class="line">mail_privileged_group = mail</span><br></pre></td></tr></table></figure><p>Add the following lines to the end of this file.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cp /etc/dovecot/conf.d/10-master.conf /etc/dovecot/conf.d/10-master.conf.bak</span><br><span class="line"># vim /etc/dovecot/conf.d/10-master.conf</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#Add following in the end of the file.</span><br><span class="line">service stats &#123;</span><br><span class="line">unix_listener stats-reader &#123;</span><br><span class="line">user = nginx</span><br><span class="line">group = nginx</span><br><span class="line">mode = 0660</span><br><span class="line">&#125;</span><br><span class="line">unix_listener stats-writer &#123;</span><br><span class="line">user = nginx</span><br><span class="line">group = nginx</span><br><span class="line">mode = 0660</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Configuring Authentication Mechanism.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># cp /etc/dovecot/conf.d/10-auth.conf /etc/dovecot/conf.d/10-auth.conf.bak</span><br><span class="line"># vim /etc/dovecot/conf.d/10-auth.conf</span><br><span class="line">#Change to:</span><br><span class="line">auth_username_format = %u</span><br><span class="line">auth_mechanisms = plain login</span><br><span class="line">!include auth-sql.conf.ext</span><br><span class="line">auth_debug = yes</span><br><span class="line">auth_debug_passwords = yes</span><br></pre></td></tr></table></figure><p>Configuring SSL&#x2F;TLS Encryption.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># cp /etc/dovecot/conf.d/10-ssl.conf /etc/dovecot/conf.d/10-ssl.conf.bak</span><br><span class="line"># vim /etc/dovecot/conf.d/10-ssl.conf</span><br><span class="line">#Change to:</span><br><span class="line">ssl = required</span><br><span class="line">ssl_cert = &lt;/etc/pki/tls/certs/mail.example.com.crt</span><br><span class="line">ssl_key = &lt;/etc/pki/tls/private/mail.example.com.key</span><br><span class="line">ssl_dh = &lt;/etc/dovecot/dh.pem</span><br><span class="line">ssl_min_protocol = TLSv1.2</span><br><span class="line">ssl_cipher_list = PROFILE=SYSTEM</span><br><span class="line">ssl_prefer_server_ciphers = yes</span><br></pre></td></tr></table></figure><p>SASL Authentication Between Postfix and Dovecot.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/dovecot/conf.d/10-master.conf</span><br><span class="line"># Change to:</span><br><span class="line">service lmtp &#123;</span><br><span class="line">unix_listener /var/spool/postfix/private/dovecot-lmtp &#123;</span><br><span class="line">mode = 0600</span><br><span class="line">user = postfix</span><br><span class="line">group = postfix</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">service auth &#123;</span><br><span class="line">unix_listener /var/spool/postfix/private/auth &#123;</span><br><span class="line">mode = 0600</span><br><span class="line">user = postfix</span><br><span class="line">group = postfix</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Edit the following file like below. This will auto-create <code>Sent</code> ,<code>Junk</code>, <code>Drafts</code>and <code>Trash</code> Folder.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># cp /etc/dovecot/conf.d/15-mailboxes.conf /etc/dovecot/conf.d/15-mailboxes.conf.bak</span><br><span class="line"># vim /etc/dovecot/conf.d/15-mailboxes.conf</span><br><span class="line">namespace inbox &#123;</span><br><span class="line"># These mailboxes are widely used and could perhaps be created automatically:</span><br><span class="line">mailbox Drafts &#123;</span><br><span class="line">auto = create</span><br><span class="line">special_use = Drafts</span><br><span class="line">&#125;</span><br><span class="line">mailbox Junk &#123;</span><br><span class="line">auto = create</span><br><span class="line">special_use = Junk</span><br><span class="line">&#125;</span><br><span class="line">mailbox Trash &#123;</span><br><span class="line">auto = create</span><br><span class="line">special_use = Trash</span><br><span class="line">&#125;</span><br><span class="line">mailbox Sent &#123;</span><br><span class="line">auto = create</span><br><span class="line">special_use = Sent</span><br><span class="line">&#125;</span><br><span class="line">mailbox &quot;Sent Messages&quot; &#123;</span><br><span class="line">special_use = Sent</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Now we need to restart the Postfix and dovecot services.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># systemctl restart postfix dovecot</span><br><span class="line"># systemctl status postfix</span><br><span class="line"># systemctl status dovecot</span><br></pre></td></tr></table></figure><h1 id="Step6-Configure-Postfixadmin"><a href="#Step6-Configure-Postfixadmin" class="headerlink" title="Step6. Configure Postfixadmin"></a>Step6. Configure Postfixadmin</h1><p>Check <a href="https://github.com/postfixadmin/postfixadmin/releases">https://github.com/postfixadmin/postfixadmin/releases</a> to get the latest stable release first. And then we need to download the tarball via <code>wget</code> command.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># wget https://github.com/postfixadmin/postfixadmin/archive/postfixadmin-3.3.11.tar.gz</span><br><span class="line"># tar -zxvf postfixadmin-3.3.11.tar.gz</span><br><span class="line"># mv postfixadmin-postfixadmin-3.3.11/ /usr/share/nginx/postfixadmin</span><br><span class="line"># mkdir -p /usr/share/nginx/postfixadmin/templates_c</span><br></pre></td></tr></table></figure><p>Create the following new file and fill it like below. This will enable PostfixAdmin connect MySQL database and update password by PHP.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># vim /usr/share/nginx/postfixadmin/config.local.php</span><br><span class="line">&lt;?php</span><br><span class="line">$CONF[&#x27;configured&#x27;] = true;</span><br><span class="line">$CONF[&#x27;database_type&#x27;] = &#x27;mysqli&#x27;;</span><br><span class="line">$CONF[&#x27;database_host&#x27;] = &#x27;localhost&#x27;;</span><br><span class="line">$CONF[&#x27;database_port&#x27;] = &#x27;3306&#x27;;</span><br><span class="line">$CONF[&#x27;database_user&#x27;] = &#x27;postfixadmin&#x27;;</span><br><span class="line">$CONF[&#x27;database_password&#x27;] = &#x27;YourPassword&#x27;;</span><br><span class="line">$CONF[&#x27;database_name&#x27;] = &#x27;postfixadmin&#x27;;</span><br><span class="line">$CONF[&#x27;encrypt&#x27;] = &#x27;dovecot:SHA512&#x27;;</span><br><span class="line">$CONF[&#x27;dovecotpw&#x27;] = &quot;/usr/bin/doveadm pw -r 12&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># chown -R nginx:nginx /usr/share/nginx/postfixadmin/</span><br></pre></td></tr></table></figure><p>Make following directory.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># mkdir -p /etc/postfix/sql/</span><br></pre></td></tr></table></figure><p>Create following files and make sure they are set with permissions to be accessible by Postfix user.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/postfix/sql/mysql_virtual_domains_maps.cf</span><br><span class="line">user = postfixadmin</span><br><span class="line">password = YourPassword</span><br><span class="line">hosts = localhost</span><br><span class="line">dbname = postfixadmin</span><br><span class="line">query = SELECT domain FROM domain WHERE domain=&#x27;%s&#x27; AND active = &#x27;1&#x27;</span><br><span class="line">#query = SELECT domain FROM domain WHERE domain=&#x27;%s&#x27;</span><br><span class="line">#optional query to use when relaying for backup MX</span><br><span class="line">#query = SELECT domain FROM domain WHERE domain=&#x27;%s&#x27; AND backupmx = &#x27;0&#x27; AND active = &#x27;1&#x27;</span><br><span class="line">#expansion_limit = 100</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/postfix/sql/mysql_virtual_mailbox_maps.cf</span><br><span class="line">user = postfixadmin</span><br><span class="line">password = YourPassword</span><br><span class="line">hosts = localhost</span><br><span class="line">dbname = postfixadmin</span><br><span class="line">query = SELECT maildir FROM mailbox WHERE username=&#x27;%s&#x27; AND active = &#x27;1&#x27;</span><br><span class="line">#expansion_limit = 100</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/postfix/sql/mysql_virtual_alias_domain_mailbox_maps.cf</span><br><span class="line">user = postfixadmin</span><br><span class="line">password = YourPassword</span><br><span class="line">hosts = localhost</span><br><span class="line">dbname = postfixadmin</span><br><span class="line">query = SELECT maildir FROM mailbox,alias_domain WHERE alias_domain.alias_domain = &#x27;%d&#x27; and mailbox.username = CONCAT(&#x27;%u&#x27;, &#x27;@&#x27;, alias_domain.target_domain) AND mailbox.active = 1 AND alias_domain.active=&#x27;1&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/postfix/sql/mysql_virtual_alias_maps.cf</span><br><span class="line">user = postfixadmin</span><br><span class="line">password = YourPassword</span><br><span class="line">hosts = localhost</span><br><span class="line">dbname = postfixadmin</span><br><span class="line">query = SELECT goto FROM alias WHERE address=&#x27;%s&#x27; AND active = &#x27;1&#x27;</span><br><span class="line">#expansion_limit = 100</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/postfix/sql/mysql_virtual_alias_domain_maps.cf</span><br><span class="line">user = postfixadmin</span><br><span class="line">password = YourPassword</span><br><span class="line">hosts = localhost</span><br><span class="line">dbname = postfixadmin</span><br><span class="line">query = SELECT goto FROM alias,alias_domain WHERE alias_domain.alias_domain = &#x27;%d&#x27; and alias.address = CONCAT(&#x27;%u&#x27;, &#x27;@&#x27;, alias_domain.target_domain) AND alias.active = 1 AND alias_domain.active=&#x27;1&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/postfix/sql/mysql_virtual_alias_domain_catchall_maps.cf</span><br><span class="line">user = postfixadmin</span><br><span class="line">password = YourPassword</span><br><span class="line">hosts = localhost</span><br><span class="line">dbname = postfixadmin</span><br><span class="line">query = SELECT goto FROM alias,alias_domain WHERE alias_domain.alias_domain = &#x27;%d&#x27; and alias.address = CONCAT(&#x27;@&#x27;, alias_domain.target_domain) AND alias.active = 1 AND alias_domain.active=&#x27;1&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># chmod 0640 /etc/postfix/sql/*</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># adduser vmail --system --uid 2000 --user-group --no-create-home</span><br><span class="line"># mkdir /var/vmail/</span><br><span class="line"># chown vmail:vmail /var/vmail/ -R</span><br><span class="line"># chown -R postfix:postfix /etc/postfix/sql/</span><br><span class="line"># chown -R nginx:nginx /var/lib/php/opcache/</span><br><span class="line"># chown -R nginx:nginx /var/lib/php/session/</span><br><span class="line"># chown -R nginx:nginx /var/lib/php/wsdlcache/</span><br><span class="line"># chown nginx:nginx /etc/pki/tls/certs/mail.example.com.crt</span><br><span class="line"># chown nginx:nginx /etc/pki/tls/private/mail.example.com.key</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># nginx -t</span><br><span class="line"># nginx -s reload</span><br></pre></td></tr></table></figure><p>Open our browser and enter following URL to complete PostfixAdmin setup.<br><a href="https://mail.example.com/postfixadmin/setup.php">https://mail.example.com/postfixadmin/setup.php</a><br><img src="/resources/56ef873134dc4730af5e4c076f0a142d.png" alt="d470a41ee4e4f239da08aa8cce8454e6.png"><br>You can generate a password hash through <code>php -r &#39;echo password_hash(&quot;YourPassword&quot;, PASSWORD_DEFAULT);&#39;</code> command.<br>Now you need to add following line to the <code>/usr/share/nginx/postfixadmin/config.local.php</code> file in the end.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$CONF[&#x27;setup_password&#x27;] = &#x27;Your_Password&#x27;s_Hash&#x27;;</span><br></pre></td></tr></table></figure><p>Follow the setup wizard to create an Administrator user and login.<br><img src="/resources/968a63824b734664bdf63ddc612b5149.png" alt="3033bf031c1ee6c2d69ada9fd9efacb9.png"><br>Now you can create Domain and Mailboxes in PostfixAdmin.</p><blockquote><p>Reference:<br><a href="https://github.com/postfixadmin/postfixadmin/tree/master/DOCUMENTS">https://github.com/postfixadmin/postfixadmin/tree/master/DOCUMENTS</a><br><a href="https://raw.githubusercontent.com/postfixadmin/postfixadmin/master/INSTALL.TXT">https://raw.githubusercontent.com/postfixadmin/postfixadmin/master/INSTALL.TXT</a></p></blockquote><h1 id="Step7-Configure-RoundCube"><a href="#Step7-Configure-RoundCube" class="headerlink" title="Step7. Configure RoundCube"></a>Step7. Configure RoundCube</h1><p>RoundCube is a WebGUI IMAP client.<br>Download Roundcube Webmail from <a href="https://github.com/roundcube/roundcubemail/releases">https://github.com/roundcube/roundcubemail/releases</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># wget https://github.com/roundcube/roundcubemail/releases/download/1.5.2/roundcubemail-1.5.2-complete.tar.gz</span><br><span class="line"># tar -zxvf roundcubemail-1.5.2-complete.tar.gz</span><br><span class="line"># mv roundcubemail-1.5.2 /usr/share/nginx/roundcube</span><br><span class="line"># chown nginx:nginx -R /usr/share/nginx/roundcube/</span><br><span class="line"># dnf install php-ldap php-imagick php-common php-gd php-imap php-json php-curl php-zip php-xml php-mbstring php-bz2 php-intl php-gmp -y</span><br></pre></td></tr></table></figure><p>Add your Private CAâ€™s certificate in the end of the following file.</p><blockquote><p>Note: This needs to be saved forcibly with <code>:wq!</code>.</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/pki/tls/certs/ca-bundle.crt</span><br><span class="line">#Add the following to the end of the file.</span><br><span class="line"># My Private CA Certificate.</span><br><span class="line">-----BEGIN CERTIFICATE-----</span><br><span class="line">...</span><br><span class="line">Your CA certificate.</span><br><span class="line">...</span><br><span class="line">-----END CERTIFICATE-----</span><br></pre></td></tr></table></figure><p>Now you need to open your browser and enter following URL to continue RoundCube setup.<br><a href="https://email.example.com/installer">https://email.example.com/installer</a><br><img src="/resources/da9e0417bc4148dc84619435b459a634.png" alt="3de277f1cb80d92e700afa2291ec518e.png"></p><p>Fill Database setup.<br><img src="/resources/1280d8cac4354e059b2d5bdb569f553c.png" alt="4cc2d3c216084c4f53fe8d31790cc077.png"><br>Fill IMAP setup.<br>IMAP server: <code>ssl://email.example.com</code> port: 993<br><img src="/resources/15047935b37a48d8b80e2e96113edfdd.png" alt="17011cf931373d801743e7e838af5caa.png"><br>SMTP server: <code>tls://email.example.com</code> port: 587<br>SMTP server: <code>ssl://email.example.com</code> port: 465<br><img src="/resources/ef129191e5c6400bb41f2b264df87b1f.png" alt="9cf36687ab8c8aa16a10237452a68fc4.png"><br>Next, you can scroll down to the Plugins section to enable some plugins. For example: the password plugin, mark as junk plugin and so on. I enabled all of them.<br><img src="/resources/4cf2d9a8596b47dea678335543e9b345.png" alt="25aa9951a611254091e5c49fe38f0546.png"><br><img src="/resources/202413271cbf457ba0f75f5874a0bc9d.png" alt="1c5dfe3f1776c20a82dc3767da2f8615.png"><br><img src="/resources/f847d7cf9b224785b8482e7559a472e8.png" alt="9dc291c4498b0bd990eb5576c49d6af0.png"><br>Make sure the password plugin in the plugin list at the end of this file. The plugin order doesnâ€™t matter.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># grep &#x27;password&#x27; /usr/share/nginx/roundcube/config/config.inc.php</span><br></pre></td></tr></table></figure><p>Create the new PHP file by copying the file below and modify it like following. This will enable RoundCube to connect our MySQL database and update password.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cp /usr/share/nginx/roundcube/plugins/password/config.inc.php.dist /usr/share/nginx/roundcube/plugins/password/config.inc.php</span><br><span class="line">vim /usr/share/nginx/roundcube/plugins/password/config.inc.php</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#Change the value to:</span><br><span class="line">$config[&#x27;password_db_dsn&#x27;] = &#x27;mysql://postfixadmin:YourPassword@127.0.0.1/postfixadmin&#x27;;</span><br><span class="line">$config[&#x27;password_query&#x27;] = &#x27;UPDATE mailbox SET password=%D,modified=NOW() WHERE username=%u&#x27;;</span><br><span class="line">$config[&#x27;password_strength_driver&#x27;] = &#x27;zxcvbn&#x27;;</span><br><span class="line">$config[&#x27;password_zxcvbn_min_score&#x27;] = 5;</span><br><span class="line">$config[&#x27;password_algorithm&#x27;] = &#x27;dovecot&#x27;;</span><br><span class="line">$config[&#x27;password_dovecotpw&#x27;] = &#x27;/usr/bin/doveadm pw -r 12&#x27;;</span><br><span class="line">$config[&#x27;password_dovecotpw_method&#x27;] = &#x27;SHA512&#x27;;</span><br><span class="line">$config[&#x27;password_dovecotpw_with_method&#x27;] = true;</span><br></pre></td></tr></table></figure><p><a href="/resources/dea4c2783658451c979438a687261219.php">config.inc.php</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># chown nginx:nginx /usr/share/nginx/roundcube/plugins/password/config.inc.php</span><br><span class="line"># chmod 600 /usr/share/nginx/roundcube/plugins/password/config.inc.php</span><br><span class="line"># echo &quot;$config[&#x27;enable_installer&#x27;] = true;&quot; &gt;&gt; /usr/share/nginx/roundcube/config/config.inc.php</span><br></pre></td></tr></table></figure><p>Close the browser and enter following URL to complete set up.<br><a href="https://email.example.com/installer/index.php?_step=3">https://email.example.com/installer/index.php?_step=3</a><br>Send test<br><img src="/resources/b9bf213308ec4609b63b6b12e9ceb9c3.png" alt="c9e11f23949605bfd8b04455e627ffeb.png"><br><img src="/resources/91a0bc77b06f4a1daee68fb7a6826d79.png" alt="aa845e73437a5ee48f3dda613c050b77.png"><br>Login test<br><img src="/resources/2f69fc9c3e3045a28a29277368d8412a.png" alt="5be748fdc44ae54c05b97fc308998f63.png"><br>After completing the installation and the final tests please remove the whole installer folder from the document root of the webserver or make sure that enable_installer option in config.inc.php is disabled.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># rm -rf /usr/share/nginx/roundcube/installer/</span><br><span class="line">vim /usr/share/nginx/roundcube/config/config.inc.php</span><br><span class="line">Change to:</span><br><span class="line">$config[&#x27;enable_installer&#x27;]=false;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># nginx -t</span><br><span class="line"># nginx -s reload</span><br></pre></td></tr></table></figure><p>Close the browser and enter following URL to login your account.<br><a href="https://mail.example.com/postfixadmin/setup.php">https://mail.example.com/postfixadmin/setup.php</a><br><a href="https://mail.example.com/">https://mail.example.com</a></p><blockquote><p>Reference:<br><a href="https://www.linuxbabe.com/redhat/postfixadmin-create-virtual-mailboxes-centos-mail-server">https://www.linuxbabe.com/redhat/postfixadmin-create-virtual-mailboxes-centos-mail-server</a><br><a href="https://www.linuxbabe.com/redhat/install-roundcube-webmail-centos-8-rhel-8-apache-nginx#out-of-office">https://www.linuxbabe.com/redhat/install-roundcube-webmail-centos-8-rhel-8-apache-nginx#out-of-office</a></p></blockquote><h1 id="TroubleShooting"><a href="#TroubleShooting" class="headerlink" title="TroubleShooting"></a>TroubleShooting</h1><p>Perform a user lookup in Dovecotâ€™s userdbs.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># doveadm user &#x27;*&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># journalctl -eu dovecot</span><br><span class="line"># vim /var/log/maillog</span><br><span class="line"># mail user@gmail.com</span><br><span class="line"># vim /etc/aliases</span><br><span class="line"># newaliases</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Objective&quot;&gt;&lt;a href=&quot;#Objective&quot; class=&quot;headerlink&quot; title=&quot;Objective&quot;&gt;&lt;/a&gt;Objective&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;Local network (web)mail server.&lt;/li&gt;</summary>
      
    
    
    
    <category term="Linux" scheme="https://kenryu.cc/ja/categories/Linux/"/>
    
    
    <category term="Server" scheme="https://kenryu.cc/ja/tags/Server/"/>
    
    <category term="Nginx" scheme="https://kenryu.cc/ja/tags/Nginx/"/>
    
    <category term="MySQL" scheme="https://kenryu.cc/ja/tags/MySQL/"/>
    
    <category term="PHP" scheme="https://kenryu.cc/ja/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>phpipam</title>
    <link href="https://kenryu.cc/ja/2022/04/19/Linux/phpipam/"/>
    <id>https://kenryu.cc/ja/2022/04/19/Linux/phpipam/</id>
    <published>2022-04-19T08:58:10.000Z</published>
    <updated>2025-12-17T10:20:06.385Z</updated>
    
    <content type="html"><![CDATA[<p>LNMP<br>[toc]</p><table><thead><tr><th>Name</th><th>Version</th><th>Command</th></tr></thead><tbody><tr><td>phpIPAM</td><td>1.5</td><td>cd &#x2F;var&#x2F;www&#x2F;phpipam&#x2F; &amp;&amp; git log</td></tr><tr><td>Linux</td><td>Rocky Linux release 8.5 (Green Obsidian)</td><td>cat &#x2F;etc&#x2F;lsb-release &#x2F;etc&#x2F;os-release</td></tr><tr><td>Nginx</td><td>nginx version: nginx&#x2F;1.20.2</td><td>nginx -v</td></tr><tr><td>MySQL</td><td>mysql Ver 8.0.28 for Linux on x86_64 (MySQL Community Server - GPL)</td><td>mysql â€“version</td></tr><tr><td>PHP</td><td>PHP 7.3.20 (cli) (built: Jul 7 2020 07:53:49) ( NTS )</td><td>php -v</td></tr></tbody></table><h2 id="phpipam"><a href="#phpipam" class="headerlink" title="phpipam"></a>phpipam</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dnf -y install php-gmp git</span><br><span class="line">git clone https://github.com/phpipam/phpipam.git /var/www/phpipam</span><br><span class="line">chown -R nginx:nginx /var/www/phpipam</span><br><span class="line">cp /var/www/phpipam/config.dist.php /var/www/phpipam/config.php</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /var/www/phpipam/config.php</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$db[&#x27;host&#x27;] = &#x27;127.0.0.1&#x27;;</span><br><span class="line">$db[&#x27;user&#x27;] = &#x27;phpipam&#x27;;</span><br><span class="line">$db[&#x27;pass&#x27;] = &#x27;Your_Password&#x27;;</span><br><span class="line">$db[&#x27;name&#x27;] = &#x27;phpipam&#x27;;</span><br><span class="line">$db[&#x27;port&#x27;] = 3306;</span><br></pre></td></tr></table></figure><h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># mysql -u root -p</span><br><span class="line">mysql&gt; create database phpipam;</span><br><span class="line">mysql&gt; create user phpipam@localhost identified with mysql_native_password by &#x27;P@ssw0rd&#x27;;</span><br><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON phpipam.* TO phpipam@localhost;</span><br><span class="line">mysql&gt; flush privileges;</span><br></pre></td></tr></table></figure><h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/php-fpm.d/www.conf</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- user = apache</span><br><span class="line">- group = apache</span><br><span class="line">+ user = nginx</span><br><span class="line">+ group = nginx</span><br><span class="line">+ listen.owner = nginx</span><br><span class="line">+ listen.group = nginx</span><br><span class="line">+ listen.mode = 0660</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;&lt;?php phpinfo(); ?&gt;&quot; &gt;&gt; /usr/share/nginx/html/index.php</span><br><span class="line">systemctl restart php-fpm.service</span><br></pre></td></tr></table></figure><h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><p>Backup nginx default config file.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf.bak</span><br></pre></td></tr></table></figure><p>Edit site config file .</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/conf.d/ipam.kensho.toda.conf</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">listen 443 ssl http2;</span><br><span class="line">server_name ipam.kensho.toda;</span><br><span class="line">root /var/www/phpipam;</span><br><span class="line">index index.php;</span><br><span class="line"></span><br><span class="line">ssl_certificate &quot;/etc/pki/nginx/ipam.kensho.toda.crt&quot;;</span><br><span class="line">ssl_certificate_key &quot;/etc/pki/nginx/private/ipam.kensho.toda.key&quot;;</span><br><span class="line">ssl_session_cache shared:SSL:1m;</span><br><span class="line">ssl_session_timeout 10m;</span><br><span class="line">ssl_ciphers PROFILE=SYSTEM;</span><br><span class="line">ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">try_files $uri $uri/ /phpipam/index.php;</span><br><span class="line">index index.php;</span><br><span class="line">&#125;</span><br><span class="line">location /api/ &#123;</span><br><span class="line">try_files $uri $uri/ /phpipam/api/index.php;</span><br><span class="line">&#125;</span><br><span class="line">location ~ \.php$ &#123;</span><br><span class="line">fastcgi_pass unix:/run/php-fpm/www.sock;</span><br><span class="line">fastcgi_index index.php;</span><br><span class="line">try_files $uri $uri/ index.php = 404;</span><br><span class="line">fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">include fastcgi_params;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name ipam.kensho.toda;</span><br><span class="line">return 301 https://ipam.kensho.toda$request_uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nginx -t</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure><h2 id="Complete-the-initial-configuration-wizard"><a href="#Complete-the-initial-configuration-wizard" class="headerlink" title="Complete the initial configuration wizard"></a>Complete the initial configuration wizard</h2><p><img src="/resources/e20d331a346c4df1a9d79f0280535d60.png" alt="c82bd586d5a8c037e3ae38c9c9e04aaa.png"></p><p><img src="/resources/2efc6bc066444483937a6857aa8290bc.png" alt="73a9d5e21d38e3d58c7cd9d6778e4a67.png"></p><p>The default Login credentials are:</p><ul><li>Username: admin</li><li>Password: ipamadmin</li></ul><h2 id="Toubleshoting"><a href="#Toubleshoting" class="headerlink" title="Toubleshoting"></a>Toubleshoting</h2><p>Reset phpipam admin password.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php /var/www/phpipam/functions/scripts/reset-admin-password.php</span><br></pre></td></tr></table></figure><p>Check databaseâ€™s user.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># mysql -u root -p</span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">mysql&gt; select user,host,plugin from user;</span><br></pre></td></tr></table></figure><h2 id="Schedule-check-ip-via-cron"><a href="#Schedule-check-ip-via-cron" class="headerlink" title="Schedule check-ip via cron"></a>Schedule check-ip via cron</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># crontab -e</span><br><span class="line">*/15 Install_JavaScripts_via_npm.sh README.md _config.landscape.yml _config.yml db.json i18n joplin2hexo node_modules package.json public scaffolds source themes tmp Install_JavaScripts_via_npm.sh README.md _config.landscape.yml _config.yml db.json i18n joplin2hexo node_modules package.json public scaffolds source themes tmp Install_JavaScripts_via_npm.sh README.md _config.landscape.yml _config.yml db.json i18n joplin2hexo node_modules package.json public scaffolds source themes tmp Install_JavaScripts_via_npm.sh README.md _config.landscape.yml _config.yml db.json i18n joplin2hexo node_modules package.json public scaffolds source themes tmp root /usr/bin/php /var/www/phpipam/functions/scripts/pingCheck.php</span><br><span class="line">*/15 Install_JavaScripts_via_npm.sh README.md _config.landscape.yml _config.yml db.json i18n joplin2hexo node_modules package.json public scaffolds source themes tmp Install_JavaScripts_via_npm.sh README.md _config.landscape.yml _config.yml db.json i18n joplin2hexo node_modules package.json public scaffolds source themes tmp Install_JavaScripts_via_npm.sh README.md _config.landscape.yml _config.yml db.json i18n joplin2hexo node_modules package.json public scaffolds source themes tmp Install_JavaScripts_via_npm.sh README.md _config.landscape.yml _config.yml db.json i18n joplin2hexo node_modules package.json public scaffolds source themes tmp root /usr/bin/php /var/www/phpipam/functions/scripts/discoveryCheck.php</span><br><span class="line"># crontab -l</span><br></pre></td></tr></table></figure><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ol><li><a href="https://github.com/phpipam/phpipam">https://github.com/phpipam/phpipam</a></li><li><a href="https://phpipam.net/documents/installation/">https://phpipam.net/documents/installation/</a></li><li><a href="https://phpipam.net/news/phpipam-on-nginx/">https://phpipam.net/news/phpipam-on-nginx/</a></li><li><a href="https://computingforgeeks.com/install-and-configure-phpipam-on-ubuntu-debian-linux/">https://computingforgeeks.com/install-and-configure-phpipam-on-ubuntu-debian-linux/</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;LNMP&lt;br&gt;[toc]&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;Version&lt;/th&gt;
&lt;th&gt;Command&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;phpIPAM&lt;/td&gt;
&lt;td&gt;1.</summary>
      
    
    
    
    <category term="Linux" scheme="https://kenryu.cc/ja/categories/Linux/"/>
    
    
  </entry>
  
  <entry>
    <title>ZFSå¸¸ç”¨å‘½ä»¤</title>
    <link href="https://kenryu.cc/ja/2022/02/28/ZFS/ZFS%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <id>https://kenryu.cc/ja/2022/02/28/ZFS/ZFS%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</id>
    <published>2022-02-28T06:52:32.000Z</published>
    <updated>2022-06-30T13:52:05.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-åˆ›å»ºpoolå’ŒZFSæ–‡ä»¶ç³»ç»Ÿ"><a href="#1-åˆ›å»ºpoolå’ŒZFSæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="1. åˆ›å»ºpoolå’ŒZFSæ–‡ä»¶ç³»ç»Ÿ"></a>1. åˆ›å»ºpoolå’ŒZFSæ–‡ä»¶ç³»ç»Ÿ</h1><ul><li><p>åˆ›å»ºåä¸º â€œtankâ€ çš„å­˜å‚¨æ± Â (type: ,mirror,raidz,raidz2,raidz3)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zpool create tank &lt;type&gt; sdb sdc sdd sde</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š Linuxçš„å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œsdaï¼Œsdbï¼Œsdcå¹¶æ²¡æœ‰æŒ‰ç…§slotçš„é¡ºåºæ’åˆ—ï¼Œæ˜¯ä¹±åºçš„ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find -L /dev/disk/by-id -samefile /dev/sda</span><br></pre></td></tr></table></figure></li><li><p>å‘æ± ä¸­æ·»åŠ æ›´å¤šç©ºé—´</p><blockquote><p>æ± (pool)ä¸­çš„å…¶ä»–ç©ºé—´(vdev)è¦ç›¸åŒtypeï¼Œç›¸åŒæ•°é‡ã€‚å¦åˆ™å‡ºç°â€mismatched replication levelâ€é”™è¯¯ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zpool add tank mirror sdf sdg</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿï¼ŒæŒ‚è½½åœ¨ &#x2F;export&#x2F;home ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ create tank/home</span><br><span class="line"># df -Th</span><br><span class="line"># zfsÂ set mountpoint=/export/home tank/home</span><br></pre></td></tr></table></figure></li><li><p>ä¸ºå¤šä¸ªç”¨æˆ·åˆ›å»ºèµ·å§‹ç›®å½•<br>t&gt; è¯·æ³¨æ„ï¼šç”±äºç»§æ‰¿è€Œè‡ªåŠ¨æŒ‚è½½åœ¨ &#x2F;export&#x2F;home&#x2F;{ahrens,bonwick,billm} ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ create tank/home/ahrens</span><br><span class="line"># zfsÂ create tank/home/bonwick</span><br><span class="line"># zfsÂ create tank/home/billm</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹æ–‡ä»¶ç³»ç»Ÿåç§°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ rename tank/home/ahrensÂ tank/home/nahrens</span><br></pre></td></tr></table></figure></li><li><p>åˆ é™¤æ–‡ä»¶ç³»ç»Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ destroy -Rf tank/fs</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹å­˜å‚¨æ± çš„åç§°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># zpool export tank</span><br><span class="line"></span><br><span class="line"># zpool import tank newpool</span><br></pre></td></tr></table></figure></li></ul><h1 id="2-è®¾ç½®å±æ€§"><a href="#2-è®¾ç½®å±æ€§" class="headerlink" title="2. è®¾ç½®å±æ€§"></a>2. è®¾ç½®å±æ€§</h1><ul><li>è‡ªåŠ¨ä»¥ NFSÂ æ–¹å¼å…±äº«è¯¥æ–‡ä»¶ç³»ç»Ÿ<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ setÂ sharenfs=rw tank/home</span><br></pre></td></tr></table></figure></li><li>å¯¹æ–‡ä»¶ç³»ç»Ÿä¸­æ‰€æœ‰æ•°æ®å¯ç”¨å‹ç¼©<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ set compression=on tank</span><br></pre></td></tr></table></figure></li><li>å°†ç”¨æˆ· Açš„æœ€å¤§ç©ºé—´é™åˆ¶ä¸º 10g<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ set quota=10g tank/home/userA</span><br></pre></td></tr></table></figure></li><li>ä¿è¯ç”¨æˆ· Bæœ‰ 20g çš„é¢„ç•™ç©ºé—´<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ set reservation=20g tank/home/userB</span><br></pre></td></tr></table></figure></li><li>å¯é€šè¿‡å‘½ä»¤æŸ¥è¯¢æ–‡ä»¶ç³»ç»Ÿçš„æ‰€æœ‰å±æ€§<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ get all tank/home</span><br></pre></td></tr></table></figure></li><li>å¯é€šè¿‡å‘½ä»¤æŸ¥è¯¢å­˜å‚¨æ± çš„æ‰€æœ‰å±æ€§<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zpool get all tank</span><br></pre></td></tr></table></figure></li><li>å¤§å¤šæ•°å±æ€§å¯é€šè¿‡ç»§æ‰¿æ–¹å¼è‡ªåŠ¨è®¾ç½®Â <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ inherit &lt;property&gt; tank/home/eschrock</span><br></pre></td></tr></table></figure></li></ul><h1 id="3-ZFS-snapshot"><a href="#3-ZFS-snapshot" class="headerlink" title="3. ZFSÂ snapshot"></a>3. ZFSÂ snapshot</h1><ul><li>æ–‡ä»¶ç³»ç»Ÿçš„åªè¯»å‰¯æœ¬<br>å³æ—¶åˆ›å»ºã€æ•°é‡ä¸é™,ä¸å ç”¨é¢å¤–ç©ºé—´ - å—ä»…åœ¨å‘ç”Ÿæ›´æ”¹æ—¶æ‰ä¼šè¢«å¤åˆ¶<br>å¯é€šè¿‡æ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿæ ¹ç›®å½•ä¸‹çš„ .zfs&#x2F;snapshot è®¿é—®<br>ä½¿ç”¨æˆ·å¯åœ¨æ²¡æœ‰ç³»ç»Ÿç®¡ç†å‘˜ä»‹å…¥çš„æƒ…å†µä¸‹æ¢å¤æ–‡ä»¶<br>å¯¹ç”¨æˆ·ï¼¡ çš„èµ·å§‹ç›®å½•æ‰§è¡Œå¿«ç…§æ•è·<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ snapshot tank/home/usera@tuesday</span><br></pre></td></tr></table></figure></li><li>å›æ»šåˆ°å‰ä¸€ä¸ªå¿«ç…§<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ rollback tank/home/usera@monday</span><br></pre></td></tr></table></figure></li><li>æŸ¥çœ‹æ˜ŸæœŸä¸‰çš„ foo.c ç‰ˆæœ¬<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat /tank/home/usera/.zfs/snapshot/wednesday/foo.c</span><br></pre></td></tr></table></figure></li><li>åˆ é™¤å¿«ç…§<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ destroy -R tank/home/usera@monday</span><br></pre></td></tr></table></figure></li></ul><h1 id="4-ZFS-Clone"><a href="#4-ZFS-Clone" class="headerlink" title="4. ZFSÂ Clone"></a>4. ZFSÂ Clone</h1><ul><li><p>å¿«ç…§çš„å¯å†™å‰¯æœ¬<br>å³æ—¶åˆ›å»ºã€æ•°é‡ä¸é™<br>å­˜å‚¨å¤§éƒ¨åˆ†ä¸ºå…±äº«æ•°æ®çš„ä¼—å¤šä¸“ç”¨å‰¯æœ¬çš„ç†æƒ³æ–¹æ³•<br>è½¯ä»¶å®‰è£…<br>å·¥ä½œåŒº<br>æ— ç›˜å®¢æˆ·æœº</p></li><li><p>åˆ›å»º OpenSolarisÂ æºä»£ç çš„å…‹éš†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ clone tank/solaris@monday tank/ws/lori/fix</span><br></pre></td></tr></table></figure></li></ul><h1 id="5-ZFS-send-x2F-receive"><a href="#5-ZFS-send-x2F-receive" class="headerlink" title="5. ZFSÂ send&#x2F;receive"></a>5. ZFSÂ send&#x2F;receive</h1><ul><li><p>åŸºäºå¿«ç…§ç‚¹<br>å®Œæ•´å¤‡ä»½ï¼šä»»ä½•å¿«ç…§<br>å¢é‡å¤‡ä»½ï¼šä»»ä½•å¿«ç…§å¢é‡<br>é€Ÿåº¦å¾ˆå¿« - å¼€é”€ä¸æ›´æ”¹çš„æ•°æ®æˆæ¯”ä¾‹<br>éå¸¸é«˜æ•ˆï¼Œå¯æ‰§è¡Œè¿œç¨‹å¤åˆ¶</p></li><li><p>ç”Ÿæˆå®Œæ•´å¤‡ä»½</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ sendÂ tank/fs@A &gt;/backup/A Â  Â </span><br></pre></td></tr></table></figure></li><li><p>ç”Ÿæˆå¢é‡å¤‡ä»½</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ sendÂ -i tank/fs@A tank/fs@B &gt;/backup/B-A</span><br></pre></td></tr></table></figure></li><li><p>è¿œç¨‹å¤åˆ¶ï¼šæ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡å¢é‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ sendÂ -i tank/fs@11:31 tank/fs@11:32 | ssh host zfsÂ receive -d /tank/fs</span><br></pre></td></tr></table></figure></li></ul><h1 id="6-ZFS-æ•°æ®è¿ç§»"><a href="#6-ZFS-æ•°æ®è¿ç§»" class="headerlink" title="6. ZFSÂ æ•°æ®è¿ç§»"></a>6. ZFSÂ æ•°æ®è¿ç§»</h1><ul><li><p>ç‹¬ç«‹äºä¸»æœºçš„ç£ç›˜æ ¼å¼<br>å°†æœåŠ¡å™¨ä» x86 æ›´æ”¹ä¸ºÂ SPARCï¼Œä¹Ÿèƒ½è¿è¡Œ<br>è‡ªé€‚åº”å­—èŠ‚å­˜å‚¨é¡ºåº (Adaptive endianness)ï¼šåœ¨ä¸¤ä¸ªå¹³å°ä¸Šéƒ½æ— éœ€é¢å¤–æˆæœ¬<br>å†™å…¥æ€»æ˜¯ä½¿ç”¨æœ¬åœ°å­—èŠ‚å­˜å‚¨é¡ºåº (native endianness)ï¼Œåœ¨å—æŒ‡é’ˆä¸­è®¾ç½®ä½<br>ä»…å½“ä¸»æœºå­—èŠ‚å­˜å‚¨é¡ºåº (endianness) !&#x3D; å—å­—èŠ‚å­˜å‚¨é¡ºåºæ—¶ï¼Œæ‰ä¼šé’ˆå¯¹è¯»å–è¿›è¡Œå­—èŠ‚äº¤æ¢</p></li><li><p>ZFSÂ è´Ÿè´£æ‰€æœ‰å¤„ç†<br>æ— éœ€è€ƒè™‘è®¾å¤‡è·¯å¾„ã€é…ç½®æ–‡ä»¶ã€&#x2F;etc&#x2F;vfstab ç­‰ç­‰<br>ZFSÂ ä¼šåœ¨å¿…è¦æ—¶è¿›è¡Œå…±äº«&#x2F;å–æ¶ˆå…±äº«ã€æŒ‚è½½&#x2F;å–æ¶ˆæŒ‚è½½ç­‰ç­‰</p></li><li><p>ä»æ—§æœåŠ¡å™¨ä¸Šå¯¼å‡ºæ± tank</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">old# zpool export tank</span><br></pre></td></tr></table></figure></li><li><p>ç‰©ç†ç§»åŠ¨ç£ç›˜å¹¶å°†æ± å¯¼å…¥åˆ°æ–°æœåŠ¡å™¨ä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new# zpool import tank</span><br></pre></td></tr></table></figure></li></ul><h1 id="7-è®¾å¤‡ç®¡ç†"><a href="#7-è®¾å¤‡ç®¡ç†" class="headerlink" title="7. è®¾å¤‡ç®¡ç†"></a>7. è®¾å¤‡ç®¡ç†</h1><ul><li><p>æ·»åŠ &#x2F;æ›¿æ¢æ–°è®¾å¤‡ (type: ,mirror,raidz,raidz2,raidz3)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># zpool add tank &lt;type&gt; c0t2d0 c0t3d0 c0t4d0</span><br><span class="line"></span><br><span class="line"># zpool replace tank c0t1d0 c0t2d0</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ &#x2F;ç§»é™¤é•œåƒè®¾å¤‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># zpool attach tank c0t1d0 c0t2d0</span><br><span class="line"># zpool detach tank c0t2d0</span><br></pre></td></tr></table></figure></li><li><p>å°†è®¾å¤‡åœæ­¢æˆ–æ‰‹å·¥å¯åŠ¨Â </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># zpool offline tank c0t2d0</span><br><span class="line"># zpool online tank c0t2d0</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å­˜å‚¨æ± å½“å‰çŠ¶æ€å’Œ I&#x2F;O çŠ¶å†µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># zpoolÂ statusÂ -v tank</span><br><span class="line"># zpool iostat tank 1</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ çƒ­å¤‡è®¾å¤‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zpool add tankÂ spare c0t2d0</span><br></pre></td></tr></table></figure></li><li><p>æŒ‡å®šçƒ­å¤‡å¯åŠ¨&#x2F;åœæ­¢çƒ­å¤‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># zpool replace tank c0t1d0 c0t2d0</span><br><span class="line"># zpool detach tank c0t2d0</span><br></pre></td></tr></table></figure></li><li><p>å°†çƒ­å¤‡è®¾å¤‡åˆ é™¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zpool remove tank c0t2d0</span><br></pre></td></tr></table></figure></li><li><p>æ·»åŠ &#x2F;åˆ é™¤ç‹¬ç«‹çš„æ—¥å¿—è®¾å¤‡ï¼ˆæ€§èƒ½æ”¹å–„ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># zpool add tank log c0t3d0</span><br><span class="line"># zpool remove tank c0t3d0</span><br></pre></td></tr></table></figure></li></ul><h1 id="8-ZFS-æƒé™ç®¡ç†"><a href="#8-ZFS-æƒé™ç®¡ç†" class="headerlink" title="8. ZFSÂ æƒé™ç®¡ç†"></a>8. ZFSÂ æƒé™ç®¡ç†</h1><ul><li><p>å¯ä»¥å°†zfs(1M) çš„ç®¡ç†æƒé™åˆ†æ´¾ç»™æ™®é€šç”¨æˆ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Â  Â  Â  &#x27;zfsÂ allow&#x27;</span><br><span class="line">Â  Â  Â  &#x27;zfsÂ unallow&#x27;</span><br></pre></td></tr></table></figure></li><li><p>å°†æƒé™æˆäºˆä¸€ä¸ªæ™®é€šç”¨æˆ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ allow marksÂ create,snapshot tank/marks</span><br></pre></td></tr></table></figure></li><li><p>å°†æŒ‡å®šæƒé™å›æ”¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ unallow marksÂ create,snapshot tank/marks</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿå½“å‰çš„æƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ allow tank/marks</span><br></pre></td></tr></table></figure></li></ul><h1 id="9-å…¶å®ƒå‘½ä»¤"><a href="#9-å…¶å®ƒå‘½ä»¤" class="headerlink" title="9. å…¶å®ƒå‘½ä»¤"></a>9. å…¶å®ƒå‘½ä»¤</h1><ul><li>æ˜¾ç¤ºå­˜å‚¨æ± æ‰€æœ‰æ“ä½œå†å²è®°å½•<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zpool history tank</span><br></pre></td></tr></table></figure></li><li>å‡çº§å­˜å‚¨æ± åˆ°æŒ‡å®šÂ SPA ç‰ˆæœ¬<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zpool upgrade -V &lt;version&gt; tank</span><br></pre></td></tr></table></figure></li><li>å‡çº§æ–‡ä»¶ç³»ç»Ÿåˆ°æŒ‡å®š ZPL ç‰ˆæœ¬<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ upgrade -V &lt;version&gt; tank/fs</span><br></pre></td></tr></table></figure></li><li>æ‰‹å·¥æŒ‚è½½&#x2F;å¸è½½æ–‡ä»¶ç³»ç»Ÿ<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># zfsÂ mount -a</span><br><span class="line"># zfsÂ unmount tank/fs</span><br><span class="line"># zfs unmount -a</span><br></pre></td></tr></table></figure></li></ul><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol><li><a href="https://chegva.com/1337.html">ZFSå¸¸ç”¨å‘½ä»¤</a></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;1-åˆ›å»ºpoolå’ŒZFSæ–‡ä»¶ç³»ç»Ÿ&quot;&gt;&lt;a href=&quot;#1-åˆ›å»ºpoolå’ŒZFSæ–‡ä»¶ç³»ç»Ÿ&quot; class=&quot;headerlink&quot; title=&quot;1. åˆ›å»ºpoolå’ŒZFSæ–‡ä»¶ç³»ç»Ÿ&quot;&gt;&lt;/a&gt;1. åˆ›å»ºpoolå’ŒZFSæ–‡ä»¶ç³»ç»Ÿ&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;åˆ›å»ºå</summary>
      
    
    
    
    <category term="ZFS" scheme="https://kenryu.cc/ja/categories/ZFS/"/>
    
    
    <category term="Server" scheme="https://kenryu.cc/ja/tags/Server/"/>
    
    <category term="ZFS" scheme="https://kenryu.cc/ja/tags/ZFS/"/>
    
    <category term="Storage" scheme="https://kenryu.cc/ja/tags/Storage/"/>
    
  </entry>
  
  <entry>
    <title>Setup WebDAV server (Apache)</title>
    <link href="https://kenryu.cc/ja/2021/12/15/File_Sharing_Servers/Setup_WebDAV_server__Apache_/"/>
    <id>https://kenryu.cc/ja/2021/12/15/File_Sharing_Servers/Setup_WebDAV_server__Apache_/</id>
    <published>2021-12-15T12:17:52.000Z</published>
    <updated>2022-06-30T13:52:05.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Premise"><a href="#Premise" class="headerlink" title="Premise"></a>Premise</h1><ul><li>Installed <strong>Apache</strong> .</li><li>Installed SSL&#x2F;TLS server <strong>Private key &amp; Certificate</strong>.</li><li>Disabled SELinux.</li><li>Allowed Firewall.</li></ul><h1 id="Enviroment"><a href="#Enviroment" class="headerlink" title="Enviroment"></a>Enviroment</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@rhel8 ~]# cat /etc/redhat-release</span><br><span class="line">Red Hat Enterprise Linux release 8.5 (Ootpa)</span><br><span class="line">[root@rhel8 ~]# httpd -v</span><br><span class="line">Server version: Apache/2.4.37 (Red Hat Enterprise Linux)</span><br><span class="line">Server built: Oct 26 2021 14:18:06</span><br><span class="line">[root@rhel8 ~]# smbstatus --version</span><br><span class="line">Version 4.14.5</span><br></pre></td></tr></table></figure><h1 id="Make-Share-Folder"><a href="#Make-Share-Folder" class="headerlink" title="Make Share Folder"></a>Make Share Folder</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /share</span><br><span class="line">chmod -R 775 /share</span><br><span class="line">chown -R apache. /share</span><br></pre></td></tr></table></figure><h1 id="Configure-WebDAV"><a href="#Configure-WebDAV" class="headerlink" title="Configure WebDAV"></a>Configure WebDAV</h1><h3 id="Create-new-config-file-follwing"><a href="#Create-new-config-file-follwing" class="headerlink" title="Create new config file follwing:"></a>Create new config file follwing:</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf.d/webdav.conf</span><br><span class="line"></span><br><span class="line"># create new</span><br><span class="line">&lt;IfModule mod_dav_fs.c&gt;</span><br><span class="line">DAVLockDB /var/lib/dav/lockdb</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line">Alias /share /share</span><br><span class="line">&lt;Location /share&gt;</span><br><span class="line">DAV On</span><br><span class="line">SSLRequireSSL</span><br><span class="line">Options None</span><br><span class="line">AuthType Basic</span><br><span class="line">AuthName WebDAV</span><br><span class="line">AuthUserFile /etc/httpd/conf/.htpasswd</span><br><span class="line">&lt;RequireAny&gt;</span><br><span class="line">Require method GET POST OPTIONS</span><br><span class="line">Require valid-user</span><br><span class="line">&lt;/RequireAny&gt;</span><br><span class="line">&lt;/Location&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Create-WebDAV-User"><a href="#Create-WebDAV-User" class="headerlink" title="Create WebDAV User"></a>Create WebDAV User</h3><blockquote><p>Note: This user is not your operating systemâ€™s user.</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">htpasswd -c /etc/httpd/conf/.htpasswd &lt;InputYourUserName&gt;</span><br><span class="line">New password: &lt;InputYourPassword&gt;</span><br><span class="line">Re-type new password: &lt;InputYourPassword&gt;</span><br><span class="line">Adding password for user &lt;HereIsYourUserName&gt;</span><br></pre></td></tr></table></figure><h3 id="Optional-Edit-Apache-run-user"><a href="#Optional-Edit-Apache-run-user" class="headerlink" title="(Optional) Edit Apache run user"></a><del>(Optional) Edit Apache run user</del></h3><p>It doesnâ€™t work.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf/httpd.conf</span><br><span class="line"></span><br><span class="line">69 #User apache</span><br><span class="line">70 #Group apache</span><br><span class="line">71 User cjl</span><br><span class="line">72 Group cjl</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Start-Apache"><a href="#Start-Apache" class="headerlink" title="Start Apache"></a>Start Apache</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable --now httpd</span><br></pre></td></tr></table></figure><h1 id="Optional-Configure-SMB"><a href="#Optional-Configure-SMB" class="headerlink" title="(Optional) Configure SMB"></a>(Optional) Configure SMB</h1><p>When we want SMB to coexist with WebDAV.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/samba/smb.conf</span><br><span class="line"></span><br><span class="line">[global]</span><br><span class="line">workgroup = WORKGROUP</span><br><span class="line">security=user</span><br><span class="line">map to guest =Bad User</span><br><span class="line"></span><br><span class="line">#æ·»åŠ åä¸ºshareçš„å…±äº«æ–‡ä»¶å¤¹</span><br><span class="line">[share]</span><br><span class="line">comment = share all</span><br><span class="line">path = /share</span><br><span class="line">browseable = yes</span><br><span class="line">public = yes</span><br><span class="line">writable = yes</span><br><span class="line">create mode = 0744</span><br><span class="line">force create mode = 0744</span><br><span class="line">directory mode = 0744</span><br><span class="line">force directory mode = 0744</span><br><span class="line">force user = apache</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart smb</span><br></pre></td></tr></table></figure><h1 id="WebDAV-Client"><a href="#WebDAV-Client" class="headerlink" title="WebDAV Client"></a>WebDAV Client</h1><h2 id="Windows11"><a href="#Windows11" class="headerlink" title="Windows11"></a>Windows11</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net use W: https://192.168.64.84:10443/share /user:cjh Passw0rd</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼šæ­¤æ—¶è¯¥ä½¿ç”¨ç‡ä¸º C ç›˜ä½¿ç”¨ç‡</p></blockquote><p><img src="/resources/c66e506b80dc4c7696a76e2d002a2f72.png" alt="93f97ccc15849f38f8bc1e02178d4b98.png"></p><p><img src="/resources/4c10e6a842fd4da0bb434d30eeeb9122.png" alt="48b98cb67ab001de8adead97de6605f4.png"></p><p><img src="/resources/56645ff907b0427fb4dcbd2cc397ef12.png" alt="0e185d4f4e020542ea4470cbb2879782.png"><br><img src="/resources/d7271438ef97408e953e8cf3ee39777f.png" alt="91c59f85f40de20ac4df8b55650b5d99.png"><br>]</p><h1 id="å…å¯†ç ç™»å½•"><a href="#å…å¯†ç ç™»å½•" class="headerlink" title="å…å¯†ç ç™»å½•"></a>å…å¯†ç ç™»å½•</h1><blockquote><p>å‚è€ƒï¼š<a href="https://httpd.apache.org/docs/2.4/mod/mod_dav.html">https://httpd.apache.org/docs/2.4/mod/mod_dav.html</a></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf.d/webdav.conf</span><br><span class="line"></span><br><span class="line"># create new</span><br><span class="line">DAVLockDB /var/lib/dav/lockdb</span><br><span class="line">Alias /share /share</span><br><span class="line">&lt;Directory &quot;/share&quot;&gt;</span><br><span class="line">Require all granted</span><br><span class="line">Dav On</span><br><span class="line"></span><br><span class="line">AuthType Basic</span><br><span class="line">AuthName DAV</span><br><span class="line">AuthUserFile &quot;user.passwd&quot;</span><br><span class="line"></span><br><span class="line">&lt;LimitExcept GET POST OPTIONS&gt;</span><br><span class="line">Require user admin</span><br><span class="line">&lt;/LimitExcept&gt;</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Premise&quot;&gt;&lt;a href=&quot;#Premise&quot; class=&quot;headerlink&quot; title=&quot;Premise&quot;&gt;&lt;/a&gt;Premise&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;Installed &lt;strong&gt;Apache&lt;/strong&gt; .&lt;/li&gt;
&lt;li</summary>
      
    
    
    
    <category term="File Sharing Servers" scheme="https://kenryu.cc/ja/categories/File-Sharing-Servers/"/>
    
    
  </entry>
  
  <entry>
    <title>SMART Monitoring Tools</title>
    <link href="https://kenryu.cc/ja/2021/12/11/Storage/SMART_Monitoring_Tools/"/>
    <id>https://kenryu.cc/ja/2021/12/11/Storage/SMART_Monitoring_Tools/</id>
    <published>2021-12-11T03:09:02.000Z</published>
    <updated>2022-06-30T13:52:05.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Objectives"><a href="#Objectives" class="headerlink" title="Objectives"></a>Objectives</h1><ul><li>Self-Monitoring, Analysis and Reporting Technology.</li><li>Logging SMART errors and changes via the SYSLOG interface.</li><li>Send email warnings if problems are detected.</li><li>Make HDD enclosure LED blinking.</li></ul><h1 id="Descriptions"><a href="#Descriptions" class="headerlink" title="Descriptions"></a>Descriptions</h1><h2 id="smartmontools"><a href="#smartmontools" class="headerlink" title="smartmontools"></a>smartmontools</h2><p>smartctl controls the Self-Monitoring, Analysis and Reporting Technology (SMART) system built into most ATA&#x2F;SATA and SCSI&#x2F;SAS hard drives and solid-state drives. The purpose of SMART is to monitor the reliability of the hard drive and predict drive failures, and to carry out different types of drive self-tests. smartctl also supports some features not related to SMART. This version of smartctl is compatible with ACS-3, ACS-2, ATA8-ACS, ATA&#x2F;ATAPI-7 and earlier standards (see REFERENCES below).</p><h2 id="ledmon"><a href="#ledmon" class="headerlink" title="ledmon"></a>ledmon</h2><p>The ledctl is an user space application designed to control LEDs associated with each slot in an enclosure or a drive bay. The LEDs of devices listed in list_of_devices are set to the given pattern pattern_name and all other LEDs are turned off. User must have root privileges to use this application.</p><h1 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h1><p>Install SMART monitor tool and set it to start automatically when OS start-up.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dnf -y install smartmontools</span><br><span class="line">systemctl enable --now ledmon.service</span><br></pre></td></tr></table></figure><p>Install LEDâ€™s controller tool and set it to start automatically when OS start-up.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dnf -y install ledmon</span><br><span class="line">systemctl enable --now smartd.service</span><br></pre></td></tr></table></figure><h1 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h1><h2 id="smartmontools-1"><a href="#smartmontools-1" class="headerlink" title="smartmontools"></a>smartmontools</h2><p>Send Error massege via SMTP</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/smartmontools/smartd.conf</span><br><span class="line"></span><br><span class="line"># Specify SMTP server and accounds.</span><br></pre></td></tr></table></figure><h1 id="Maintenance"><a href="#Maintenance" class="headerlink" title="Maintenance"></a>Maintenance</h1><blockquote><p>Note: Not recommented to use &#x2F;dev&#x2F;sdX to specify HDD.</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">smartctl --scan</span><br><span class="line">smartctl /dev/sda -i</span><br></pre></td></tr></table></figure><p>The following example illustrates how to locate a single block device.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ledctl locate=/dev/disk/by-id/wwn-0x5000039b0810bcd9</span><br></pre></td></tr></table></figure><p>The following example illustrates how to turn Locate LED off for the same block device.</p><pre><code>ledctl locate_off=/dev/disk/by-id/wwn-0x5000039b0810bcd9</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Objectives&quot;&gt;&lt;a href=&quot;#Objectives&quot; class=&quot;headerlink&quot; title=&quot;Objectives&quot;&gt;&lt;/a&gt;Objectives&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;Self-Monitoring, Analysis and Re</summary>
      
    
    
    
    <category term="Storage" scheme="https://kenryu.cc/ja/categories/Storage/"/>
    
    
    <category term="linux" scheme="https://kenryu.cc/ja/tags/linux/"/>
    
    <category term="server" scheme="https://kenryu.cc/ja/tags/server/"/>
    
    <category term="storage" scheme="https://kenryu.cc/ja/tags/storage/"/>
    
  </entry>
  
  <entry>
    <title>Deploy Nginx, MySQL, PHP on Linux (LEMP/LNMP stack)</title>
    <link href="https://kenryu.cc/ja/2021/11/22/Linux/Deploy-Linux-Nginx-MySQL-PHP-Server/"/>
    <id>https://kenryu.cc/ja/2021/11/22/Linux/Deploy-Linux-Nginx-MySQL-PHP-Server/</id>
    <published>2021-11-21T15:00:00.000Z</published>
    <updated>2022-06-30T13:52:05.000Z</updated>
    
    <content type="html"><![CDATA[<table><thead><tr><th>Name</th><th>Version</th><th>Command</th></tr></thead><tbody><tr><td>Linux</td><td>Rocky Linux release 8.5 (Green Obsidian)</td><td>cat &#x2F;etc&#x2F;os-release &#x2F;etc&#x2F;redhat-release &#x2F;etc&#x2F;system-release</td></tr><tr><td>Nginx</td><td>nginx version: nginx&#x2F;1.20.2</td><td>nginx -v</td></tr><tr><td>MySQL</td><td>mysql Ver 8.0.28 for Linux on x86_64 (MySQL Community Server - GPL)</td><td>mysql â€“version</td></tr><tr><td>PHP</td><td>PHP 7.4.29 (cli) (built: Apr 12 2022 10:55:38) ( NTS )</td><td>php -v</td></tr></tbody></table><h1 id="0-Preparation"><a href="#0-Preparation" class="headerlink" title="0. Preparation"></a>0. Preparation</h1><p>Check if old packages have been installed.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># rpm -qa | grep -E &quot;nginx|php|mariadb&quot;</span><br></pre></td></tr></table></figure><p>If they are installed, remove them.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># yum remove -y &quot;nginx*&quot;</span><br><span class="line"># yum remove -y &quot;php*&quot;</span><br><span class="line"># yum remove -y &quot;mariadb*&quot;</span><br></pre></td></tr></table></figure><h1 id="1-Add-repositories"><a href="#1-Add-repositories" class="headerlink" title="1. Add repositories"></a>1. Add repositories</h1><h3 id="1-1-Add-Nginx-Official-repository"><a href="#1-1-Add-Nginx-Official-repository" class="headerlink" title="1.1 Add Nginx Official repository"></a>1.1 Add Nginx Official repository</h3><p>Create and edit the following file.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/yum.repos.d/nginx.repo</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[nginx]</span><br><span class="line">name=nginx stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/$releasever/$basearch</span><br><span class="line">gpgcheck=1</span><br><span class="line">enable=1</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=true</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># yum-config-manager --enable nginx</span><br><span class="line"># dnf config-manager --enable nginx</span><br></pre></td></tr></table></figure><h3 id="1-2-Add-MySQL-Official-repositories"><a href="#1-2-Add-MySQL-Official-repositories" class="headerlink" title="1.2 Add MySQL Official repositories"></a>1.2 Add MySQL Official repositories</h3><p>Download and install repositories form : <a href="https://dev.mysql.com/downloads/repo/yum/">MySQL Community Downloads</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># dnf -y install https://repo.mysql.com//mysql80-community-release-el8-3.noarch.rpm</span><br><span class="line"># dnf config-manager --enable mysql80-community</span><br><span class="line"># yum repolist all | grep mysql</span><br></pre></td></tr></table></figure><h3 id="1-3-Add-PHP-repository"><a href="#1-3-Add-PHP-repository" class="headerlink" title="1.3 Add PHP repository"></a>1.3 Add PHP repository</h3><p>Execute the following commands in sequence to add and update epel repository.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># dnf install -y https://rpms.remirepo.net/enterprise/remi-release-8.rpm</span><br><span class="line"># dnf module enable php:remi-7.4 -y</span><br></pre></td></tr></table></figure><h1 id="2-Installation"><a href="#2-Installation" class="headerlink" title="2. Installation"></a>2. Installation</h1><h2 id="2-1-Install-Nginx"><a href="#2-1-Install-Nginx" class="headerlink" title="2.1 Install Nginx"></a>2.1 Install Nginx</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># dnf -y install nginx</span><br><span class="line"># nginx -v</span><br></pre></td></tr></table></figure><h2 id="2-2-Install-MySQL"><a href="#2-2-Install-MySQL" class="headerlink" title="2.2 Install MySQL"></a>2.2 Install MySQL</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># yum module disable mysql -y</span><br><span class="line"># yum install mysql-community-server -y</span><br><span class="line"># mysql -V</span><br></pre></td></tr></table></figure><h2 id="2-3-Install-PHP"><a href="#2-3-Install-PHP" class="headerlink" title="2.3 Install PHP"></a>2.3 Install PHP</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># dnf install php php-curl php-dom php-exif php-fileinfo php-fpm php-gd php-hash php-json php-mbstring php-mysqli php-openssl php-pcre php-xml libsodium php-ldap php-pdo php-pear php-snmp php-xml -y</span><br><span class="line"># php -v</span><br></pre></td></tr></table></figure><h1 id="3-Configuration"><a href="#3-Configuration" class="headerlink" title="3. Configuration"></a>3. Configuration</h1><h2 id="3-1-Configure-Nginx"><a href="#3-1-Configure-Nginx" class="headerlink" title="3.1 Configure Nginx"></a>3.1 Configure Nginx</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable --now nginx</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># mv /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf.bak</span><br><span class="line"># vim default.conf</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">root /usr/share/nginx/html;</span><br><span class="line">- index index.html index.htm;</span><br><span class="line">+ index index.html index.htm index.php;</span><br><span class="line">&#125;</span><br><span class="line">location ~ .php$ &#123;</span><br><span class="line">root /usr/share/nginx/html;</span><br><span class="line">fastcgi_pass unix:/run/php-fpm/www.sock;</span><br><span class="line">fastcgi_index index.php;</span><br><span class="line">fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</span><br><span class="line">include fastcgi_params;</span><br><span class="line">&#125;</span><br><span class="line">## Edit this file according to actual usage.</span><br></pre></td></tr></table></figure><h2 id="3-2-Configure-MySQL"><a href="#3-2-Configure-MySQL" class="headerlink" title="3.2 Configure MySQL"></a>3.2 Configure MySQL</h2><p>Start and set enabled the MySQL server</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable --now mysqld</span><br></pre></td></tr></table></figure><p>A superuser account â€˜rootâ€˜@â€™localhostâ€™ is created. A password for the superuser is set and stored in the error log file. To reveal it, use the following command:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># grep &#x27;temporary password&#x27; /var/log/mysqld.log</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># mysql -uroot -p</span><br><span class="line">mysql&gt; ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;Your_Password&#x27;;</span><br></pre></td></tr></table></figure><blockquote><p>MySQLâ€™s validate_password plugin is installed by default. This will require that passwords contain at least one uppercase letter, one lowercase letter, one digit, and one special character, and that the total password length is at least 8 characters.</p></blockquote><blockquote><p>Reference site<br><a href="https://dev.mysql.com/doc/mysql-yum-repo-quick-guide/en/">A Quick Guide to Using the MySQL Yum Repository</a></p></blockquote><h2 id="3-3-Configure-PHP"><a href="#3-3-Configure-PHP" class="headerlink" title="3.3 Configure PHP"></a>3.3 Configure PHP</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/php-fpm.d/www.conf</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- user = apache</span><br><span class="line">+ user = nginx</span><br><span class="line">- group = apache</span><br><span class="line">+ group = nginx</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># grep timezone /etc/php.ini</span><br><span class="line">; Defines the default timezone used by the date functions</span><br><span class="line">; http://php.net/date.timezone</span><br><span class="line">date.timezone = Asia/Tokyo</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable --now php-fpm</span><br></pre></td></tr></table></figure><hr><h2 id="Optional-Verify-environment-configuration"><a href="#Optional-Verify-environment-configuration" class="headerlink" title="(Optional) Verify environment configuration"></a>(Optional) Verify environment configuration</h2><p>Execute the following command to create test file.</p><blockquote><p>The root directory of the site that has been configured in <code>/usr/share/nginx/html</code>, This article uses thatdirectory as an example.</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># echo &quot;&lt;?php phpinfo(); ?&gt;&quot; &gt;&gt; /usr/share/nginx/html/index.php</span><br><span class="line"># nginx -t</span><br><span class="line"># nginx -s reload</span><br></pre></td></tr></table></figure><p>Modify the firewall policy to make the server can be accessed.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># firewall-cmd --permanent --add-port=&#123;443/tcp,80/tcp&#125;</span><br><span class="line"># firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>Access the following address in your browser.<br><a href="http://your_lnmp_server_ip/">http://your_lnmp_server_ip</a><br><img src="/resources/a00140617cff48c9ab2405d7a47ee3fc.png" alt="74cf5cec9ade58f2fb87e6003d42c459.png"><br><a href="http://your_lnmp_server_ip/index.php">http://your_lnmp_server_ip/index.php</a><br><img src="/resources/52ae4c9828d54beebfd2f823ba64d346.png" alt="4a5b21722700b65b44b39fde5379768e.png"></p><p>If the results are displayed as above, the environment is successfully configured.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;Version&lt;/th&gt;
&lt;th&gt;Command&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;Linux&lt;/td&gt;
&lt;td&gt;Rocky Linux release 8.5 (</summary>
      
    
    
    
    <category term="Linux" scheme="https://kenryu.cc/ja/categories/Linux/"/>
    
    
    <category term="Server" scheme="https://kenryu.cc/ja/tags/Server/"/>
    
    <category term="Nginx" scheme="https://kenryu.cc/ja/tags/Nginx/"/>
    
    <category term="MySQL" scheme="https://kenryu.cc/ja/tags/MySQL/"/>
    
    <category term="PHP" scheme="https://kenryu.cc/ja/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>æ­å»ºOpenVPN Over FRP</title>
    <link href="https://kenryu.cc/ja/2021/10/31/Network/%E6%90%AD%E5%BB%BAOpenVPN_Over_FRP/"/>
    <id>https://kenryu.cc/ja/2021/10/31/Network/%E6%90%AD%E5%BB%BAOpenVPN_Over_FRP/</id>
    <published>2021-10-31T05:08:47.000Z</published>
    <updated>2022-06-30T13:52:05.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨å­¦æ ¡æˆ–è€…å…¬å¸å¤–éƒ¨çš„ï¼Œæˆ–è€…å‡ºå·®åœ¨å¤–åœ°ï¼Œæƒ³è®¿é—®å­¦æ ¡æˆ–è€…å…¬å¸å†…ç½‘çš„æœåŠ¡å™¨ï¼Œä½†æ˜¯æ²¡ç”¨ç½‘ç»œç®¡ç†å‘˜çš„æƒé™ï¼Œæˆ–è€…ç½‘ç»œç®¡ç†å‘˜ä¸é…åˆè®¾å®šçš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•çªç ´NATç½‘ç»œé˜²ç«å¢™ï¼Œè¾¾åˆ°è®¿é—®å†…éƒ¨ç½‘ç»œã€‚è¿™æ˜¯æ­å»ºè¿™ä¸ªæœåŠ¡çš„ç›®çš„ã€‚</p><p>å…³äºfrp</p><blockquote><p>A fast reverse proxy to help you expose a local server behind a NAT or firewall to the internet. <a href="https://github.com/fatedier/frp">https://github.com/fatedier/frp</a></p></blockquote><p>å®ƒæ˜¯ä¸€ä¸ªåå‘ä»£ç†ç¨‹åºã€‚å®ƒå¯ä»¥å°†å€ŸåŠ©å­˜åœ¨äºå…¬ç½‘ä¸Šçš„ä»£ç†æœåŠ¡å™¨ï¼Œä¸­ç»§ NAT å’Œé˜²ç«å¢™åé¢çš„æœåŠ¡ï¼Œå®ç°å†…ç½‘ç©¿é€ï¼ˆNAT Traversalã€ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«é€éï¼†è²«é€šï¼‰çš„ä¸€ç§æ‰‹æ®µã€‚</p><p><img src="/resources/eade905969e34b7f9deed26d8a9c6dd0.png" alt="Openvpn over frp.png"></p><p>åœ¨æ¥ä¸‹æ¥æ­å»ºå¥½çš„ProxyæœåŠ¡å™¨ä¸­ï¼Œsockstatå‘½ä»¤ï¼ˆæ‘˜å½•ï¼›è€ƒè™‘éšç§å…¬ç½‘IPéšä¾¿å†™çš„ï¼‰ä¸­å¯ä»¥äº†è§£åˆ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[2.5.2-RELEASE][root@Proxy]/root: sockstat | grep frp</span><br><span class="line"></span><br><span class="line"># ç›‘å¬7000ç«¯å£</span><br><span class="line">root frps 67615 3 tcp46 *:7000 *:*</span><br><span class="line"># åœ¨å†…ç½‘çš„Proxy Serverç»è¿‡è·¯ç”±NATè½¬æ¢ä¹‹åçš„å…¬ç½‘IPä¸Proxy Serverè¿›è¡Œäº†è¿æ¥</span><br><span class="line">root frps 67615 11 tcp4 110.120.119.1:7000 119.120.110.1:61662</span><br><span class="line"># ç›‘å¬6000ç«¯å£ï¼ˆSSHæœåŠ¡ï¼‰</span><br><span class="line">root frps 67615 10 tcp46 *:6000 *:*</span><br><span class="line"># æ¥å—äº†å®¢æˆ·ç«¯çš„è¿æ¥</span><br><span class="line">root frps 67615 14 tcp4 110.120.119.1:6000 192.168.10.10:68623</span><br><span class="line"># ç›‘å¬1194ç«¯å£ï¼ˆOpenVPNæœåŠ¡ï¼‰</span><br><span class="line">root frps 67615 9 tcp46 *:1194 *:*</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Clientä¸Proxyå»ºç«‹è¿æ¥ï¼ŒReverse Proxyä¹Ÿä¸Proxyå»ºç«‹è¿æ¥ï¼Œé€šè¿‡è¿™ç§å›´é­æ•‘èµµçš„æ–¹å¼å®ç°Clientä¸Reverse Proxyå»ºç«‹è¿æ¥ã€‚</p><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨frpåå‘ä»£ç†openvpnçªç ´é˜²ç«å¢™çš„ä¸€ä¸ªdemoã€‚</p><h1 id="0-demoç¯å¢ƒ"><a href="#0-demoç¯å¢ƒ" class="headerlink" title="0. demoç¯å¢ƒ"></a>0. demoç¯å¢ƒ</h1><table><thead><tr><th>Host</th><th>OS</th><th>Service</th><th>IP</th><th>Allow Port (Inbound)</th></tr></thead><tbody><tr><td>Reverse Proxy Server</td><td>CentOS Linux release 8.4.2105</td><td>frpc (frp_0.38.0_linux_amd64), openvpn</td><td>P:172.16.10.10 (G:119.120.110.1)</td><td>&#x2F;</td></tr><tr><td>Proxy Server</td><td>FreeBSD 12.2-STABLE</td><td>frps (frp_0.38.0_freebsd_amd64)</td><td>110.120.119.1</td><td>#7000(from RPS) &amp; #6000(from client) &amp; #1194(from client)</td></tr><tr><td>Client</td><td>macOS</td><td>openvpn-client</td><td>192.168.10.10</td><td>&#x2F;</td></tr></tbody></table><p><em>OSåŸºæœ¬å¯ä»¥æ— è§†ï¼Œå› ä¸ºä¸ç®¡æ˜¯frpæˆ–è€…OpenVPNåŸºæœ¬å…¨å¹³å°é€‚é…</em></p><h1 id="1-éƒ¨ç½²Reverse-Proxy-Server"><a href="#1-éƒ¨ç½²Reverse-Proxy-Server" class="headerlink" title="1. éƒ¨ç½²Reverse Proxy Server"></a>1. éƒ¨ç½²Reverse Proxy Server</h1><p>åœ¨æƒ³è¦çªç ´çš„å†…ç½‘ç¯å¢ƒï¼ˆå…¬å¸ï¼Œå­¦æ ¡ï¼‰çš„æœºå™¨ä¸Šå®‰è£…å¿…è¦çš„frpï¼Œå’Œå…¶ä»–æœåŠ¡è¿™é‡Œç”¨openvpnæ¼”ç¤ºã€‚é˜²ç«å¢™ç­–ç•¥å…è®¸outboundã€‚</p><h2 id="1-1-éƒ¨ç½²frpc"><a href="#1-1-éƒ¨ç½²frpc" class="headerlink" title="1.1 éƒ¨ç½²frpc"></a>1.1 éƒ¨ç½²frpc</h2><p>ç›®å‰å¯ä»¥åœ¨ Github çš„ Release é¡µé¢ä¸­ä¸‹è½½åˆ°æœ€æ–°ç‰ˆæœ¬çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ <a href="https://github.com/fatedier/frp/releases/">https://github.com/fatedier/frp/releases/</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/fatedier/frp/releases/download/v0.38.0/frp_0.38.0_linux_amd64.tar.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="1-1-1-è§£å‹å®‰è£…åŒ…"><a href="#1-1-1-è§£å‹å®‰è£…åŒ…" class="headerlink" title="1.1.1 è§£å‹å®‰è£…åŒ…"></a>1.1.1 è§£å‹å®‰è£…åŒ…</h2><p>è§£å‹ç¼©ä¸‹è½½çš„å‹ç¼©åŒ…ï¼Œ æ”¾ç½®åœ¨ä»»æ„ç›®å½•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf frp_0.38.0_linux_amd64.tar.gz</span><br><span class="line">cd frp_0.38.0_linux_amd64</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œï¼ˆReverse Proxy Serverï¼‰ä¸Šåªç”¨åˆ°frpcç›¸å…³çš„æ–‡ä»¶ï¼Œfrpsç”¨ä¸åˆ°ã€‚</p></blockquote><h2 id="1-1-2-é…ç½®ä»¥åŠå¯åŠ¨æœåŠ¡"><a href="#1-1-2-é…ç½®ä»¥åŠå¯åŠ¨æœåŠ¡" class="headerlink" title="1.1.2 é…ç½®ä»¥åŠå¯åŠ¨æœåŠ¡"></a>1.1.2 é…ç½®ä»¥åŠå¯åŠ¨æœåŠ¡</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@ServerC /]# cat frpc.ini</span><br><span class="line">[common]</span><br><span class="line">server_addr = 110.120.119.1 # Proxy Serverçš„å…¬ç½‘IP</span><br><span class="line">server_port = 7000 # Proxy Serverä¸Šçš„frpsç›‘å¬frpcè¿æ¥çš„ç«¯å£</span><br><span class="line"></span><br><span class="line">[ssh]</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 127.0.0.1 # æŒ‡å‘æœ¬æœºIP</span><br><span class="line">local_port = 22 # æŒ‡å‘æœ¬æœºçš„SSHç«¯å£</span><br><span class="line">remote_port = 6000 # Proxy Serverç›‘å¬çš„ç«¯å£ã€‚ä¹‹åClientå¯ä»¥é€šè¿‡è®¿é—®Proxy Serverçš„6000ç«¯å£ï¼Œç«¯å£è½¬å‘åˆ°ä¸Šé¢çš„æœ¬æœºç«¯å£</span><br></pre></td></tr></table></figure><p>é€šè¿‡ <code> ./frpc -c ./frpc.ini &amp;</code> å¯åŠ¨æœåŠ¡ç«¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@cjl-docker frp_0.37.1_linux_amd64]# ./frpc -c ./frpc.ini</span><br><span class="line">2021/08/25 00:00:40 [I] [service.go:304] [a0e6112664ab2527] login to server success, get run id [a0e6112664ab2527], server udp port [0]</span><br><span class="line">2021/08/25 00:00:40 [I] [proxy_manager.go:144] [a0e6112664ab2527] proxy added: [ssh]</span><br><span class="line">2021/08/25 00:00:40 [I] [control.go:180] [a0e6112664ab2527] [ssh] start proxy success</span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦åœ¨åå°é•¿æœŸè¿è¡Œï¼Œå»ºè®®ç»“åˆå…¶ä»–å·¥å…·ä½¿ç”¨ï¼Œä¾‹å¦‚ systemd å’Œ supervisorã€‚</p><h2 id="1-1-3-éƒ¨ç½²openvpn"><a href="#1-1-3-éƒ¨ç½²openvpn" class="headerlink" title="1.1.3 éƒ¨ç½²openvpn"></a>1.1.3 éƒ¨ç½²openvpn</h2><p>è¿™é‡Œä¸åšæ¼”ç¤ºäº†ï¼Œè¯¦ç»†è¯·å‚é˜…æ­å»ºopenvpnæ•™ç¨‹ã€‚</p><blockquote><p><a href="https://www.gingerdoc.com/tutorials/how-to-set-up-and-configure-an-openvpn-server-on-centos-8">å¦‚ä½•åœ¨ CentOS 8 ä¸Šè®¾ç½®å’Œé…ç½® OpenVPN æœåŠ¡å™¨</a></p></blockquote><h1 id="2-æ­å»ºProxy-Server"><a href="#2-æ­å»ºProxy-Server" class="headerlink" title="2. æ­å»ºProxy Server"></a>2. æ­å»ºProxy Server</h1><p>åœ¨ç”¨æœ‰å…¬ç½‘IPçš„æœºå™¨å®‰è£…frpsæœåŠ¡ï¼Œè®¾å®šå¥½é˜²ç«å¢™ã€‚<br>è¿™é‡Œç”¨çš„æ˜¯FreeBSDï¼Œå…¬ç½‘IPä¸º110.120.119.1ï¼Œé˜²ç«å¢™ç­–ç•¥ä¸ºï¼šå…è®¸æ¥è‡ªReverse Proxy Serverå…¬ç½‘IPçš„è¿æ¥ï¼Œå’Œå…è®¸æ¥è‡ªClientçš„è¿æ¥ã€‚</p><h2 id="2-1-ä¸‹è½½å®‰è£…åŒ…"><a href="#2-1-ä¸‹è½½å®‰è£…åŒ…" class="headerlink" title="2.1 ä¸‹è½½å®‰è£…åŒ…"></a>2.1 ä¸‹è½½å®‰è£…åŒ…</h2><p>ç›®å‰å¯ä»¥åœ¨ Github çš„ Release é¡µé¢ä¸­ä¸‹è½½åˆ°æœ€æ–°ç‰ˆæœ¬çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ‰€æœ‰æ–‡ä»¶è¢«æ‰“åŒ…åœ¨ä¸€ä¸ªå‹ç¼©åŒ…ä¸­ã€‚ <a href="https://github.com/fatedier/frp/releases/tag/v0.37.1">https://github.com/fatedier/frp/releases/tag/v0.37.1</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/fatedier/frp/releases/download/v0.37.1/frp_0.37.1_linux_amd64.tar.gz</span><br></pre></td></tr></table></figure><h2 id="2-2-è§£å‹å®‰è£…åŒ…"><a href="#2-2-è§£å‹å®‰è£…åŒ…" class="headerlink" title="2.2 è§£å‹å®‰è£…åŒ…"></a>2.2 è§£å‹å®‰è£…åŒ…</h2><p>è§£å‹ç¼©ä¸‹è½½çš„å‹ç¼©åŒ…ï¼Œæ”¾ç½®åœ¨ä»»æ„ç›®å½•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf frp_0.37.1_linux_amd64.tar.gz</span><br></pre></td></tr></table></figure><blockquote><p>Proxyåªç”¨åˆ°frpsã€‚</p></blockquote><h2 id="2-3-é…ç½®æ–‡ä»¶ä»¥åŠå¯åŠ¨æœåŠ¡"><a href="#2-3-é…ç½®æ–‡ä»¶ä»¥åŠå¯åŠ¨æœåŠ¡" class="headerlink" title="2.3 é…ç½®æ–‡ä»¶ä»¥åŠå¯åŠ¨æœåŠ¡"></a>2.3 é…ç½®æ–‡ä»¶ä»¥åŠå¯åŠ¨æœåŠ¡</h2><p>ç¼–å†™é…ç½®æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat frp_0.37.1_linux_amd64/frps.ini</span><br><span class="line">---</span><br><span class="line">[common]</span><br><span class="line">bind_port = 7000</span><br></pre></td></tr></table></figure><p>é€šè¿‡ <code> ./frps -c ./frps.ini &amp;</code> å¯åŠ¨æœåŠ¡ç«¯ï¼Œä¹‹åå†é€šè¿‡ <code>ss -ntul</code> æŸ¥çœ‹æ˜¯å¦å¼€å¯ç›‘å¬7000ç«¯å£ã€‚å¦‚æœéœ€è¦åœ¨åå°é•¿æœŸè¿è¡Œï¼Œå»ºè®®ç»“åˆå…¶ä»–å·¥å…·ä½¿ç”¨ï¼Œä¾‹å¦‚ systemd å’Œ supervisorã€‚</p><h2 id="2-4-é…ç½®é˜²ç«å¢™"><a href="#2-4-é…ç½®é˜²ç«å¢™" class="headerlink" title="2.4 é…ç½®é˜²ç«å¢™"></a>2.4 é…ç½®é˜²ç«å¢™</h2><ul><li>ç­–ç•¥1ï¼šè®©Proxyçš„7000ç«¯å£æš´éœ²åœ¨å…¬ç½‘ä¸Šï¼Œæ‰èƒ½è®©Reverse Proxyç»è¡Œæ¡æ‰‹è¿æ¥ã€‚</li><li>ç­–ç•¥2ï¼š6000ç«¯å£è¦æš´éœ²ç»™Clientã€‚</li></ul><blockquote><p>å…·ä½“è®¾ç½®çš„è¯è¦æ ¹æ®æƒ…å†µä¸åŒï¼Œå¦‚æœProxyæˆ–è€…Clientä¹Ÿç»è¿‡NATï¼Œè·¯ç”±æˆ–è€…é˜²ç«å¢™çš„è¯ï¼Œé™¤äº†æœ¬æœºé˜²ç«ä¹‹å¤–ï¼Œè·¯ç”±å™¨çš„é˜²ç«å¢™ä¹Ÿè¦è®¾å®šã€‚</p></blockquote><h1 id="3-æµ‹è¯•ä»¥åŠä½¿ç”¨"><a href="#3-æµ‹è¯•ä»¥åŠä½¿ç”¨" class="headerlink" title="3. æµ‹è¯•ä»¥åŠä½¿ç”¨"></a>3. æµ‹è¯•ä»¥åŠä½¿ç”¨</h1><h2 id="3-1-å¼€å¯æœåŠ¡åè¿›è¡Œç«¯å£æ‰«æï¼š"><a href="#3-1-å¼€å¯æœåŠ¡åè¿›è¡Œç«¯å£æ‰«æï¼š" class="headerlink" title="3.1 å¼€å¯æœåŠ¡åè¿›è¡Œç«¯å£æ‰«æï¼š"></a>3.1 å¼€å¯æœåŠ¡åè¿›è¡Œç«¯å£æ‰«æï¼š</h2><p>å…ˆå¼€å¯frpsï¼Œå†å¼€å¯frpcã€‚å½“frpcè¿æ¥ä¸Šfrpsçš„æ—¶å€™ï¼Œfrpsçš„6000å·ç«¯å£æ‰ä¼šå¼€å¯äº†ç›‘å¬ã€‚</p><h3 id="æ–¹æ³•1"><a href="#æ–¹æ³•1" class="headerlink" title="æ–¹æ³•1"></a>æ–¹æ³•1</h3><p>åœ¨çº¿ç«¯å£æ‰«æ<br><a href="https://www.cman.jp/network/support/go_port.cgi">https://www.cman.jp/network/support/go_port.cgi</a></p><h3 id="æ–¹æ³•2"><a href="#æ–¹æ³•2" class="headerlink" title="æ–¹æ³•2"></a>æ–¹æ³•2</h3><p>é€šè¿‡nmapå·¥å…·ç«¯å£æ‰«æ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmap -p 7000 110.120.119.1</span><br><span class="line">nmap -p 6000 110.120.119.1</span><br></pre></td></tr></table></figure><h2 id="3-2-å¼€å§‹ä½¿ç”¨"><a href="#3-2-å¼€å§‹ä½¿ç”¨" class="headerlink" title="3.2 å¼€å§‹ä½¿ç”¨"></a>3.2 å¼€å§‹ä½¿ç”¨</h2><p>Server Aæˆ–è€…ä»»æ„è®¾å¤‡é€šè¿‡SSHè®¿é—®Server Bçš„6000ç«¯å£ï¼Œå³å¯è½¬å‘åˆ°Server Cçš„22ç«¯å£ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh 110.120.119.1 -p 6000</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å†…ç½‘æœåŠ¡å™¨ä¸Šéƒ¨ç½²frpcæœåŠ¡ï¼ˆå¯ä»¥è®¾ç½®ä¸ºsystemctlå¼€æœºè‡ªå¯ï¼‰ï¼Œä¸reverse proxyæœåŠ¡å™¨frpså»ºç«‹æ¡æ‰‹è¿æ¥ï¼Œé€šè¿‡SSHè®¿é—®frpsçš„ç«¯å£è½¬å‘ï¼Œæœ€ç»ˆè¾¾åˆ°è®¿é—®frpcæ‰€åœ¨æœåŠ¡å™¨çš„ç›®çš„ã€‚</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><blockquote></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨å­¦æ ¡æˆ–è€…å…¬å¸å¤–éƒ¨çš„ï¼Œæˆ–è€…å‡ºå·®åœ¨å¤–åœ°ï¼Œæƒ³è®¿é—®å­¦æ ¡æˆ–è€…å…¬å¸å†…ç½‘çš„æœåŠ¡å™¨ï¼Œä½†æ˜¯æ²¡ç”¨ç½‘ç»œç®¡ç†å‘˜çš„æƒé™ï¼Œæˆ–è€…ç½‘ç»œç®¡ç†å‘˜ä¸é…åˆè®¾å®šçš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•çªç ´N</summary>
      
    
    
    
    <category term="Network" scheme="https://kenryu.cc/ja/categories/Network/"/>
    
    
    <category term="linux" scheme="https://kenryu.cc/ja/tags/linux/"/>
    
    <category term="network" scheme="https://kenryu.cc/ja/tags/network/"/>
    
    <category term="vpn" scheme="https://kenryu.cc/ja/tags/vpn/"/>
    
  </entry>
  
  <entry>
    <title>SSL Certificates generation (On Linux use OpenSSL PKI)</title>
    <link href="https://kenryu.cc/ja/2021/10/28/Security/SSL_Certificates_generation__On_Linux_use_OpenSSL_PKI_/"/>
    <id>https://kenryu.cc/ja/2021/10/28/Security/SSL_Certificates_generation__On_Linux_use_OpenSSL_PKI_/</id>
    <published>2021-10-28T12:17:38.000Z</published>
    <updated>2022-06-30T13:52:05.000Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><img src="/resources/1fa2a2eab1bc40278d446a4d051bf8e7.png" alt="1449efa5e5facdd61663427a98e3a3a7.png"></p><h1 id="Definitons"><a href="#Definitons" class="headerlink" title="Definitons"></a>Definitons</h1><ul><li><p>PKI: Public Key Infrastructure<br>Security architecture where trust is conveyed through the signature of a trusted CA.</p></li><li><p>CA: Certificate Authority<br>Entity issuing certificates and CRLs.</p></li><li><p>TLS: ä¼ è¾“å±‚å®‰å…¨åè®® Transport Layer Securityçš„ç¼©å†™</p></li><li><p>SSL: å®‰å…¨å¥—æ¥å­—å±‚ Secure Socket Layerçš„ç¼©å†™</p></li><li><p>KEY: é€šå¸¸æŒ‡ç§é’¥Private keyã€‚</p></li><li><p>CSR: è¯ä¹¦ç­¾åè¯·æ±‚Certificate Signing Requestçš„ç¼©å†™ï¼Œå¯ä»¥ç®€å•ç†è§£æˆå…¬é’¥ï¼Œç”Ÿæˆè¯ä¹¦æ—¶è¦æŠŠè¿™ä¸ªæäº¤ç»™æƒå¨çš„è¯ä¹¦é¢å‘æœºæ„ã€‚</p></li><li><p>CRT: è¯ä¹¦Certificateçš„ç¼©å†™</p></li><li><p>CRL: è¯ä¹¦åŠé”€åˆ—è¡¨ Certificate Revocation Listsçš„ç¼©å†™ã€‚</p></li><li><p>X.509: æ˜¯ä¸€ç§è¯ä¹¦æ ¼å¼ã€‚<br>å¯¹X.509è¯ä¹¦æ¥è¯´ï¼Œè®¤è¯è€…æ€»æ˜¯CAæˆ–ç”±CAæŒ‡å®šçš„äººï¼Œä¸€ä»½X.509è¯ä¹¦æ˜¯ä¸€äº›æ ‡å‡†å­—æ®µçš„é›†åˆï¼Œè¿™äº›å­—æ®µåŒ…å«æœ‰å…³ç”¨æˆ·æˆ–è®¾å¤‡åŠå…¶ç›¸åº”å…¬é’¥çš„ä¿¡æ¯ã€‚<br>X.509çš„è¯ä¹¦æ–‡ä»¶ï¼Œä¸€èˆ¬ä»¥.crtç»“å°¾ï¼Œæ ¹æ®è¯¥æ–‡ä»¶çš„å†…å®¹ç¼–ç æ ¼å¼ï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹äºŒç§æ ¼å¼ï¼š</p></li></ul><p>t- PEM (Privacy Enhanced Mail)æ–‡æœ¬æ ¼å¼,ä»¥â€â€”BEGINâ€”â€œå¼€å¤´, â€œâ€”ENDâ€”â€œç»“å°¾,å†…å®¹æ˜¯BASE64ç¼–ç ã€‚Apacheå’ŒNginxæœåŠ¡å™¨åå‘äºä½¿ç”¨è¿™ç§ç¼–ç æ ¼å¼.</p><p>t- DER (Distinguished Encoding Rules)äºŒè¿›åˆ¶æ ¼å¼,ä¸å¯è¯».Javaå’ŒWindowsæœåŠ¡å™¨åå‘äºä½¿ç”¨è¿™ç§ç¼–ç æ ¼å¼</p><p>OpenSSL ç›¸å½“äºSSLçš„ä¸€ä¸ªå®ç°ï¼Œå¦‚æœæŠŠSSLè§„èŒƒçœ‹æˆOOä¸­çš„æ¥å£ï¼Œé‚£ä¹ˆOpenSSLåˆ™è®¤ä¸ºæ˜¯æ¥å£çš„å®ç°ã€‚æ¥å£è§„èŒƒæœ¬èº«æ˜¯å®‰å…¨æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯å…·ä½“å®ç°å¯èƒ½ä¼šæœ‰ä¸å®Œå–„çš„åœ°æ–¹ï¼Œæ¯”å¦‚ä¹‹å‰çš„â€å¿ƒè„å‡ºè¡€â€æ¼æ´ï¼Œå°±æ˜¯OpenSSLä¸­çš„ä¸€ä¸ªbug.</p><h1 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h1><ul><li>You have set up OpenSSL on your machine.</li><li>You have established a process to sign trusted certificates. If you want to have the certificates signed by a certification authority, you have either established your own certification authority or you use an external certification authority. Alternatively, you can sign the generated certificate yourself.</li></ul><h1 id="Procedure"><a href="#Procedure" class="headerlink" title="Procedure"></a>Procedure</h1><h2 id="0-Edit-OpenSSL-conf-file"><a href="#0-Edit-OpenSSL-conf-file" class="headerlink" title="0. Edit OpenSSL conf file"></a>0. Edit OpenSSL <code>conf</code> file</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/pki/tls/</span><br><span class="line">cp openssl.cnf_org ca.conf</span><br><span class="line">vim ca.conf</span><br><span class="line"></span><br><span class="line">[ ca ]</span><br><span class="line">default_ca = CA_default #56è¡Œã€ä½•ã‚‚å¤‰ã‚ã‚‰ãªã‹ã£ãŸ</span><br><span class="line"></span><br><span class="line">[ CA_default ]</span><br><span class="line">...</span><br><span class="line">x509_extensions = usr_cert #76è¡Œã€ä½•ã‚‚å¤‰ã‚ã‚‰ãªã‹ã£ãŸ</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[ req ] #123è¡Œã‹ã‚‰</span><br><span class="line">default_bits = 2048</span><br><span class="line"># 125 default_md = sha256 #ã“ã®è¡Œã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ</span><br><span class="line">default_keyfile = privkey.pem</span><br><span class="line">distinguished_name = req_distinguished_name</span><br><span class="line">attributes = req_attributes</span><br><span class="line">x509_extensions = v3_ca</span><br><span class="line">req_extensions = v3_req #130ã“ã®è¡Œã‚’è¿½è¨˜</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[ usr_cert ]</span><br><span class="line">191 basicConstraints=CA:FALSE #ã‚³ãƒ¡ãƒ³ãƒˆã‚¤ãƒ³</span><br><span class="line">192 #basicConstraints=CA:TRUE #ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ</span><br><span class="line"></span><br><span class="line">nsComment = &quot;OpenSSL Generated Certificate&quot; #212è¡Œã€ä½•ã‚‚å¤‰ã‚ã‚‰ãªã‹ã£ãŸ</span><br><span class="line"></span><br><span class="line">subjectKeyIdentifier = hash</span><br><span class="line">authorityKeyIdentifier=keyid,issuer:always #217è¡Œã€æœ€å¾Œã®`:always`ã‚’è¿½è¨˜</span><br><span class="line">subjectAltName = @alt_names #218è¡Œè¿½è¨˜</span><br><span class="line"></span><br><span class="line">[ v3_req ]</span><br><span class="line">basicConstraints = CA:FALSE #244è¡Œã€ä½•ã‚‚å¤‰ã‚ã‚‰ãªã‹ã£ãŸ</span><br><span class="line">keyUsage = nonRepudiation, digitalSignature, keyEncipherment #245è¡Œã€ä½•ã‚‚å¤‰ã‚ã‚‰ãªã‹ã£ãŸ</span><br><span class="line">subjectAltName = @alt_names #246è¡Œã€è¿½è¨˜</span><br><span class="line"></span><br><span class="line">[alt_names] #ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯å…ƒã€…å­˜åœ¨ã›ãšè¿½è¨˜ã™ã‚‹ã‚‚ã®</span><br><span class="line">DNS.1 = example.com</span><br><span class="line">DNS.2 = *.example.com</span><br><span class="line">IP.1 = 192.168.0.1</span><br><span class="line">IP.2 = 192.168.0.2</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>CSRã‚’ä½œã‚‹éš›</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[req] req_extensions = v3_req</span><br><span class="line">â†“</span><br><span class="line">[v3_req] subjectAltName = @alt_names</span><br><span class="line">â†“</span><br><span class="line">[alt_names]</span><br><span class="line">DNS.1 = ã‚µãƒ¼ãƒã®ãƒ‰ãƒ¡ã‚¤ãƒ³å</span><br><span class="line">IP.1 = ã‚µãƒ¼ãƒã®IPã‚¢ãƒ‰ãƒ¬ã‚¹</span><br></pre></td></tr></table></figure><p>ã¨ã„ã£ãŸæµã‚Œã§å‚ç…§ã—ã¾ã™ã€‚ã“ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ -config ã§æŒ‡å®šã—ã¦ CSR ã‚’ä½œã‚‹ã¨ã€CSR ã« X509v3 Subject Alternative Name:ã‚¨ãƒ³ãƒˆãƒªãŒå…¥ã‚Šã¾ã™ã€‚</p><h2 id="1-Generate-Private-Key-amp-CSR"><a href="#1-Generate-Private-Key-amp-CSR" class="headerlink" title="1. Generate Private Key &amp; CSR"></a>1. Generate Private Key &amp; CSR</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -newkey rsa:2048 -nodes -sha256 \</span><br><span class="line">-subj &quot;/C=JP/ST=Saitama/L=Toda/O=Core Micro Systems, Inc./CN=cmsinc.co.jp/emailAddress=cjl@kensho.toda&quot; \</span><br><span class="line">-config server.conf \</span><br><span class="line">-keyout server.key \</span><br><span class="line">-out server.csr</span><br></pre></td></tr></table></figure><p>View CSR details</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -noout -text -in /etc/pki/tls/server.csr</span><br></pre></td></tr></table></figure><h2 id="2-Signing"><a href="#2-Signing" class="headerlink" title="2. Signing"></a>2. Signing</h2><ul><li>Submit the CSR to the certification authority.</li><li>Alternatively, sign the certificate yourself.</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">openssl ca -batch \</span><br><span class="line">-keyfile /etc/pki/CA/private/cakey.pem \</span><br><span class="line">-days 365 \</span><br><span class="line">-config ca.conf \</span><br><span class="line">-in server.csr \</span><br><span class="line">-out server.crt</span><br></pre></td></tr></table></figure><p>View Certificateâ€™s details</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -text -noout -in server.crt</span><br></pre></td></tr></table></figure><h1 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h1><h2 id="File-Convert"><a href="#File-Convert" class="headerlink" title="File Convert"></a>File Convert</h2><h3 id="1-Certificate"><a href="#1-Certificate" class="headerlink" title="1. Certificate"></a>1. Certificate</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -in kvm-bmc.crt -out kvm-bmc.pem</span><br></pre></td></tr></table></figure><h3 id="2-Key"><a href="#2-Key" class="headerlink" title="2. Key"></a>2. Key</h3><p>Public key or Private key</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl rsa -in kvm-bmc.key -out kvm-bmc-private.pem</span><br></pre></td></tr></table></figure><h2 id="CAã§ç™ºè¡Œã—ãŸã‚µãƒ¼ãƒè¨¼æ˜æ›¸ã‚’å¤±åŠ¹ã«ã™ã‚‹æ–¹æ³•"><a href="#CAã§ç™ºè¡Œã—ãŸã‚µãƒ¼ãƒè¨¼æ˜æ›¸ã‚’å¤±åŠ¹ã«ã™ã‚‹æ–¹æ³•" class="headerlink" title="CAã§ç™ºè¡Œã—ãŸã‚µãƒ¼ãƒè¨¼æ˜æ›¸ã‚’å¤±åŠ¹ã«ã™ã‚‹æ–¹æ³•"></a>CAã§ç™ºè¡Œã—ãŸã‚µãƒ¼ãƒè¨¼æ˜æ›¸ã‚’å¤±åŠ¹ã«ã™ã‚‹æ–¹æ³•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl ca -revoke /etc/pki/CA/newcerts/xxx.pem #replacing the serial number</span><br></pre></td></tr></table></figure><h2 id="Trouble-Shooting"><a href="#Trouble-Shooting" class="headerlink" title="Trouble Shooting"></a>Trouble Shooting</h2><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><blockquote><ol><li><a href="https://www.digitalocean.com/community/tutorials/openssl-essentials-working-with-ssl-certificates-private-keys-and-csrs">OpenSSL Essentials: Working with SSL Certificates, Private Keys and CSRs</a></li><li><a href="https://tech.torico-corp.com/blog/chrome58-https-ssl-cert-san-error/">Chrome58ã§ã€HTTPSã®è‡ªå·±è¨¼æ˜æ›¸ãŒNET::ERR_CERT_COMMON_NAME_INVALID ã«ãªã‚‹å ´åˆã®å¯¾å¿œ</a></li><li><a href="https://pki-tutorial.readthedocs.io/en/latest/#">OpenSSL PKI Tutorial </a></li><li><a href="https://www.golinuxcloud.com/tutorial-pki-certificates-authority-ocsp/">OpenSSL Certificate Manager</a></li></ol></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;h1 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/resour</summary>
      
    
    
    
    <category term="Security" scheme="https://kenryu.cc/ja/categories/Security/"/>
    
    
  </entry>
  
  <entry>
    <title>Redmineæ­å»ºï¼ˆPostgreSQL+Apacheç‰ˆï¼‰</title>
    <link href="https://kenryu.cc/ja/2021/10/27/Redmine/Redmine%E6%90%AD%E5%BB%BA%EF%BC%88PostgreSQL+Apache%E7%89%88%EF%BC%89/"/>
    <id>https://kenryu.cc/ja/2021/10/27/Redmine/Redmine%E6%90%AD%E5%BB%BA%EF%BC%88PostgreSQL+Apache%E7%89%88%EF%BC%89/</id>
    <published>2021-10-27T07:41:47.000Z</published>
    <updated>2022-06-30T13:52:05.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0-ç¯å¢ƒè¯´æ˜"><a href="#0-ç¯å¢ƒè¯´æ˜" class="headerlink" title="0. ç¯å¢ƒè¯´æ˜"></a>0. ç¯å¢ƒè¯´æ˜</h1><h3 id="Redmineéœ€è¦çš„ç¯å¢ƒï¼š"><a href="#Redmineéœ€è¦çš„ç¯å¢ƒï¼š" class="headerlink" title="Redmineéœ€è¦çš„ç¯å¢ƒï¼š"></a>Redmineéœ€è¦çš„ç¯å¢ƒï¼š</h3><ul><li>èƒ½è¿è¡ŒRubyçš„OS</li><li>æ•°æ®åº“ï¼ˆMySQL &#x2F; PostgreSQL &#x2F; SQLite &#x2F; SQLæœåŠ¡å™¨ï¼‰</li><li>ç½‘ç«™æœåŠ¡ï¼ˆApache &#x2F; Nginx ï¼‰</li></ul><h3 id="æœ¬æ¬¡æ­å»ºç¯å¢ƒï¼š"><a href="#æœ¬æ¬¡æ­å»ºç¯å¢ƒï¼š" class="headerlink" title="æœ¬æ¬¡æ­å»ºç¯å¢ƒï¼š"></a>æœ¬æ¬¡æ­å»ºç¯å¢ƒï¼š</h3><table><thead><tr><th>Software</th><th>Version</th><th>Command</th></tr></thead><tbody><tr><td>OS</td><td>CentOS Linux release 8.4.2105</td><td>cat &#x2F;etc&#x2F;os-release &#x2F;etc&#x2F;redhat-release &#x2F;etc&#x2F;system-release</td></tr><tr><td>Redmine</td><td>4.2.3</td><td></td></tr><tr><td>Postgresql</td><td>postgres (PostgreSQL) 10.17</td><td>postgres -V</td></tr><tr><td>Ruby</td><td>ruby 2.5.9p229 (2021-04-05 revision 67939) [x86_64-linux]</td><td>ruby -v</td></tr><tr><td>Apache</td><td>Apache&#x2F;2.4.37 (centos)</td><td>apachectl -v</td></tr></tbody></table><h1 id="1-ä¸‹è½½éœ€è¦çš„è½¯ä»¶åŒ…"><a href="#1-ä¸‹è½½éœ€è¦çš„è½¯ä»¶åŒ…" class="headerlink" title="1. ä¸‹è½½éœ€è¦çš„è½¯ä»¶åŒ…"></a>1. ä¸‹è½½éœ€è¦çš„è½¯ä»¶åŒ…</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dnf -y update</span><br><span class="line">dnf -y groupinstall &quot;Development Tools&quot;</span><br><span class="line">dnf -y install vim wget tar openssl* httpd httpd-devel ruby ruby-devel libcurl-devel</span><br></pre></td></tr></table></figure><h1 id="2-å®‰è£…æ•°æ®åº“"><a href="#2-å®‰è£…æ•°æ®åº“" class="headerlink" title="2. å®‰è£…æ•°æ®åº“"></a>2. å®‰è£…æ•°æ®åº“</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dnf -y install postgresql-server postgresql-devel</span><br><span class="line">rpm -qa | grep postgresql</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">postgresql-setup initdb</span><br></pre></td></tr></table></figure><p>å¼€æœºè‡ªåŠ¨å¯åŠ¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable --now postgresql</span><br><span class="line">systemctl status postgresql</span><br></pre></td></tr></table></figure><p>åˆ›å»ºredmineç”¨æˆ·ä»¥åŠredmineæ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# su - postgres</span><br><span class="line">[postgres@localhost ~]$ psql</span><br><span class="line">CREATE ROLE redmine LOGIN ENCRYPTED PASSWORD &#x27;Your_Password&#x27; NOINHERIT VALID UNTIL &#x27;infinity&#x27;;</span><br><span class="line">CREATE DATABASE redmine WITH ENCODING=&#x27;UTF8&#x27; OWNER=redmine;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">\du #æŸ¥çœ‹ç”¨æˆ·</span><br><span class="line">\l #æŸ¥çœ‹æ•°æ®åº“</span><br><span class="line">\q #é€€å‡º</span><br></pre></td></tr></table></figure><p>ç¼–è¾‘pg_hba.confæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /var/lib/pgsql/data/pg_hba.conf</span><br><span class="line"># configuration parameter, or via the -i or -h command line switches.</span><br><span class="line"></span><br><span class="line">host redmine redmine 127.0.0.1/32 md5</span><br><span class="line">host redmine redmine ::1/128 md5</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š<br>æ·»åŠ çš„è§„åˆ™æ”¾åœ¨73è¡Œçš„: configuration parameterâ€¦ä¸‹é¢ã€‚å¦åˆ™ä¼šå‡ºç°<code>psql: FATAL: Ident authentication failed for user &quot;postgres&quot;</code> çš„é”™è¯¯è€Œä¸”æ— æ³•è®¿é—®æ•°æ®åº“çš„é—®é¢˜ã€‚</p></blockquote><p>é‡å¯æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart postgresql</span><br></pre></td></tr></table></figure><p>éªŒè¯çœ‹çœ‹èƒ½ä¸èƒ½æ­£å¸¸è®¿é—®æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">psql -U redmine -d redmine -h 127.0.0.1</span><br><span class="line">Password for user redmine: #â†æ­£å¸¸æƒ…å†µä¸‹ä¼šæç¤ºè¾“å…¥å¯†ç </span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="3-å…³é—­Selinux"><a href="#3-å…³é—­Selinux" class="headerlink" title="3. å…³é—­Selinux"></a>3. å…³é—­Selinux</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/selinux/config</span><br><span class="line">#SELINUX=enforcing</span><br><span class="line"></span><br><span class="line">SELINUX=disabled</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br><span class="line">getenforce # ç¡®è®¤ç»“æœ</span><br></pre></td></tr></table></figure><h1 id="4-ä¸‹è½½å®‰è£…Redmine"><a href="#4-ä¸‹è½½å®‰è£…Redmine" class="headerlink" title="4. ä¸‹è½½å®‰è£…Redmine"></a>4. ä¸‹è½½å®‰è£…Redmine</h1><blockquote><p>è·å–æœ€æ–°ç‰ˆæœ¬:<br><a href="https://www.redmine.org/projects/redmine/wiki/Download">Redmineå®˜æ–¹ä¸‹è½½åœ°å€</a></p></blockquote><h2 id="4-1-ä¸‹è½½ä»¥åŠè§£å‹"><a href="#4-1-ä¸‹è½½ä»¥åŠè§£å‹" class="headerlink" title="4.1. ä¸‹è½½ä»¥åŠè§£å‹"></a>4.1. ä¸‹è½½ä»¥åŠè§£å‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.redmine.org/releases/redmine-4.2.3.tar.gz</span><br><span class="line">tar -zxvf redmine-4.2.3.tar.gz</span><br><span class="line">mv redmine-4.2.3 /redmine</span><br></pre></td></tr></table></figure><h2 id="4-2-é…ç½®database-ymlæ–‡ä»¶"><a href="#4-2-é…ç½®database-ymlæ–‡ä»¶" class="headerlink" title="4.2. é…ç½®database.ymlæ–‡ä»¶"></a>4.2. é…ç½®database.ymlæ–‡ä»¶</h2><p>æ ¹æ®æ•°æ®åº“è®¾ç½®ï¼Œé…ç½®Redmineçš„è¿æ¥æ•°æ®åº“è®¾å®šæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cd /redmine/config/</span><br><span class="line">cp database.yml.example database.yml</span><br><span class="line">vim database.yml</span><br><span class="line"></span><br><span class="line">###postgresql</span><br><span class="line">production:</span><br><span class="line">adapter: postgresql</span><br><span class="line">database: redmine</span><br><span class="line">host: localhost</span><br><span class="line">username: redmine</span><br><span class="line">password: &quot;Your_Password&quot;</span><br><span class="line">encoding: utf8</span><br><span class="line">t#pool: 5</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š<br>è¦æŠŠdevelopmentï¼Œtestç­‰åŒºåŸŸç»™åˆ äº†<br>æ’ç‰ˆç¼©è¿›è¦æ­£ç¡®ï¼</p></blockquote><h2 id="4-3-é€šè¿‡Rubyéƒ¨ç½²"><a href="#4-3-é€šè¿‡Rubyéƒ¨ç½²" class="headerlink" title="4.3. é€šè¿‡Rubyéƒ¨ç½²"></a>4.3. é€šè¿‡Rubyéƒ¨ç½²</h2><p>æˆ‘å¯¹Rubyä¸äº†è§£ï¼Œè¿™äº›å‘½ä»¤ä¸æ˜¯å¾ˆæ‡‚ï¼Œä¼¼ä¹å¯ä»¥è‡ªåŠ¨å¯¼å…¥ Redmine æ“ä½œæ‰€éœ€çš„ Ruby è½¯ä»¶åŒ…ï¼Œä¸º MySQL æ•°æ®åº“åˆ›å»ºæ‰€éœ€çš„è¡¨æˆ–åŠ è½½é»˜è®¤æ•°æ®ï¼Ÿæ³¨æ„ä¸èƒ½å¿˜äº†ï¼Œåœ¨æ‰§è¡Œæ“ä½œå‰ç§»åŠ¨åˆ°Redmineç›®å½•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /redmine</span><br><span class="line">gem install bundler --no-rdoc --no-ri</span><br><span class="line">gem install bundler</span><br><span class="line">bundle install --without development test rmagick</span><br><span class="line">bundle exec rake generate_secret_token</span><br><span class="line">RAILS_ENV=production bundle exec rake db:migrate</span><br><span class="line">RAILS_ENV=production bundle exec rake redmine:load_default_data</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæœ€åä¸€è¡Œçš„æ—¶å€™é€‰æ‹©æƒ³è¦çš„è¯­è¨€ã€‚</p><h1 id="5-é…ç½®Apache"><a href="#5-é…ç½®Apache" class="headerlink" title="5. é…ç½®Apache"></a>5. é…ç½®Apache</h1><h2 id="5-1-å®‰è£…passenger"><a href="#5-1-å®‰è£…passenger" class="headerlink" title="5.1. å®‰è£…passenger"></a>5.1. å®‰è£…passenger</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gem install passenger</span><br><span class="line">passenger-install-apache2-module --auto --languages ruby</span><br></pre></td></tr></table></figure><p>æœ‰å¤§é‡çš„æ—¥å¿—åœ¨ç”»é¢ä¸Šæ»šåŠ¨ï¼Œéœ€è¦èŠ±ä¸€ç‚¹æ—¶é—´ã€‚è™½ç„¶æœ‰å¾ˆå¤šè­¦å‘Šï¼Œä½†æ˜¯å¦‚æœä¸å› é”™è¯¯è€Œæ‰è½çš„è¯åº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜ã€‚</p><h2 id="5-2-å®‰è£…snippet"><a href="#5-2-å®‰è£…snippet" class="headerlink" title="5.2. å®‰è£…snippet"></a>5.2. å®‰è£…snippet</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost redmine]# passenger-install-apache2-module --snippet</span><br><span class="line">LoadModule passenger_module /usr/local/share/gems/gems/passenger-6.0.11/buildout/apache2/mod_passenger.so</span><br><span class="line">&lt;IfModule mod_passenger.c&gt;</span><br><span class="line">PassengerRoot /usr/local/share/gems/gems/passenger-6.0.11</span><br><span class="line">PassengerDefaultRuby /usr/bin/ruby</span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure><h2 id="5-3-è®¾ç½®Redmineä¸ºApacheçš„æ ¹ç›®å½•ï¼Œå¹¶æŠŠä¸Šä¸€æ­¥5-2çš„ç»“æœå¤åˆ¶ä¸‹æ¥ç²˜è´´åˆ°redmine-confæ–‡ä»¶ä¸­"><a href="#5-3-è®¾ç½®Redmineä¸ºApacheçš„æ ¹ç›®å½•ï¼Œå¹¶æŠŠä¸Šä¸€æ­¥5-2çš„ç»“æœå¤åˆ¶ä¸‹æ¥ç²˜è´´åˆ°redmine-confæ–‡ä»¶ä¸­" class="headerlink" title="5.3. è®¾ç½®Redmineä¸ºApacheçš„æ ¹ç›®å½•ï¼Œå¹¶æŠŠä¸Šä¸€æ­¥5.2çš„ç»“æœå¤åˆ¶ä¸‹æ¥ç²˜è´´åˆ°redmine.confæ–‡ä»¶ä¸­"></a>5.3. è®¾ç½®Redmineä¸ºApacheçš„æ ¹ç›®å½•ï¼Œå¹¶æŠŠä¸Šä¸€æ­¥5.2çš„ç»“æœå¤åˆ¶ä¸‹æ¥ç²˜è´´åˆ°redmine.confæ–‡ä»¶ä¸­</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf.d/redmine.conf</span><br><span class="line"></span><br><span class="line">&lt;Directory &quot;/redmine/public&quot;&gt;</span><br><span class="line">Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">LoadModule passenger_module /usr/local/share/gems/gems/passenger-6.0.11/buildout/apache2/mod_passenger.so</span><br><span class="line">&lt;IfModule mod_passenger.c&gt;</span><br><span class="line">PassengerRoot /usr/local/share/gems/gems/passenger-6.0.11</span><br><span class="line">PassengerDefaultRuby /usr/bin/ruby</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="5-4"><a href="#5-4" class="headerlink" title="5.4."></a>5.4.</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf/httpd.conf</span><br><span class="line"></span><br><span class="line">DocumentRoot &quot;/redmine/public&quot;</span><br></pre></td></tr></table></figure><h2 id="5-5-ç»™Apacheæƒé™"><a href="#5-5-ç»™Apacheæƒé™" class="headerlink" title="5.5. ç»™Apacheæƒé™"></a>5.5. ç»™Apacheæƒé™</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R apache:apache /redmine</span><br></pre></td></tr></table></figure><h2 id="5-6-é‡å¯Apache"><a href="#5-6-é‡å¯Apache" class="headerlink" title="5.6. é‡å¯Apache"></a>5.6. é‡å¯Apache</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable httpd</span><br><span class="line">systemctl start httpd</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="6-é˜²ç«å¢™"><a href="#6-é˜²ç«å¢™" class="headerlink" title="6. é˜²ç«å¢™"></a>6. é˜²ç«å¢™</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --permanent --add-service=http</span><br><span class="line">firewall-cmd --zone=public --permanent --add-service=https</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><h1 id="7-æ’é”™"><a href="#7-æ’é”™" class="headerlink" title="7. æ’é”™"></a>7. æ’é”™</h1><h2 id="7-1-åˆ é™¤PostgreSQLæ•°æ®åº“ä»¥åŠç”¨æˆ·"><a href="#7-1-åˆ é™¤PostgreSQLæ•°æ®åº“ä»¥åŠç”¨æˆ·" class="headerlink" title="7.1. åˆ é™¤PostgreSQLæ•°æ®åº“ä»¥åŠç”¨æˆ·"></a>7.1. åˆ é™¤PostgreSQLæ•°æ®åº“ä»¥åŠç”¨æˆ·</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# su - postgres</span><br><span class="line">[postgres@localhost ~]$ psql</span><br><span class="line">drop database redmine;</span><br><span class="line">drop role redmine;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">\du #æŸ¥çœ‹ç”¨æˆ·</span><br><span class="line">\l #æŸ¥çœ‹æ•°æ®åº“</span><br><span class="line">\q #é€€å‡º</span><br></pre></td></tr></table></figure><blockquote><p>å‚è€ƒï¼š<br><a href="https://www.redmine.org/projects/redmine/wiki/redmineinstall">Redmineå®˜æ–¹å®‰è£…æ•™ç¨‹</a><br><a href="https://chiritsumon.net/contents/archives/2072">CentOS8ã«Redmine4.1ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</a><br><a href="https://cloud.tencent.com/developer/article/1626834">å¦‚ä½•åœ¨ CentOS 8 ä¸Šå®‰è£… Postgresql</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0-ç¯å¢ƒè¯´æ˜&quot;&gt;&lt;a href=&quot;#0-ç¯å¢ƒè¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;0. ç¯å¢ƒè¯´æ˜&quot;&gt;&lt;/a&gt;0. ç¯å¢ƒè¯´æ˜&lt;/h1&gt;&lt;h3 id=&quot;Redmineéœ€è¦çš„ç¯å¢ƒï¼š&quot;&gt;&lt;a href=&quot;#Redmineéœ€è¦çš„ç¯å¢ƒï¼š&quot; class=&quot;</summary>
      
    
    
    
    <category term="Redmine" scheme="https://kenryu.cc/ja/categories/Redmine/"/>
    
    
  </entry>
  
  <entry>
    <title>Redmineæ­å»ºï¼ˆMySQL+Apacheç‰ˆï¼‰</title>
    <link href="https://kenryu.cc/ja/2021/10/26/Redmine/Redmine%E6%90%AD%E5%BB%BA%EF%BC%88MySQL_Apache%E7%89%88%EF%BC%89/"/>
    <id>https://kenryu.cc/ja/2021/10/26/Redmine/Redmine%E6%90%AD%E5%BB%BA%EF%BC%88MySQL_Apache%E7%89%88%EF%BC%89/</id>
    <published>2021-10-26T06:42:55.000Z</published>
    <updated>2022-06-30T13:52:05.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0-ç¯å¢ƒè¯´æ˜"><a href="#0-ç¯å¢ƒè¯´æ˜" class="headerlink" title="0. ç¯å¢ƒè¯´æ˜"></a>0. ç¯å¢ƒè¯´æ˜</h1><h3 id="Redmineéœ€è¦çš„ç¯å¢ƒï¼š"><a href="#Redmineéœ€è¦çš„ç¯å¢ƒï¼š" class="headerlink" title="Redmineéœ€è¦çš„ç¯å¢ƒï¼š"></a>Redmineéœ€è¦çš„ç¯å¢ƒï¼š</h3><ul><li>èƒ½è¿è¡ŒRubyçš„OS</li><li>æ•°æ®åº“ï¼ˆMySQL &#x2F; PostgreSQL &#x2F; SQLite &#x2F; SQLæœåŠ¡å™¨ï¼‰</li><li>ç½‘ç«™æœåŠ¡ï¼ˆApache &#x2F; Nginx ï¼‰</li></ul><h3 id="æœ¬æ¬¡æ­å»ºç¯å¢ƒï¼š"><a href="#æœ¬æ¬¡æ­å»ºç¯å¢ƒï¼š" class="headerlink" title="æœ¬æ¬¡æ­å»ºç¯å¢ƒï¼š"></a>æœ¬æ¬¡æ­å»ºç¯å¢ƒï¼š</h3><table><thead><tr><th>Software</th><th>Version</th><th>Command</th></tr></thead><tbody><tr><td>OS</td><td>CentOS Linux release 8.4.2105</td><td>cat &#x2F;etc&#x2F;os-release &#x2F;etc&#x2F;redhat-release &#x2F;etc&#x2F;system-release</td></tr><tr><td>Redmine</td><td>4.2.3</td><td></td></tr><tr><td>MySQL</td><td>Ver 14.14 Distrib 5.7.36, for Linux (x86_64) using EditLine wrapper</td><td>mysql â€“version</td></tr><tr><td>MySQL</td><td>mysql Ver 8.0.26 for Linux on x86_64 (Source distribution)</td><td>mysql â€“version</td></tr><tr><td>Ruby</td><td>ruby 2.5.9p229 (2021-04-05 revision 67939) [x86_64-linux]</td><td>ruby -v</td></tr><tr><td>Apache</td><td>Apache&#x2F;2.4.37 (centos)</td><td>apachectl -v</td></tr></tbody></table><h1 id="1-ä¸‹è½½éœ€è¦çš„è½¯ä»¶åŒ…"><a href="#1-ä¸‹è½½éœ€è¦çš„è½¯ä»¶åŒ…" class="headerlink" title="1. ä¸‹è½½éœ€è¦çš„è½¯ä»¶åŒ…"></a>1. ä¸‹è½½éœ€è¦çš„è½¯ä»¶åŒ…</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dnf -y update</span><br><span class="line">dnf -y groupinstall &quot;Development Tools&quot;</span><br><span class="line">dnf -y install vim wget tar openssl* httpd httpd-devel ruby ruby-devel libcurl-devel</span><br></pre></td></tr></table></figure><h1 id="2-å®‰è£…æ•°æ®åº“"><a href="#2-å®‰è£…æ•°æ®åº“" class="headerlink" title="2. å®‰è£…æ•°æ®åº“"></a>2. å®‰è£…æ•°æ®åº“</h1><h2 id="ï¼ˆé€‰é¡¹1ï¼‰2-1-å®‰è£…æœ€æ–°ç‰ˆçš„Mysqlæ•°æ®åº“ï¼ˆ8-0-26ï¼‰"><a href="#ï¼ˆé€‰é¡¹1ï¼‰2-1-å®‰è£…æœ€æ–°ç‰ˆçš„Mysqlæ•°æ®åº“ï¼ˆ8-0-26ï¼‰" class="headerlink" title="ï¼ˆé€‰é¡¹1ï¼‰2.1. å®‰è£…æœ€æ–°ç‰ˆçš„Mysqlæ•°æ®åº“ï¼ˆ8.0.26ï¼‰"></a>ï¼ˆé€‰é¡¹1ï¼‰2.1. å®‰è£…æœ€æ–°ç‰ˆçš„Mysqlæ•°æ®åº“ï¼ˆ8.0.26ï¼‰</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dnf -y install mysql-server mysql-devel</span><br></pre></td></tr></table></figure><h2 id="ï¼ˆé€‰é¡¹2ï¼‰2-2-å®‰è£…æ—§ç‰ˆçš„Mysqlæ•°æ®åº“ï¼ˆ5-7-36ï¼‰"><a href="#ï¼ˆé€‰é¡¹2ï¼‰2-2-å®‰è£…æ—§ç‰ˆçš„Mysqlæ•°æ®åº“ï¼ˆ5-7-36ï¼‰" class="headerlink" title="ï¼ˆé€‰é¡¹2ï¼‰2.2. å®‰è£…æ—§ç‰ˆçš„Mysqlæ•°æ®åº“ï¼ˆ5.7.36ï¼‰"></a>ï¼ˆé€‰é¡¹2ï¼‰2.2. å®‰è£…æ—§ç‰ˆçš„Mysqlæ•°æ®åº“ï¼ˆ5.7.36ï¼‰</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget http://dev.mysql.com/get/mysql57-community-release-el7-8.noarch.rpm</span><br><span class="line">yum localinstall mysql57-community-release-el7-8.noarch.rpm</span><br><span class="line">yum repolist enabled | grep &quot;mysql.*-community.*&quot;</span><br><span class="line">yum module disable mysql</span><br><span class="line">yum install mysql-community-server -y</span><br><span class="line">systemctl enable mysqld</span><br><span class="line">systemctl start mysqld</span><br><span class="line">systemctl daemon-reload</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ï¼ˆé€‰é¡¹3ï¼‰2-3-å®‰è£…æ—§ç‰ˆçš„Mysqlæ•°æ®åº“ï¼ˆ5-7-36ï¼‰"><a href="#ï¼ˆé€‰é¡¹3ï¼‰2-3-å®‰è£…æ—§ç‰ˆçš„Mysqlæ•°æ®åº“ï¼ˆ5-7-36ï¼‰" class="headerlink" title="ï¼ˆé€‰é¡¹3ï¼‰2.3. å®‰è£…æ—§ç‰ˆçš„Mysqlæ•°æ®åº“ï¼ˆ5.7.36ï¼‰"></a>ï¼ˆé€‰é¡¹3ï¼‰2.3. å®‰è£…æ—§ç‰ˆçš„Mysqlæ•°æ®åº“ï¼ˆ5.7.36ï¼‰</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm</span><br><span class="line">rpm -ivh mysql80-community-release-el7-3.noarch.rpm</span><br></pre></td></tr></table></figure><p>æŒ‡å®šç‰ˆæœ¬ (5.7)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/yum.repos.d/</span><br><span class="line">vim mysql-community.repo</span><br></pre></td></tr></table></figure><p><img src="/resources/67010a66a22e48c5b133de6df277264d.png" alt="a8f7e14be6eda3ea928d1df2a0f7f0b6.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y module disable mysql</span><br><span class="line">yum -y install mysql-community-server</span><br></pre></td></tr></table></figure><p>ç¡®è®¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql --version</span><br></pre></td></tr></table></figure><h2 id="ï¼ˆé€‰é¡¹4ï¼‰2-4-è·å–æ•°æ®åº“åˆå§‹å¯†ç "><a href="#ï¼ˆé€‰é¡¹4ï¼‰2-4-è·å–æ•°æ®åº“åˆå§‹å¯†ç " class="headerlink" title="ï¼ˆé€‰é¡¹4ï¼‰2.4. è·å–æ•°æ®åº“åˆå§‹å¯†ç "></a>ï¼ˆé€‰é¡¹4ï¼‰2.4. è·å–æ•°æ®åº“åˆå§‹å¯†ç </h2><p>ï¼ˆæ—§ç‰ˆæ•°æ®åº“éœ€è¦ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &#x27;temporary password&#x27; /var/log/mysqld.log</span><br></pre></td></tr></table></figure><h2 id="2-5-é…ç½®æ•°æ®åº“"><a href="#2-5-é…ç½®æ•°æ®åº“" class="headerlink" title="2.5. é…ç½®æ•°æ®åº“"></a>2.5. é…ç½®æ•°æ®åº“</h2><p>åˆå§‹åŒ–æ•°æ®åº“ï¼Œæ ¹æ®éœ€æ±‚é€‰æ‹© Y &#x2F; N</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure><p>ä¸ºRedmineåˆ›å»ºæ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line">CREATE DATABASE redmine CHARACTER SET utf8mb4;</span><br><span class="line">set global validate_password.policy=0; #å¯†ç ç­–ç•¥ä¸º0è¿™ä¸€æ­¥å¯é€‰</span><br><span class="line">CREATE USER &#x27;redmine&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;my_password&#x27;; #æŠŠ&#x27;my_password&#x27;æ”¹ä¸ºæˆ‘ä»¬æƒ³è¦è®¾å®šçš„å¯†ç </span><br><span class="line">GRANT ALL PRIVILEGES ON redmine.* TO &#x27;redmine&#x27;@&#x27;localhost&#x27;;</span><br></pre></td></tr></table></figure><p>é‡å¯æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable mysqld</span><br><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure><h1 id="3-å…³é—­Selinux"><a href="#3-å…³é—­Selinux" class="headerlink" title="3. å…³é—­Selinux"></a>3. å…³é—­Selinux</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/selinux/config</span><br><span class="line">#SELINUX=enforcing</span><br><span class="line"></span><br><span class="line">SELINUX=disabled</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br><span class="line">getenforce # ç¡®è®¤ç»“æœ</span><br></pre></td></tr></table></figure><h1 id="4-ä¸‹è½½å®‰è£…Redmine"><a href="#4-ä¸‹è½½å®‰è£…Redmine" class="headerlink" title="4. ä¸‹è½½å®‰è£…Redmine"></a>4. ä¸‹è½½å®‰è£…Redmine</h1><blockquote><p>è·å–æœ€æ–°ç‰ˆæœ¬:<br><a href="https://www.redmine.org/projects/redmine/wiki/Download">Redmineå®˜æ–¹ä¸‹è½½åœ°å€</a></p></blockquote><h2 id="4-1-ä¸‹è½½ä»¥åŠè§£å‹"><a href="#4-1-ä¸‹è½½ä»¥åŠè§£å‹" class="headerlink" title="4.1. ä¸‹è½½ä»¥åŠè§£å‹"></a>4.1. ä¸‹è½½ä»¥åŠè§£å‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.redmine.org/releases/redmine-4.2.3.tar.gz</span><br><span class="line">tar -zxvf redmine-4.2.3.tar.gz</span><br><span class="line">mv redmine-4.2.3 /redmine</span><br></pre></td></tr></table></figure><h2 id="4-2-é…ç½®database-ymlæ–‡ä»¶"><a href="#4-2-é…ç½®database-ymlæ–‡ä»¶" class="headerlink" title="4.2. é…ç½®database.ymlæ–‡ä»¶"></a>4.2. é…ç½®database.ymlæ–‡ä»¶</h2><p>æ ¹æ®æ•°æ®åº“è®¾ç½®ï¼Œé…ç½®Redmineçš„è¿æ¥æ•°æ®åº“è®¾å®šæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cd /redmine/config/</span><br><span class="line">cp database.yml.example database.yml</span><br><span class="line">vim database.yml</span><br><span class="line"></span><br><span class="line">production:</span><br><span class="line">adapter: mysql2</span><br><span class="line">database: redmine</span><br><span class="line">host: localhost</span><br><span class="line">username: redmine</span><br><span class="line">password: &quot;my_password&quot;</span><br><span class="line"># Use &quot;utf8&quot; instead of &quot;utfmb4&quot; for MySQL prior to 5.7.7</span><br><span class="line">encoding: utf8mb4</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š<br>è¦æŠŠdevelopmentï¼Œtestç­‰åŒºåŸŸç»™åˆ äº†<br>æ’ç‰ˆç¼©è¿›è¦æ­£ç¡®ï¼</p></blockquote><h2 id="4-3-é€šè¿‡Rubyéƒ¨ç½²"><a href="#4-3-é€šè¿‡Rubyéƒ¨ç½²" class="headerlink" title="4.3. é€šè¿‡Rubyéƒ¨ç½²"></a>4.3. é€šè¿‡Rubyéƒ¨ç½²</h2><p>æˆ‘å¯¹Rubyä¸äº†è§£ï¼Œè¿™äº›å‘½ä»¤ä¸æ˜¯å¾ˆæ‡‚ï¼Œä¼¼ä¹å¯ä»¥è‡ªåŠ¨å¯¼å…¥ Redmine æ“ä½œæ‰€éœ€çš„ Ruby è½¯ä»¶åŒ…ï¼Œä¸º MySQL æ•°æ®åº“åˆ›å»ºæ‰€éœ€çš„è¡¨æˆ–åŠ è½½é»˜è®¤æ•°æ®ï¼Ÿæ³¨æ„ä¸èƒ½å¿˜äº†ï¼Œåœ¨æ‰§è¡Œæ“ä½œå‰ç§»åŠ¨åˆ°Redmineç›®å½•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /redmine</span><br><span class="line">gem install bundler</span><br><span class="line">bundle install --without development test rmagick</span><br><span class="line">bundle exec rake generate_secret_token</span><br><span class="line">RAILS_ENV=production bundle exec rake db:migrate</span><br><span class="line">RAILS_ENV=production bundle exec rake redmine:load_default_data</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæœ€åä¸€è¡Œçš„æ—¶å€™é€‰æ‹©æƒ³è¦çš„è¯­è¨€ã€‚</p><h1 id="5-é…ç½®Apache"><a href="#5-é…ç½®Apache" class="headerlink" title="5. é…ç½®Apache"></a>5. é…ç½®Apache</h1><h2 id="5-1-å®‰è£…passenger"><a href="#5-1-å®‰è£…passenger" class="headerlink" title="5.1. å®‰è£…passenger"></a>5.1. å®‰è£…passenger</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gem install passenger</span><br><span class="line">passenger-install-apache2-module --auto --languages ruby</span><br></pre></td></tr></table></figure><p>æœ‰å¤§é‡çš„æ—¥å¿—åœ¨ç”»é¢ä¸Šæ»šåŠ¨ï¼Œéœ€è¦èŠ±ä¸€ç‚¹æ—¶é—´ã€‚è™½ç„¶æœ‰å¾ˆå¤šè­¦å‘Šï¼Œä½†æ˜¯å¦‚æœä¸å› é”™è¯¯è€Œæ‰è½çš„è¯åº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜ã€‚</p><h2 id="5-2-å®‰è£…snippet"><a href="#5-2-å®‰è£…snippet" class="headerlink" title="5.2. å®‰è£…snippet"></a>5.2. å®‰è£…snippet</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost redmine]# passenger-install-apache2-module --snippet</span><br><span class="line">LoadModule passenger_module /usr/local/share/gems/gems/passenger-6.0.11/buildout/apache2/mod_passenger.so</span><br><span class="line">&lt;IfModule mod_passenger.c&gt;</span><br><span class="line">PassengerRoot /usr/local/share/gems/gems/passenger-6.0.11</span><br><span class="line">PassengerDefaultRuby /usr/bin/ruby</span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure><h2 id="5-3-è®¾ç½®Redmineä¸ºApacheçš„æ ¹ç›®å½•ï¼Œå¹¶æŠŠä¸Šä¸€æ­¥5-2çš„ç»“æœå¤åˆ¶ä¸‹æ¥ç²˜è´´åˆ°redmine-confæ–‡ä»¶ä¸­"><a href="#5-3-è®¾ç½®Redmineä¸ºApacheçš„æ ¹ç›®å½•ï¼Œå¹¶æŠŠä¸Šä¸€æ­¥5-2çš„ç»“æœå¤åˆ¶ä¸‹æ¥ç²˜è´´åˆ°redmine-confæ–‡ä»¶ä¸­" class="headerlink" title="5.3. è®¾ç½®Redmineä¸ºApacheçš„æ ¹ç›®å½•ï¼Œå¹¶æŠŠä¸Šä¸€æ­¥5.2çš„ç»“æœå¤åˆ¶ä¸‹æ¥ç²˜è´´åˆ°redmine.confæ–‡ä»¶ä¸­"></a>5.3. è®¾ç½®Redmineä¸ºApacheçš„æ ¹ç›®å½•ï¼Œå¹¶æŠŠä¸Šä¸€æ­¥5.2çš„ç»“æœå¤åˆ¶ä¸‹æ¥ç²˜è´´åˆ°redmine.confæ–‡ä»¶ä¸­</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf.d/redmine.conf</span><br><span class="line"></span><br><span class="line">&lt;Directory &quot;/redmine/public&quot;&gt;</span><br><span class="line">Require all granted</span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">LoadModule passenger_module /usr/local/share/gems/gems/passenger-6.0.11/buildout/apache2/mod_passenger.so</span><br><span class="line">&lt;IfModule mod_passenger.c&gt;</span><br><span class="line">PassengerRoot /usr/local/share/gems/gems/passenger-6.0.11</span><br><span class="line">PassengerDefaultRuby /usr/bin/ruby</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="5-4"><a href="#5-4" class="headerlink" title="5.4."></a>5.4.</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf/httpd.conf</span><br><span class="line"></span><br><span class="line">DocumentRoot &quot;/redmine/public&quot;</span><br></pre></td></tr></table></figure><h2 id="5-5-ç»™Apacheæƒé™"><a href="#5-5-ç»™Apacheæƒé™" class="headerlink" title="5.5. ç»™Apacheæƒé™"></a>5.5. ç»™Apacheæƒé™</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R apache:apache /redmine</span><br></pre></td></tr></table></figure><h2 id="5-6-é‡å¯Apache"><a href="#5-6-é‡å¯Apache" class="headerlink" title="5.6. é‡å¯Apache"></a>5.6. é‡å¯Apache</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable httpd</span><br><span class="line">systemctl start httpd</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="6-é˜²ç«å¢™"><a href="#6-é˜²ç«å¢™" class="headerlink" title="6. é˜²ç«å¢™"></a>6. é˜²ç«å¢™</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --permanent --add-service=http</span><br><span class="line">firewall-cmd --zone=public --permanent --add-service=https</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><h1 id="7-æ’é”™"><a href="#7-æ’é”™" class="headerlink" title="7. æ’é”™"></a>7. æ’é”™</h1><h2 id="7-1-åˆ é™¤Mysqlæ•°æ®åº“"><a href="#7-1-åˆ é™¤Mysqlæ•°æ®åº“" class="headerlink" title="7.1. åˆ é™¤Mysqlæ•°æ®åº“"></a>7.1. åˆ é™¤Mysqlæ•°æ®åº“</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dnf -y remove mysql mysql-server mysql-libs mysql-common</span><br><span class="line">rm -rf /var/lib/mysql</span><br></pre></td></tr></table></figure><blockquote><p>å‚è€ƒï¼š<br><a href="https://www.redmine.org/projects/redmine/wiki/redmineinstall">Redmineå®˜æ–¹å®‰è£…æ•™ç¨‹</a><br><a href="https://chiritsumon.net/contents/archives/2072">CentOS8ã«Redmine4.1ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</a></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sudo su - postgres</span><br><span class="line">[postgres@localhost ~]$ psql</span><br></pre></td></tr></table></figure><pre><code>CREATE ROLE redmine LOGIN ENCRYPTED PASSWORD &#39;Your_Password&#39; NOINHERIT VALID UNTIL &#39;infinity&#39;;CREATE DATABASE redmine WITH ENCODING=&#39;UTF8&#39; OWNER=redmine;</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0-ç¯å¢ƒè¯´æ˜&quot;&gt;&lt;a href=&quot;#0-ç¯å¢ƒè¯´æ˜&quot; class=&quot;headerlink&quot; title=&quot;0. ç¯å¢ƒè¯´æ˜&quot;&gt;&lt;/a&gt;0. ç¯å¢ƒè¯´æ˜&lt;/h1&gt;&lt;h3 id=&quot;Redmineéœ€è¦çš„ç¯å¢ƒï¼š&quot;&gt;&lt;a href=&quot;#Redmineéœ€è¦çš„ç¯å¢ƒï¼š&quot; class=&quot;</summary>
      
    
    
    
    <category term="Redmine" scheme="https://kenryu.cc/ja/categories/Redmine/"/>
    
    
  </entry>
  
  <entry>
    <title>PCI pass though (Ethernet port)</title>
    <link href="https://kenryu.cc/ja/2021/08/26/Virtualization/PCI_pass_though_(Ethernet_port)/"/>
    <id>https://kenryu.cc/ja/2021/08/26/Virtualization/PCI_pass_though_(Ethernet_port)/</id>
    <published>2021-08-26T06:51:28.000Z</published>
    <updated>2022-07-01T10:18:11.000Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure><p><img src="/resources/1b17f06e0c5e4b5f874e8d75f202e0a3.png" alt="58d2fbc072f3f7bf1ce2a499b5351171.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@SMC-KVM ~]# ethtool -i eno2</span><br><span class="line">driver: ixgbe</span><br><span class="line">version: 4.18.0-305.10.2.el8_4.x86_64</span><br><span class="line">firmware-version: 0x800007f6, 1.1747.0</span><br><span class="line">expansion-rom-version:</span><br><span class="line">bus-info: 0000:01:00.1</span><br><span class="line">supports-statistics: yes</span><br><span class="line">supports-test: yes</span><br><span class="line">supports-eeprom-access: yes</span><br><span class="line">supports-register-dump: yes</span><br><span class="line">supports-priv-flags: yes</span><br></pre></td></tr></table></figure><p><img src="/resources/27aace41d26041b79a0f5d80136e96e9.png" alt="3211af94caf301c7b3f8e2c6733a0a41.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/grub2-efi.cfg</span><br><span class="line"># vim /etc/grub2.cfg</span><br><span class="line">set kernelopts=&quot;...iommu.passthrough=1&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/resources/98a5588d33c6466885873b358a593124.png" alt="9ab23b9c1a1cf4a1a7c3112cf9b149c7.png"></p><p>Enable intel iommu:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/default/grub</span><br><span class="line"></span><br><span class="line">GRUB_CMDLINE_LINUX=&quot;... intel_iommu=on iommu=pt</span><br><span class="line">#GRUB_CMDLINE_LINUX=&quot; ... amd_iommu=on</span><br></pre></td></tr></table></figure><blockquote><p>If intel_iommu&#x3D;on or amd_iommu&#x3D;on works, you can try replacing them with iommu&#x3D;pt or amd_iommu&#x3D;pt.</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class="line">cat /etc/grub2.cfg | grep &#x27;set kernelopt&#x27; # è¿™æ—¶å€™ä¸Šé¢çš„è®¾ç½®å·²ç»è¢«æ˜ å°„è¿‡æ¥äº†</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmesg | grep IOMMU</span><br></pre></td></tr></table></figure><p><img src="/resources/ccce25e9c35147de801cf73e4dad14bd.png" alt="c7a7c4f84766890e7a208a172e89536f.png"></p><p>Modify VMâ€™s specification:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/libvirt/qemu/cjl-test.xml /etc/libvirt/qemu/cjl-test.xml.bak</span><br><span class="line">vim /etc/libvirt/qemu/cjl-test.xml</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;hostdev mode=&#x27;subsystem&#x27; type=&#x27;pci&#x27; managed=&#x27;yes&#x27;&gt;</span><br><span class="line">&lt;source&gt;</span><br><span class="line">&lt;address domain=&#x27;0x0000&#x27; bus=&#x27;0x01&#x27; slot=&#x27;0x00&#x27; function=&#x27;0x1&#x27;/&gt;</span><br><span class="line">&lt;/source&gt;</span><br><span class="line">##&lt;address type=&#x27;pci&#x27; domain=&#x27;0x0000&#x27; bus=&#x27;0x01&#x27; slot=&#x27;0x02&#x27; function=&#x27;0x0&#x27;/&gt;</span><br><span class="line">&lt;/hostdev&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/resources/8bef6e49dd35419e87752e04ca76910f.png" alt="b78244be8645b79ac8943a0048b30856.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virsh define &amp;VMname</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ethtool -i eno2</span><br><span class="line">ethtool -i eno1</span><br></pre></td></tr></table></figure><h1 id="Guest-VM"><a href="#Guest-VM" class="headerlink" title="Guest (VM)"></a>Guest (VM)</h1><p><img src="/resources/908b43347b8f434da7ed603cdabb2206.png" alt="287e347b89b51b80dd46d4a9d1e9651c.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# lspci | grep Ethernet</span><br><span class="line">00:02.0 Ethernet controller: Intel Corporation Ethernet Controller 10G X550T (rev 01)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ethtool -i ens2</span><br><span class="line">driver: ixgbe</span><br><span class="line">version: 4.18.0-305.10.2.el8_4.x86_64</span><br><span class="line">firmware-version: 0x800007f6, 1.1747.0</span><br><span class="line">expansion-rom-version:</span><br><span class="line">bus-info: 0000:00:02.0</span><br><span class="line">supports-statistics: yes</span><br><span class="line">supports-test: yes</span><br><span class="line">supports-eeprom-access: yes</span><br><span class="line">supports-register-dump: yes</span><br><span class="line">supports-priv-flags: yes</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span</summary>
      
    
    
    
    <category term="Virtualization" scheme="https://kenryu.cc/ja/categories/Virtualization/"/>
    
    
    <category term="kvm" scheme="https://kenryu.cc/ja/tags/kvm/"/>
    
    <category term="hypervisor" scheme="https://kenryu.cc/ja/tags/hypervisor/"/>
    
  </entry>
  
  <entry>
    <title>Setup NFS client (nfs-utils)</title>
    <link href="https://kenryu.cc/ja/2021/05/11/File_Sharing_Servers/Setup_NFS_client__nfs_utils_/"/>
    <id>https://kenryu.cc/ja/2021/05/11/File_Sharing_Servers/Setup_NFS_client__nfs_utils_/</id>
    <published>2021-05-11T06:01:24.000Z</published>
    <updated>2022-06-30T13:52:05.000Z</updated>
    
    <content type="html"><![CDATA[<p>nfså®¢æˆ·ç«¯é€šè¿‡mountå®ç°è¿æ¥æœåŠ¡å™¨</p><p>ä¸‹è½½å®‰è£…nfs-utils</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install nfs-utils</span><br></pre></td></tr></table></figure><p>ç¡®è®¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@client ~]# showmount -e 192.168.64.48</span><br><span class="line">Export list for 192.168.64.48:</span><br><span class="line">/tmp/nfs 192.168.64.0/22</span><br></pre></td></tr></table></figure><p>æŒ‚è½½é”šç‚¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mount -t nfs 192.168.64.48:/tmp/nfs /mnt</span><br><span class="line"></span><br><span class="line">df -hT</span><br></pre></td></tr></table></figure><h2 id="Automatically-mount-by-using-autofs"><a href="#Automatically-mount-by-using-autofs" class="headerlink" title="Automatically mount by using autofs"></a>Automatically mount by using <strong>autofs</strong></h2><blockquote><p>One drawback of using &#x2F;etc&#x2F;fstab is that, regardless of how infrequently a user accesses the NFS mounted file system, the system must dedicate resources to keep the mounted file system in place. This is not a problem with one or two mounts, but when the system is maintaining mounts to many systems at one time, overall system performance can be affected.<br><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/storage_administration_guide/nfs-autofs">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/storage_administration_guide/nfs-autofs</a></p></blockquote><p>Step1. Install <strong>autofs</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dnf -y install autofs</span><br><span class="line">systemctl enable autofs</span><br></pre></td></tr></table></figure><p>Step2. Edit auto.master for direct mapping</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/auto.master</span><br><span class="line">#/misc /etc/auto.misc</span><br><span class="line">/- /etc/auto.misc</span><br></pre></td></tr></table></figure><p>Step3. Edit auto.misc</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/auto.misc</span><br><span class="line">/share -fstype=nfs4,rw 192.168.65.129:/share</span><br></pre></td></tr></table></figure><p>Step4. Restart autofs to apply the changes</p><pre><code>systemctl restart autofs</code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;nfså®¢æˆ·ç«¯é€šè¿‡mountå®ç°è¿æ¥æœåŠ¡å™¨&lt;/p&gt;
&lt;p&gt;ä¸‹è½½å®‰è£…nfs-utils&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/sp</summary>
      
    
    
    
    <category term="File Sharing Servers" scheme="https://kenryu.cc/ja/categories/File-Sharing-Servers/"/>
    
    
  </entry>
  
  <entry>
    <title>Setup NFS server (nfs-utils)</title>
    <link href="https://kenryu.cc/ja/2021/05/11/File_Sharing_Servers/Setup_NFS_server__nfs_utils_/"/>
    <id>https://kenryu.cc/ja/2021/05/11/File_Sharing_Servers/Setup_NFS_server__nfs_utils_/</id>
    <published>2021-05-11T05:06:04.000Z</published>
    <updated>2022-06-30T13:52:05.000Z</updated>
    
    <content type="html"><![CDATA[<p>Socket Statisticsã®ç¢ºèª</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost html]# ss -ntul</span><br><span class="line">Netid State Recv-Q Send-Q Local Address:Port Peer Address:Port</span><br><span class="line">tcp LISTEN 0 128 0.0.0.0:22 0.0.0.0:*</span><br><span class="line">tcp LISTEN 0 128 [::]:22 [::]:*</span><br></pre></td></tr></table></figure><p>å®‰è£…nfs-utils</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install nfs-utils</span><br></pre></td></tr></table></figure><p>è®¾ç½®é˜²ç«å¢™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --permanent --add-service=&#123;rpc-bind,mountd,nfs&#125;</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">firewall-cmd --list-all</span><br></pre></td></tr></table></figure><p>è®¾ç½®å¼€æœºè‡ªå¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable rpcbind</span><br><span class="line">systemctl enable nfs-server.service</span><br></pre></td></tr></table></figure><p>è®¾ç½®é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost nfs]# vi /etc/exports</span><br><span class="line">/tmp/nfs/ 192.168.64.0/22(rw,sync,no_root_squash,no_all_squash)</span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶çš„å‚æ•°</p><table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>ro</td><td>åªè¯»</td></tr><tr><td>rw</td><td>è¯»å†™</td></tr><tr><td>root_squash</td><td>å½“NFSå®¢æˆ·ç«¯ä»¥rootç®¡ç†å‘˜è®¿é—®æ—¶ï¼Œæ˜ å°„ä¸ºNFSæœåŠ¡å™¨çš„åŒ¿åç”¨æˆ·</td></tr><tr><td>no_root_squash</td><td>å½“NFSå®¢æˆ·ç«¯ä»¥rootç®¡ç†å‘˜è®¿é—®æ—¶ï¼Œæ˜ å°„ä¸ºNFSæœåŠ¡å™¨çš„rootç®¡ç†å‘˜</td></tr><tr><td>all_squash</td><td>æ— è®ºNFSå®¢æˆ·ç«¯ä½¿ç”¨ä»€ä¹ˆè´¦æˆ·è®¿é—®ï¼Œå‡æ˜ å°„ä¸ºNFSæœåŠ¡å™¨çš„åŒ¿åç”¨æˆ·</td></tr><tr><td>sync</td><td>åŒæ—¶å°†æ•°æ®å†™å…¥åˆ°å†…å­˜ä¸ç¡¬ç›˜ä¸­ï¼Œä¿è¯ä¸ä¸¢å¤±æ•°æ®</td></tr><tr><td>async</td><td>ä¼˜å…ˆå°†æ•°æ®å†™å…¥åˆ°å†…å­˜ï¼Œç„¶åå†å†™å…¥ç¡¬ç›˜ï¼›è¿™æ ·æ•ˆç‡æ›´é«˜ï¼Œä½†å¯èƒ½ä¼šä¸¢å¤±æ•°æ®</td></tr><tr><td>anonuid</td><td>æŒ‡å®šuidçš„å€¼ï¼Œæ­¤uidå¿…é¡»å­˜åœ¨äº&#x2F;etc&#x2F;passwdä¸­</td></tr><tr><td>anongid</td><td>æŒ‡å®šgidçš„å€¼</td></tr></tbody></table><p>å¯åŠ¨nfsæœåŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart rpcbind nfs-server.service</span><br></pre></td></tr></table></figure><p>ç¡®è®¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 mnt]# ss -ntul</span><br><span class="line">Netid State Recv-Q Send-Q Local Address:Port Peer Address:Port</span><br><span class="line">udp UNCONN 0 0 0.0.0.0:111 0.0.0.0:*</span><br><span class="line">udp UNCONN 0 0 [::]:111 [::]:*</span><br><span class="line">tcp LISTEN 0 128 0.0.0.0:111 0.0.0.0:*</span><br><span class="line">tcp LISTEN 0 128 0.0.0.0:22 0.0.0.0:*</span><br><span class="line">tcp LISTEN 0 128 [::]:111 [::]:*</span><br><span class="line">tcp LISTEN 0 128 [::]:22 [::]:*</span><br><span class="line"></span><br><span class="line">[root@localhost tmp]# showmount -e localhost</span><br><span class="line">Export list for localhost:</span><br><span class="line">/tmp/nfs 192.168.64.0/22</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Socket Statisticsã®ç¢ºèª&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;l</summary>
      
    
    
    
    <category term="File Sharing Servers" scheme="https://kenryu.cc/ja/categories/File-Sharing-Servers/"/>
    
    
  </entry>
  
  <entry>
    <title>Setup SMB server (samba)</title>
    <link href="https://kenryu.cc/ja/2021/05/10/File_Sharing_Servers/Setup_SMB_server__samba_/"/>
    <id>https://kenryu.cc/ja/2021/05/10/File_Sharing_Servers/Setup_SMB_server__samba_/</id>
    <published>2021-05-10T08:16:45.000Z</published>
    <updated>2022-06-30T13:52:05.000Z</updated>
    
    <content type="html"><![CDATA[<p>Socket Statisticsã®ç¢ºèª</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost html]# ss -ntul</span><br><span class="line">Netid State Recv-Q Send-Q Local Address:Port Peer Address:Port</span><br><span class="line">tcp LISTEN 0 128 0.0.0.0:22 0.0.0.0:*</span><br><span class="line">tcp LISTEN 0 128 [::]:22 [::]:*</span><br></pre></td></tr></table></figure><p>smb serverã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€FWã®è¨­å®š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">yum install samba</span><br><span class="line">firewall-cmd --zone=public --add-service=samba --permanent</span><br><span class="line">firewall-cmd --reload</span><br><span class="line">[root@localhost ~]# firewall-cmd --list-all</span><br><span class="line">public (active)</span><br><span class="line">target: default</span><br><span class="line">icmp-block-inversion: no</span><br><span class="line">interfaces: enp0s3</span><br><span class="line">sources:</span><br><span class="line">services: cockpit dhcpv6-client ftp http samba ssh</span><br><span class="line">ports:</span><br><span class="line">protocols:</span><br><span class="line">masquerade: no</span><br><span class="line">forward-ports:</span><br><span class="line">source-ports:</span><br><span class="line">icmp-blocks:</span><br><span class="line">rich rules:</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/samba/smb.conf /etc/samba/smb.conf.bak t#å¤‡ä»½é…ç½®æ–‡ä»¶</span><br><span class="line">vim /etc/samba/smb.conftttt#ç¼–è¾‘å†…å®¹</span><br></pre></td></tr></table></figure><p>vimç¼–è¾‘é‡Œé¢ä¿®æ”¹æˆ–è€…æ·»åŠ ä»¥ä¸‹å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ä¿®æ”¹globalå…¨å±€é…ç½®</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">samba4è¾ƒä¹‹å‰çš„samba3æœ‰ä¸€ä¸ªé‡å¤§çš„å˜åŒ–æ˜¯ï¼šsecurityä¸å†æ”¯æŒshare</span></span><br><span class="line">[global]</span><br><span class="line">workgroup = WORKGROUP</span><br><span class="line">security=user</span><br><span class="line">map to guest =Bad User</span><br><span class="line">tt</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ·»åŠ åä¸ºshareçš„å…±äº«æ–‡ä»¶å¤¹</span></span><br><span class="line">[share]</span><br><span class="line">comment = share all</span><br><span class="line">path = /tmp/samba</span><br><span class="line">browseable = yes</span><br><span class="line">public = yes</span><br><span class="line">writable = yes</span><br><span class="line">create mode = 0755</span><br><span class="line">force create mode = 0755</span><br><span class="line">directory mode = 0755</span><br><span class="line">force directory mode = 0755</span><br><span class="line">force user = apache</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ£€æµ‹è¯­æ³•æ˜¯å¦é”™è¯¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# testparm</span><br><span class="line">Load smb config files from /etc/samba/smb.conf</span><br><span class="line">Loaded services file OK.</span><br><span class="line">Server role: ROLE_STANDALONE</span><br><span class="line"></span><br><span class="line">Press enter to see a dump of your service definitions</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªå…±äº«æ–‡ä»¶å¤¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /tmp/samba</span><br><span class="line">chmod 777 /tmp/samba</span><br><span class="line">touch /tmp/samba/sharefiles</span><br><span class="line">echo &quot;111111&quot; &gt; /tmp/samba/sharefiles</span><br></pre></td></tr></table></figure><p>å¯åŠ¨smbæœåŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl start smb</span><br></pre></td></tr></table></figure><p>ç¡®è®¤smbç‰ˆæœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbstatus --version</span><br></pre></td></tr></table></figure><p>é€šè¿‡Socket Statisticså¯ä»¥çœ‹åˆ°139, 445ç«¯å£å·²ç»è¢«æ‰“å¼€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ss -tunl</span><br><span class="line">Netid State Recv-Q Send-Q Local Address:Port Peer Address:Port</span><br><span class="line">tcp LISTEN 0 50 0.0.0.0:139 0.0.0.0:*</span><br><span class="line">tcp LISTEN 0 128 0.0.0.0:22 0.0.0.0:*</span><br><span class="line">tcp LISTEN 0 50 0.0.0.0:445 0.0.0.0:*</span><br><span class="line">tcp LISTEN 0 50 [::]:139 [::]:*</span><br><span class="line">tcp LISTEN 0 128 [::]:22 [::]:*</span><br><span class="line">tcp LISTEN 0 50 [::]:445 [::]:*</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶é˜²ç«å¢™æ˜¯æ‰“å¼€çš„çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl status firewalld</span><br><span class="line">â— firewalld.service - firewalld - dynamic firewall daemon</span><br><span class="line">Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; vendor preset: enabled)</span><br><span class="line">Active: active (running) since Tue 2021-05-11 09:40:50 JST; 37min ago</span><br><span class="line">Docs: man:firewalld(1)</span><br><span class="line">Main PID: 857 (firewalld)</span><br><span class="line">Tasks: 2 (limit: 12404)</span><br><span class="line">Memory: 36.5M</span><br><span class="line">CGroup: /system.slice/firewalld.service</span><br><span class="line">mq857 /usr/libexec/platform-python -s /usr/sbin/firewalld --nofork --nopid</span><br><span class="line"></span><br><span class="line">May 11 09:40:49 localhost.localdomain systemd[1]: Starting firewalld - dynamic firewall daemon...</span><br><span class="line">May 11 09:40:50 localhost.localdomain systemd[1]: Started firewalld - dynamic firewall daemon.</span><br><span class="line">May 11 09:40:51 localhost.localdomain firewalld[857]: WARNING: AllowZoneDrifting is enabled. This is considered an insecure configuration option. It w&gt;</span><br></pre></td></tr></table></figure><p>å…³äºSELinux</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# getenforce</span><br><span class="line"><span class="meta prompt_">Enforcingttt#</span><span class="language-bash">å¼ºåˆ¶æ‰§è¡Œ</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿™ç§çŠ¶æ€ä¸å¯è®¿é—®</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# getenforce</span><br><span class="line"><span class="meta prompt_">Permissivettt#</span><span class="language-bash">è®¸å¯çš„</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿™ç§çŠ¶æ€åªæœ‰åªè¯»æƒé™</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/selinux/config</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">SELINUX=enforcingtt<span class="comment">#å¼ºåˆ¶æ‰§è¡Œ</span></span></span><br><span class="line">SELINUX=disabledtt#å…³é—­</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# reboott#éœ€è¦é‡å¯</span><br><span class="line">[root@localhost ~]# getenforce</span><br><span class="line">disabled</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿™ç§çŠ¶æ€åªæœ‰åªè¯»æƒé™</span></span><br></pre></td></tr></table></figure><p>åœ¨win10ä¸‹æ‰“å¼€æœåŠ¡å™¨åœ°å€</p><pre><code></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Socket Statisticsã®ç¢ºèª&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;l</summary>
      
    
    
    
    <category term="File Sharing Servers" scheme="https://kenryu.cc/ja/categories/File-Sharing-Servers/"/>
    
    
  </entry>
  
  <entry>
    <title>Setup FTP server (vsftpd)</title>
    <link href="https://kenryu.cc/ja/2021/05/10/File_Sharing_Servers/Setup_FTP_server__vsftpd_/"/>
    <id>https://kenryu.cc/ja/2021/05/10/File_Sharing_Servers/Setup_FTP_server__vsftpd_/</id>
    <published>2021-05-10T01:44:49.000Z</published>
    <updated>2022-06-30T13:52:05.000Z</updated>
    
    <content type="html"><![CDATA[<p>Socket Statistics</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost html]# ss -ntul</span><br><span class="line">Netid State Recv-Q Send-Q Local Address:Port Peer Address:Port</span><br><span class="line">tcp LISTEN 0 128 0.0.0.0:22 0.0.0.0:*</span><br><span class="line">tcp LISTEN 0 128 [::]:22 [::]:*</span><br></pre></td></tr></table></figure><p>FTP server pakege install</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install vsftpd -y</span><br></pre></td></tr></table></figure><p>FW setting</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-service=ftp --permanent</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>å¿…é¡»è®¾ç½®selinuxä¸ºå…³é—­</p><ol><li>ä¸´æ—¶è®¾ç½®ï¼ˆé‡å¯å¤±æ•ˆï¼‰<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]# setenforce 0</span><br><span class="line">[root@centos8 ~]# getenforce</span><br><span class="line">Permissive</span><br></pre></td></tr></table></figure></li><li>æ°¸ä¹…è®¾ç½®<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]# vim /etc/selinux/config</span><br><span class="line">#SELINUX=enforcing</span><br><span class="line">SELINUX=disabled</span><br><span class="line">[root@centos8 ~]# reboot</span><br><span class="line">[root@centos8 ~]# getenforce</span><br><span class="line">Disabled</span><br></pre></td></tr></table></figure></li></ol><p>FTPçš„é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ls /etc/vsftpd/</span><br><span class="line">ftpusers user_list vsftpd.conf vsftpd_conf_migrate.sh</span><br></pre></td></tr></table></figure><p>å¤‡ä»½ä¸»é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.bak</span><br></pre></td></tr></table></figure><p>FTPå¯ä»¥æœ‰ä¸‰ç§ç™»å…¥æ–¹å¼åˆ†åˆ«æ˜¯ï¼š</p><blockquote><p>åŒ¿åç™»å½•æ–¹å¼ï¼šä¸éœ€è¦ç”¨æˆ·å¯†ç <br>æœ¬åœ°ç”¨æˆ·ç™»å…¥ï¼šä½¿ç”¨æœ¬åœ°ç”¨æˆ·å’Œå¯†ç ç™»å…¥<br>è™šæ‹Ÿç”¨æˆ·æ–¹å¼ï¼šä¹Ÿæ˜¯ä½¿ç”¨ç”¨æˆ·å’Œå¯†ç ç™»å…¥ï¼Œä½†æ˜¯è¯¥ç”¨æˆ·ä¸æ˜¯linuxä¸­åˆ›å»ºçš„ç”¨æˆ·<br>vsftpd.conf: ä¸»é…ç½®æ–‡ä»¶</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">[root@centos8 ~]# vim /etc/vsftpd/vsftpd.conf</span><br><span class="line">anonymous_enable=YEStt#å…è®¸åŒ¿åç”¨æˆ·ç™»é™†</span><br><span class="line">anon_upload_enable=YES tt#åŒ¿åç”¨æˆ·å¯ä»¥ä¸Šä¼ æ–‡ä»¶</span><br><span class="line">anon_mkdir_write_enable=YESt#åŒ¿åç”¨æˆ·å¯ä»¥ä¿®æ”¹æ–‡ä»¶å¤¹</span><br><span class="line">anon_other_write_enable=YESt#åŒ¿åç”¨æˆ·å¯ä»¥ä¿®æ”¹æ–‡ä»¶å¤¹</span><br><span class="line">no_anon_password=YEStt#åŒ¿åç”¨æˆ·loginæ—¶ä¸è¯¢é—®å£ä»¤</span><br><span class="line">anon_umask=011tt#åŒ¿åç”¨æˆ·åˆ›å»ºæ–‡ä»¶çš„æ©ç ï¼Œä¸æŒ‡å®šæ—¶å€™ä¸º077</span><br><span class="line"></span><br><span class="line">local_enable=YES #vsftpdæ‰€åœ¨ç³»ç»Ÿçš„ç”¨æˆ·å¯ä»¥ç™»å½•vsftpd</span><br><span class="line">write_enable=YES #å…¨å±€è®¾ç½®ï¼Œæ˜¯å¦å®¹è®¸å†™å…¥ï¼ˆæ— è®ºæ˜¯åŒ¿åç”¨æˆ·è¿˜æ˜¯æœ¬åœ°ç”¨æˆ·ï¼Œè‹¥è¦å¯ç”¨ä¸Šä¼ æƒé™çš„è¯ï¼Œå°±è¦å¼€å¯ä»–ï¼‰</span><br><span class="line">local_umask=002 #åŒ¿åç”¨æˆ·æ–°å¢æ–‡ä»¶çš„umaskæ•°å€¼</span><br><span class="line">xferlog_enable=YES #å¯ç”¨ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œç”¨äºè¯¦ç»†è®°å½•ä¸Šä¼ å’Œä¸‹è½½ã€‚</span><br><span class="line">use_localtime=YES #ä½¿ç”¨æœ¬åœ°æ—¶é—´è€Œä¸æ˜¯GMT</span><br><span class="line">vsftpd_log_file=/var/log/vsftpd.log #vsftpdæ—¥å¿—å­˜æ”¾ä½ç½®</span><br><span class="line">dual_log_enable=YES #ç”¨æˆ·ç™»é™†æ—¥å¿—</span><br><span class="line">connect_from_port_20=YES #å¼€å¯20ç«¯å£</span><br><span class="line">xferlog_file=/var/log/xferlog #è®°å½•ä¸Šä¼ ä¸‹è½½æ–‡ä»¶çš„æ—¥å¿—</span><br><span class="line">xferlog_std_format=YES #è®°å½•æ—¥å¿—ä½¿ç”¨æ ‡å‡†æ ¼å¼</span><br><span class="line">idle_session_timeout=600 #ç™»é™†ä¹‹åè¶…æ—¶æ—¶é—´60ç§’ï¼Œç™»é™†ä¹‹åï¼Œä¸€åˆ†é’Ÿä¸æ“ä½œï¼Œå°±ä¼šæ–­å¼€è¿æ¥ã€‚</span><br><span class="line">chroot_local_user=YES #ç”¨äºæŒ‡å®šç”¨æˆ·åˆ—è¡¨æ–‡ä»¶ä¸­çš„ç”¨æˆ·,æ˜¯å¦å…è®¸åˆ‡æ¢åˆ°ä¸Šçº§ç›®å½•</span><br><span class="line">listen=YES #å¼€å¯ç›‘å¬</span><br><span class="line">pam_service_name=vsftpd.vu #éªŒè¯æ–‡ä»¶çš„åå­—</span><br><span class="line">userlist_enable=YES #å…è®¸ç”±user_listæŒ‡å®šæ–‡ä»¶ä¸­çš„ç”¨æˆ·ç™»å½•FTPæœåŠ¡å™¨</span><br><span class="line">tcp_wrappers=YES #æ”¯æŒtcp_wrappers,é™åˆ¶è®¿é—®(/etc/hosts.allow,/etc/hosts.deny)</span><br><span class="line">guest_enable=YES #èµ·ç”¨è™šæ‹Ÿç”¨æˆ·</span><br><span class="line">guest_username=taokey #è™šæ‹Ÿç”¨æˆ·å</span><br><span class="line"></span><br><span class="line">#user_config_dir=/etc/vsftpd/vsftpuser #è™šæ‹Ÿç”¨æˆ·é…ç½®æ–‡ä»¶è·¯å¾„</span><br><span class="line">local_root=/home/ftpUser/ #è‡ªå®šä¹‰ftpä¸Šä¼ è·¯å¾„ï¼ˆæ³¨æ„æ–‡ä»¶å¤¹æƒé™ï¼‰</span><br><span class="line">pasv_min_port=35000</span><br><span class="line">pasv_max_port=45000</span><br><span class="line">pasv_enable=YES</span><br><span class="line">pasv_promiscuous=YES</span><br><span class="line">anon_other_write_enable=YES</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># 1. ç›‘å¬ç›¸å…³</span><br><span class="line">#</span><br><span class="line">listen=&lt;YES/NO&gt; # YES: æœåŠ¡ä»¥ç‹¬ç«‹è¿è¡Œæ–¹å¼è¿è¡Œ; NO: è¿è¡Œåœ¨ xinetd å†…ã€‚ é»˜è®¤ä¸º YES</span><br><span class="line">listen_address=&lt;ip address&gt; # æœåŠ¡ç›‘å¬åœ°å€, å¦‚æœæœ‰å¤šä¸ªç½‘å¡, éœ€è¦å°†æœåŠ¡ç»‘å®šåˆ°æŒ‡å®š IP åœ°å€</span><br><span class="line">listen_port=&lt;port&gt; # æœåŠ¡ç›‘å¬ç«¯å£, é»˜è®¤ä¸º 21</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># 2. åŒ¿åç”¨æˆ·ç›¸å…³</span><br><span class="line">#</span><br><span class="line">anonymous_enable=&lt;YES/NO&gt; # æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·è®¿é—®, é»˜è®¤ NO</span><br><span class="line">no_anon_password=YES t # åŒ¿åç”¨æˆ·loginæ—¶ä¸è¯¢é—®å£ä»¤</span><br><span class="line">anon_mkdir_write_enable=&lt;YES/NO&gt; # æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·åˆ›å»ºæ–‡ä»¶å¤¹, é»˜è®¤ NO</span><br><span class="line">anon_other_write_enable=&lt;YES/NO&gt; # æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·é‡å‘½åã€åˆ é™¤æ–‡ä»¶å¤¹ç­‰å…¶ä»–æƒé™ï¼ˆé»˜è®¤ä¸º NO, åŸºäºå®‰å…¨æ€§è€ƒè™‘è¿™ä¸ªæƒé™ä¸€èˆ¬ä¸æ‰“å¼€ï¼‰</span><br><span class="line">anon_upload_enable=&lt;YES/NO&gt; # æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·ä¸Šä¼ , é»˜è®¤ NO</span><br><span class="line">anon_umask=&lt;nnn&gt; # åŒ¿åç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶çš„ç”Ÿæˆæ©ç , é»˜è®¤ä¸º077</span><br><span class="line">anon_max_rate=&lt;n&gt; # åŒ¿åç”¨æˆ·çš„æœ€å¤§ä¼ è¾“é€Ÿç‡, å•ä½ä¸º Byte/s, å€¼ä¸º 0 è¡¨ç¤ºä¸é™åˆ¶</span><br><span class="line">anon_world_readable_only=&lt;YES/NO&gt; # æ˜¯å¦å…è®¸åŒ¿åç”¨æˆ·åªè¯»æµè§ˆ</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># 3. æœ¬åœ°ç”¨æˆ·(Linuxæ ‡å‡†ç³»ç»Ÿç”¨æˆ·)ç›¸å…³</span><br><span class="line">#</span><br><span class="line">local_enable=&lt;YES/NO&gt; # æ˜¯å¦æ”¯æŒæœ¬åœ°ç”¨æˆ·å¸å·è®¿é—®</span><br><span class="line">write_enable=&lt;YES/NO&gt; # æ˜¯å¦å¼€æ”¾æœ¬åœ°ç”¨æˆ·çš„å†™æƒé™</span><br><span class="line">local_umask=&lt;nnn&gt; # æœ¬åœ°ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶çš„ç”Ÿæˆæ©ç , é»˜è®¤ä¸º077</span><br><span class="line">local_max_rate=&lt;n&gt; # æœ¬åœ°ç”¨æˆ·æœ€å¤§çš„ä¼ è¾“é€Ÿç‡, å•ä½ä¸º Byte/sï¼Œå€¼ä¸º 0 è¡¨ç¤ºä¸é™åˆ¶</span><br><span class="line">local_root=&lt;file&gt; # æœ¬åœ°ç”¨æˆ·ç™»é™†åçš„ç›®å½•ï¼Œé»˜è®¤ä¸º æœ¬åœ°ç”¨æˆ· çš„ ä¸»ç›®å½•</span><br><span class="line"></span><br><span class="line">chroot_local_user=&lt;YES/NO&gt; # æœ¬åœ°ç”¨æˆ·æ˜¯å¦å¯ä»¥æ‰§è¡Œ chroot, é»˜è®¤ä¸º NO</span><br><span class="line">chroot_list_enable=&lt;YES/NO&gt; # æ˜¯å¦åªæœ‰æŒ‡å®šçš„ç”¨æˆ·æ‰èƒ½æ‰§è¡Œ chroot, é»˜è®¤ä¸º NO</span><br><span class="line">chroot_list_file=&lt;filename&gt; # å½“ chroot_local_user=NO ä¸” chroot_list_enable=YES æ—¶,</span><br><span class="line"># åªæœ‰ filename æ–‡ä»¶å†…æŒ‡å®šçš„ç”¨æˆ·ï¼ˆæ¯è¡Œä¸€ä¸ªç”¨æˆ·åï¼‰å¯ä»¥æ‰§è¡Œ chroot,</span><br><span class="line"># é»˜è®¤å€¼ä¸º /etc/vsftpd.chroot_list</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># 4. æœ¬åœ°ç”¨æˆ· é»‘/ç™½åå•ç®¡ç†</span><br><span class="line">#</span><br><span class="line">userlist_enable=&lt;YES/NO&gt; # æ˜¯å¦å¯ç”¨ userlist_file ç”¨æˆ·åˆ—è¡¨, é»˜è®¤ä¸º YESï¼Œè®¾ç½®ä¸ºNOçš„æ—¶å€™ï¼Œå¹¶ä¸”ç”¨æˆ·åä¸åœ¨é»‘åå•ï¼ˆuser_listï¼‰å¯ä»¥ç™»å½•ï¼Œå¹¶æŸ¥çœ‹ls ~ä¸­çš„æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">userlist_deny=&lt;YES/NO&gt; # å½“ userlist_enable=YESï¼ˆå³å¯ç”¨ userlist_file ï¼‰æ—¶, åˆ™è¯¥å­—æ®µæ‰æœ‰æ•ˆã€‚</span><br><span class="line"># userlist_deny=YES: userlist_file ä¸º é»‘åå•, å³åœ¨è¯¥æ–‡ä»¶å†…çš„ç”¨æˆ·å‡ä¸å¯ç™»å½•, å…¶ä»–ç”¨æˆ·å¯ä»¥ç™»å½•</span><br><span class="line"># userlist_deny=NO: userlist_file ä¸º ç™½åå•, å³åœ¨è¯¥æ–‡ä»¶å†…çš„ç”¨æˆ·æ‰å¯ä»¥ç™»å½•, å…¶ä»–ç”¨æˆ·å‡ä¸å¯ç™»å½•</span><br><span class="line"></span><br><span class="line">userlist_file=&lt;filename&gt; # é»‘/ç™½åå•ç”¨æˆ·åˆ—è¡¨æ–‡ä»¶ï¼ˆæ¯è¡Œä¸€ä¸ªç”¨æˆ·åï¼‰,</span><br><span class="line"># æ˜¯é»‘åå•è¿˜æ˜¯ç™½åå•, æ ¹æ® userlist_deny çš„å€¼å†³å®š,</span><br><span class="line"># é»˜è®¤å€¼ä¸º /etc/vsftpd/user_list</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># 5. è¿æ¥ç›¸å…³</span><br><span class="line">#</span><br><span class="line">ftpd_banner=&lt;message&gt; # å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨åæ˜¾ç¤ºçš„æ¬¢è¿ä¿¡æ¯</span><br><span class="line">connect_timeout=&lt;n&gt; # è¿œç¨‹å®¢æˆ·ç«¯å“åº”ç«¯å£æ•°æ®è¿æ¥è¶…æ—¶æ—¶é—´, å•ä½ä¸ºç§’, é»˜è®¤ 60</span><br><span class="line">accept_connection_timeout=&lt;n&gt; # ç©ºé—²çš„æ•°æ®è¿æ¥è¶…æ—¶æ—¶é—´, å•ä½ä¸ºç§’, é»˜è®¤ 120</span><br><span class="line">data_connection_timeout=&lt;n&gt; # ç©ºé—²çš„ç”¨æˆ·ä¼šè¯è¶…æ—¶æ—¶é—´, å•ä½ä¸ºç§’, é»˜è®¤ 300</span><br><span class="line">max_clients=&lt;n&gt; # åœ¨ç‹¬ç«‹æ¨¡å¼è¿è¡Œæ—¶, æœ€å¤§è¿æ¥æ•°, 0 è¡¨ç¤ºæ— é™åˆ¶</span><br><span class="line">max_per_ip=&lt;n&gt; # åœ¨ç‹¬ç«‹æ¨¡å¼è¿è¡Œæ—¶, æ¯ IP çš„æœ€å¤§è¿æ¥æ•°, 0è¡¨ç¤ºæ— é™åˆ¶</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦å¤–é»˜è®¤VsftpdåŒ¿åç”¨æˆ·æœ‰ä¸¤ä¸ªï¼šanonymousã€ftpï¼Œæ‰€ä»¥åŒ¿åç”¨æˆ·å¦‚æœéœ€è¦ä¸Šä¼ æ–‡ä»¶ã€åˆ é™¤åŠä¿®æ”¹ç­‰æƒé™ï¼Œéœ€è¦ftpç”¨æˆ·å¯¹&#x2F;var&#x2F;ftp&#x2F;pubç›®å½•æœ‰å†™å…¥æƒé™ï¼Œä½¿ç”¨å¦‚ä¸‹chownå’Œchmodä»»æ„ä¸€ç§å³å¯ï¼Œè®¾ç½®å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chown -R ftp /var/ftp/pub/</span><br><span class="line">chgrp -R ftp /var/ftp/pub/</span><br><span class="line">chmod -R 766 /var/ftp/pub/</span><br></pre></td></tr></table></figure><p>ç¡®è®¤ç«¯å£å¼€å¯çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost html]# systemctl start vsftpd</span><br><span class="line">[root@localhost html]# ss -ntul</span><br><span class="line">Netid State Recv-Q Send-Q Local Address:Port Peer Address:Port</span><br><span class="line">tcp LISTEN 0 128 0.0.0.0:22 0.0.0.0:*</span><br><span class="line">tcp LISTEN 0 32 *:21 *:*</span><br><span class="line">tcp LISTEN 0 128 [::]:22 [::]:*</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Socket Statistics&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line</summary>
      
    
    
    
    <category term="File Sharing Servers" scheme="https://kenryu.cc/ja/categories/File-Sharing-Servers/"/>
    
    
  </entry>
  
</feed>
